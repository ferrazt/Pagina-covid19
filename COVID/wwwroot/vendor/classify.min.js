/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/vendor@1.7.0/classify.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const _=require("lodash"),cheerio=require("cheerio"),toTagName=e=>e.get(0).tagName.toLowerCase(),toClass=e=>(e.attr("class")||"").trim(),toID=e=>(e.attr("id")||"").trim(),isCommon=e=>!/\d+$/.test(e),getSelector=e=>{const t=toID(e),r=toClass(e);let o=toTagName(e);if(t&&isCommon(t)&&(o+="#"+t),r){const e=_.chain(r).split(/\s+/).value();e.length>0&&(o+="."+e.join("."))}return o},getSelectors=(e,t)=>{e=e.first();const r=getSelector(e),o=e.parents().toArray().map(e=>getSelector(t(e)));return _.chain(r).concat(o).reverse().value()},findTheSame=e=>{if(e.length<=1)return 0;const t=_.chain(e).maxBy(e=>e.length).value();let r=0;for(;_.every(e,e=>e[r]===t[r]);)r++;return r},shorten=(e,t)=>{const r=_.map(e,"selector"),o=findTheSame(r);return o>0&&e.forEach(e=>e.selector=e.selector.slice(o)),_.filter(e,e=>e.selector.length>0)},sep=" ",slice=(e,t)=>e.map(e=>Object.assign({},e,{selector:e.selector.slice(t)})),expandKey=(e,t,r)=>_.chain(e).concat(t.slice(0,r)).join(" ").value(),lengthKey=(e,t)=>`(${t}) ${e}`,groupBy=e=>{const[t,r]=_.partition(e,({selector:e})=>e.length>1);return _.chain(t).groupBy("selector.0").map((e,t)=>{e=slice(e,1);const r=findTheSame(_.map(e,"selector"));if(r>0&&(t=expandKey(t,e[0].selector,r),e=slice(e,r)),e.length>1)e=groupBy(e);else{const{selector:r,text:o,length:s}=e[0];t=lengthKey(expandKey(t,r),s),e=o}return[t,e]}).concat(r.map(({selector:e,text:t,length:r})=>[lengthKey(e,r),t])).fromPairs().value()},isLeaf=(e,t)=>!_.some(t,t=>t!==e&&_.startsWith(t,e)),classify=(e,t)=>{const r=cheerio.load(e);let o=r(t=t?`${t} *`:"*");o=o.map((e,t)=>{const o=r(t);return{selectors:getSelectors(o,r),text:o.text().trim().replace(/\s+/," ")}}).get();let s=_.chain(o).groupBy(e=>e.selectors.join(" ")).map((e,t)=>({selector:t.split(" "),text:e[0].text,length:e.length})).value();s=shorten(s);const l=_.map(s,e=>e.selector.join(" "));return s=_.chain(s).orderBy("length","desc").filter(e=>isLeaf(e.selector.join(" "),l)).value(),groupBy(s)};module.exports=classify;
//# sourceMappingURL=/sm/62efab3b20608a4cbc0763b2cefd4fd622a7bbe49b6472825f612231e2dfeb99.map