import H from"../../../Core/Globals.js";import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,objectEach=U.objectEach,pick=U.pick,removeEvent=U.removeEvent,eventEmitterMixin={addEvents:function(){function e(t){addEvent(t,H.isTouchDevice?"touchstart":"mousedown",function(t){a.onMouseDown(t)},{passive:!1})}var o,a=this;e(this.graphic.element),(a.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&e(t.graphic.text.element)}),objectEach(a.options.events,function(e,o){function t(t){"click"===o&&a.cancelClick||e.call(a,a.chart.pointer.normalize(t),a.target)}-1===(a.nonDOMEvents||[]).indexOf(o)?a.graphic.on(o,t):addEvent(a,o,t,{passive:!1})}),a.options.draggable&&(addEvent(a,"drag",a.onDrag),a.graphic.renderer.styledMode||(o={cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[a.options.draggable]},a.graphic.css(o),(a.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&t.graphic.text.css(o)}))),a.isUpdating||fireEvent(a,"add")},removeDocEvents:function(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())},onMouseDown:function(t){var e,o,a=this,r=a.chart.pointer;t.preventDefault&&t.preventDefault(),2!==t.button&&(t=r.normalize(t),e=t.chartX,o=t.chartY,a.cancelClick=!1,a.chart.hasDraggedAnnotation=!0,a.removeDrag=addEvent(H.doc,H.isTouchDevice?"touchmove":"mousemove",function(t){a.hasDragged=!0,(t=r.normalize(t)).prevChartX=e,t.prevChartY=o,fireEvent(a,"drag",t),e=t.chartX,o=t.chartY},H.isTouchDevice?{passive:!1}:void 0),a.removeMouseUp=addEvent(H.doc,H.isTouchDevice?"touchend":"mouseup",function(t){a.cancelClick=a.hasDragged,a.hasDragged=!1,a.chart.hasDraggedAnnotation=!1,fireEvent(pick(a.target,a),"afterUpdate"),a.onMouseUp(t)},H.isTouchDevice?{passive:!1}:void 0))},onMouseUp:function(t){var e=this.chart,o=this.target||this,a=e.options.annotations,e=e.annotations.indexOf(o);this.removeDocEvents(),a[e]=o.options},onDrag:function(t){var e;this.chart.isInsidePlot(t.chartX-this.chart.plotLeft,t.chartY-this.chart.plotTop,{visiblePlotOnly:!0})&&(e=this.mouseMoveToTranslation(t),"x"===this.options.draggable&&(e.y=0),"y"===this.options.draggable&&(e.x=0),this.points.length?this.translate(e.x,e.y):(this.shapes.forEach(function(t){t.translate(e.x,e.y)}),this.labels.forEach(function(t){t.translate(e.x,e.y)})),this.redraw(!1))},mouseMoveToRadians:function(t,e,o){var a=t.prevChartY-o,r=t.prevChartX-e,o=t.chartY-o,t=t.chartX-e;return this.chart.inverted&&(e=r,r=a,a=e,e=t,t=o,o=e),Math.atan2(o,t)-Math.atan2(a,r)},mouseMoveToTranslation:function(t){var e=t.chartX-t.prevChartX,o=t.chartY-t.prevChartY;return this.chart.inverted&&(t=o,o=e,e=t),{x:e,y:o}},mouseMoveToScale:function(t,e,o){var a=t.prevChartX-e,r=t.prevChartY-o,a=(t.chartX-e||1)/(a||1),o=(t.chartY-o||1)/(r||1);return this.chart.inverted&&(r=o,o=a,a=r),{x:a,y:o}},destroy:function(){this.removeDocEvents(),removeEvent(this),this.hcEvents=null}};export default eventEmitterMixin;