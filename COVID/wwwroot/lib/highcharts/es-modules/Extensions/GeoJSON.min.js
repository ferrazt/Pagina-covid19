"use strict";import Chart from"../Core/Chart/Chart.js";import F from"../Core/FormatUtilities.js";var format=F.format;import H from"../Core/Globals.js";var win=H.win;import U from"../Core/Utilities.js";var error=U.error,extend=U.extend,merge=U.merge,wrap=U.wrap;function pointInPolygon(t,r){for(var o=!1,n=t.x,a=t.y,i=0,e=r.length-1;i<r.length;e=i++)r[i][1]>a!=r[e][1]>a&&n<(r[e][0]-r[i][0])*(a-r[i][1])/(r[e][1]-r[i][1])+r[i][0]&&(o=!o);return o}Chart.prototype.transformFromLatLon=function(t,r){var o=this.userOptions.chart&&this.userOptions.chart.proj4||win.proj4;if(!o)return error(21,!1,this),{x:0,y:null};var n=o(r.crs,[t.lon,t.lat]),o=r.cosAngle||r.rotation&&Math.cos(r.rotation),t=r.sinAngle||r.rotation&&Math.sin(r.rotation),n=r.rotation?[n[0]*o+n[1]*t,-n[0]*t+n[1]*o]:n;return{x:((n[0]-(r.xoffset||0))*(r.scale||1)+(r.xpan||0))*(r.jsonres||1)+(r.jsonmarginX||0),y:(((r.yoffset||0)-n[1])*(r.scale||1)+(r.ypan||0))*(r.jsonres||1)-(r.jsonmarginY||0)}},Chart.prototype.transformToLatLon=function(t,r){if(void 0!==win.proj4){var o={x:((t.x-(r.jsonmarginX||0))/(r.jsonres||1)-(r.xpan||0))/(r.scale||1)+(r.xoffset||0),y:((-t.y-(r.jsonmarginY||0))/(r.jsonres||1)+(r.ypan||0))/(r.scale||1)+(r.yoffset||0)},n=r.cosAngle||r.rotation&&Math.cos(r.rotation),t=r.sinAngle||r.rotation&&Math.sin(r.rotation),o=win.proj4(r.crs,"WGS84",r.rotation?{x:o.x*n+o.y*-t,y:o.x*t+o.y*n}:o);return{lat:o.y,lon:o.x}}error(21,!1,this)},Chart.prototype.fromPointToLatLon=function(t){var r,o=this.mapTransforms;if(o){for(r in o)if(Object.hasOwnProperty.call(o,r)&&o[r].hitZone&&pointInPolygon({x:t.x,y:-t.y},o[r].hitZone.coordinates[0]))return this.transformToLatLon(t,o[r]);return this.transformToLatLon(t,o.default)}error(22,!1,this)},Chart.prototype.fromLatLonToPoint=function(t){var r,o,n=this.mapTransforms;if(!n)return error(22,!1,this),{x:0,y:null};for(r in n)if(Object.hasOwnProperty.call(n,r)&&n[r].hitZone&&pointInPolygon({x:(o=this.transformFromLatLon(t,n[r])).x,y:-o.y},n[r].hitZone.coordinates[0]))return o;return this.transformFromLatLon(t,n.default)},H.geojson=function(t,a,r){function i(t){t.forEach(function(t,r){0===r?s.push(["M",t[0],-t[1]]):s.push(["L",t[0],-t[1]])})}var e=[],s=[];return a=a||"map",t.features.forEach(function(t){var r,o=t.geometry,n=o.type,o=o.coordinates,t=t.properties;s=[],"map"===a||"mapbubble"===a?("Polygon"===n?(o.forEach(i),s.push(["Z"])):"MultiPolygon"===n&&(o.forEach(function(t){t.forEach(i)}),s.push(["Z"])),s.length&&(r={path:s})):"mapline"===a?("LineString"===n?i(o):"MultiLineString"===n&&o.forEach(i),s.length&&(r={path:s})):"mappoint"===a&&"Point"===n&&(r={x:o[0],y:-o[1]}),r&&e.push(extend(r,{name:t.name||t.NAME,properties:t}))}),r&&t.copyrightShort&&(r.chart.mapCredits=format(r.chart.options.credits.mapText,{geojson:t}),r.chart.mapCreditsFull=format(r.chart.options.credits.mapTextFull,{geojson:t})),e},wrap(Chart.prototype,"addCredits",function(t,r){r=merge(!0,this.options.credits,r),this.mapCredits&&(r.href=null),t.call(this,r),this.credits&&this.mapCreditsFull&&this.credits.attr({title:this.mapCreditsFull})});