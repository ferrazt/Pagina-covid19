"use strict";import H from"../../Core/Globals.js";import U from"../../Core/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick;import utilities from"./Utilities.js";var defaultInstrumentOptions={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};function pointSonify(n){function a(i,n,t){if("function"==typeof i)return n?function(n){return i(s,u,n)}:i(s,u);if("string"!=typeof i)return i;var e="-"===i.charAt(0),o=e?i.slice(1):i,n=pick(s[o],s.options[o]);return u[o]=u[o]||utilities.calculateDataExtremes(s.series.chart,o),utilities.virtualAxisTranslate(n,u[o],t,e)}var s=this,r=s.series.chart,l=pick(n.masterVolume,r.options.sonification&&r.options.sonification.masterVolume),u=n.dataExtremes||{};(r.sonification.currentlyPlayingPoint=s).sonification=s.sonification||{},s.sonification.instrumentsPlaying=s.sonification.instrumentsPlaying||{};var c=s.sonification.signalHandler=s.sonification.signalHandler||new utilities.SignalHandler(["onEnd"]);c.clearSignalCallbacks(),c.registerSignalCallbacks({onEnd:n.onEnd}),!s.isNull&&s.visible&&s.series.visible?n.instruments.forEach(function(i){var n="string"==typeof i.instrument?H.sonification.instruments[i.instrument]:i.instrument,t=i.instrumentMapping||{},e=merge(defaultInstrumentOptions,i.instrumentOptions),o=n.id;n&&n.play?(void 0!==l&&n.setMasterVolume(l),(s.sonification.instrumentsPlaying[n.id]=n).play({frequency:a(t.frequency,!0,{min:e.minFrequency,max:e.maxFrequency}),duration:a(t.duration,!1,{min:e.minDuration,max:e.maxDuration}),pan:a(t.pan,!0,{min:e.minPan,max:e.maxPan}),volume:a(t.volume,!0,{min:e.minVolume,max:e.maxVolume}),onEnd:function(n){i.onEnd&&i.onEnd.apply(this,arguments),r.sonification&&r.sonification.currentlyPlayingPoint&&delete r.sonification.currentlyPlayingPoint,s.sonification&&s.sonification.instrumentsPlaying&&(delete s.sonification.instrumentsPlaying[o],Object.keys(s.sonification.instrumentsPlaying).length||c.emitSignal("onEnd",n))},minFrequency:e.minFrequency,maxFrequency:e.maxFrequency})):error(30)}):c.emitSignal("onEnd")}function pointCancelSonify(i){var t=this.sonification&&this.sonification.instrumentsPlaying,n=t&&Object.keys(t);n&&n.length&&(n.forEach(function(n){t[n].stop(!i,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}var pointSonifyFunctions={pointSonify:pointSonify,pointCancelSonify:pointCancelSonify};export default pointSonifyFunctions;