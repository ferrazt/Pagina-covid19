"use strict";import H from"../Core/Globals.js";var hasTouch=H.hasTouch;import Axis from"../Core/Axis/Axis.js";import AxisDefaults from"../Core/Axis/AxisDefaults.js";import palette from"../Core/Color/Palette.js";import Pointer from"../Core/Pointer.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,relativeLength=U.relativeLength,wrap=U.wrap,AxisResizer=function(){function e(e){this.axis=void 0,this.controlLine=void 0,this.lastPos=void 0,this.options=void 0,this.init(e)}return e.prototype.init=function(e,t){this.axis=e,this.options=e.options.resize,this.render(),t||this.addMouseEvents()},e.prototype.render=function(){var e=this,t=e.axis,o=t.chart,i=e.options,s=i.x||0,r=i.y,n=clamp(t.top+t.height+r,o.plotTop,o.plotTop+o.plotHeight),a={};o.styledMode||(a={cursor:i.cursor,stroke:i.lineColor,"stroke-width":i.lineWidth,dashstyle:i.lineDashStyle}),e.lastPos=n-r,e.controlLine||(e.controlLine=o.renderer.path().addClass("highcharts-axis-resizer")),e.controlLine.add(t.axisGroup),i=o.styledMode?e.controlLine.strokeWidth():i.lineWidth,a.d=o.renderer.crispLine([["M",t.left+s,n],["L",t.left+t.width+s,n]],i),e.controlLine.attr(a)},e.prototype.addMouseEvents=function(){var e,t,o,i=this,s=i.controlLine.element,r=i.axis.chart.container,n=[];i.mouseMoveHandler=e=function(e){i.onMouseMove(e)},i.mouseUpHandler=t=function(e){i.onMouseUp(e)},i.mouseDownHandler=o=function(e){i.onMouseDown(e)},n.push(addEvent(r,"mousemove",e),addEvent(r.ownerDocument,"mouseup",t),addEvent(s,"mousedown",o)),hasTouch&&n.push(addEvent(r,"touchmove",e),addEvent(r.ownerDocument,"touchend",t),addEvent(s,"touchstart",o)),i.eventsToUnbind=n},e.prototype.onMouseMove=function(e){e.touches&&0===e.touches[0].pageX||this.grabbed&&(this.hasDragged=!0,this.updateAxes(this.axis.chart.pointer.normalize(e).chartY-this.options.y))},e.prototype.onMouseUp=function(e){this.hasDragged&&this.updateAxes(this.axis.chart.pointer.normalize(e).chartY-this.options.y),this.grabbed=this.hasDragged=this.axis.chart.activeResizer=null},e.prototype.onMouseDown=function(e){this.axis.chart.pointer.reset(!1,0),this.grabbed=this.axis.chart.activeResizer=!0},e.prototype.updateAxes=function(a){function h(e){return 100*e/f+"%"}function p(e,t,o){return Math.round(clamp(e,t,o))}var c,d=this,l=d.axis.chart,e=d.options.controlledAxis,t=0===e.next.length?[l.yAxis.indexOf(d.axis)+1]:e.next,e=[d.axis].concat(e.prev),u=[],x=!1,v=l.plotTop,f=l.plotHeight,m=v+f;a=clamp(a,v,m),(c=a-d.lastPos)*c<1||([e,t].forEach(function(e,n){e.forEach(function(e,t){var o,i,s=isNumber(e)?l.yAxis[e]:n||t?l.get(e):e,r=s&&s.options;r&&"navigator-y-axis"!==r.id&&(t=s.top,e=Math.round(relativeLength(r.minLength,f)),r=Math.round(relativeLength(r.maxLength,f)),n?(c=a-d.lastPos,i=p(s.len-c,e,r),t=s.top+c,m<t+i&&(a+=o=m-i-t,t+=o),(i=t<v&&m<(t=v)+i?f:i)===e&&(x=!0),u.push({axis:s,options:{top:h(t-v),height:h(i)}})):((i=p(a-t,e,r))===r&&(x=!0),a=t+i,u.push({axis:s,options:{height:h(i)}})))})}),x||(u.forEach(function(e){e.axis.update(e.options,!1)}),l.redraw(!1)))},e.prototype.destroy=function(){var o=this;delete o.axis.resizer,this.eventsToUnbind&&this.eventsToUnbind.forEach(function(e){e()}),o.controlLine.destroy(),objectEach(o,function(e,t){o[t]=null})},e.resizerOptions={minLength:"10%",maxLength:"100%",resize:{controlledAxis:{next:[],prev:[]},enabled:!1,cursor:"ns-resize",lineColor:palette.neutralColor20,lineDashStyle:"Solid",lineWidth:4,x:0,y:0}},e}();Axis.keepProps.push("resizer"),addEvent(Axis,"afterRender",function(){var e=this,t=e.resizer,o=e.options.resize;o&&(o=!1!==o.enabled,t?o?t.init(e,!0):t.destroy():o&&(e.resizer=new AxisResizer(e)))}),addEvent(Axis,"destroy",function(e){!e.keepEvents&&this.resizer&&this.resizer.destroy()}),wrap(Pointer.prototype,"runPointActions",function(e){this.chart.activeResizer||e.apply(this,Array.prototype.slice.call(arguments,1))}),wrap(Pointer.prototype,"drag",function(e){this.chart.activeResizer||e.apply(this,Array.prototype.slice.call(arguments,1))}),merge(!0,AxisDefaults.defaultYAxisOptions,AxisResizer.resizerOptions),H.AxisResizer=AxisResizer;export default H.AxisResizer;