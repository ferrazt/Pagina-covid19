"use strict";import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";import SVGElement from"../Core/Renderer/SVG/SVGElement.js";import SVGLabel from"../Core/Renderer/SVG/SVGLabel.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,pick=U.pick,svgElementBorderUpdateTriggers=["x","y","transform","width","height","r","d","stroke-width"];function addDestroyFocusBorderHook(o){var e;o.focusBorderDestroyHook||(e=o.destroy,o.destroy=function(){return o.focusBorder&&o.focusBorder.destroy&&o.focusBorder.destroy(),e.apply(o,arguments)},o.focusBorderDestroyHook=e)}function removeDestroyFocusBorderHook(o){o.focusBorderDestroyHook&&(o.destroy=o.focusBorderDestroyHook,delete o.focusBorderDestroyHook)}function addUpdateFocusBorderHooks(r){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];r.focusBorderUpdateHooks||(r.focusBorderUpdateHooks={},svgElementBorderUpdateTriggers.forEach(function(o){var o=o+"Setter",e=r[o]||r._defaultSetter;r.focusBorderUpdateHooks[o]=e,r[o]=function(){var o=e.apply(r,arguments);return r.addFocusBorder.apply(r,t),o}}))}function removeUpdateFocusBorderHooks(r){r.focusBorderUpdateHooks&&(Object.keys(r.focusBorderUpdateHooks).forEach(function(o){var e=r.focusBorderUpdateHooks[o];e===r._defaultSetter?delete r[o]:r[o]=e}),delete r.focusBorderUpdateHooks)}extend(SVGElement.prototype,{addFocusBorder:function(o,e){this.focusBorder&&this.removeFocusBorder();var r=this.getBBox(),t=pick(o,3);r.x+=this.translateX||0,r.y+=this.translateY||0;var s=r.x-t,d=r.y-t,i=r.width+2*t,a=r.height+2*t;var n,c,u,h,f,B,l,y=this instanceof SVGLabel;"text"!==this.element.nodeName&&!y||(h=!!this.rotation,n=y?{x:h?1:0,y:0}:(l=B=0,"middle"===(f=this).attr("text-anchor")?(B=H.isFirefox&&f.rotation?.25:.5,l=H.isFirefox&&!f.rotation?.75:.5):f.rotation?B=.25:l=.75,{x:B,y:l}),c=+this.attr("x"),u=+this.attr("y"),isNaN(c)||(s=c-r.width*n.x-t),isNaN(u)||(d=u-r.height*n.y-t),y&&h&&(h=i,i=a,a=h,isNaN(c)||(s=c-r.height*n.x-t),isNaN(u)||(d=u-r.width*n.y-t))),this.focusBorder=this.renderer.rect(s,d,i,a,parseInt((e&&e.r||0).toString(),10)).addClass("highcharts-focus-border").attr({zIndex:99}).add(this.parentGroup),this.renderer.styledMode||this.focusBorder.attr({stroke:e&&e.stroke,"stroke-width":e&&e.strokeWidth}),addUpdateFocusBorderHooks(this,o,e),addDestroyFocusBorderHook(this)},removeFocusBorder:function(){removeUpdateFocusBorderHooks(this),removeDestroyFocusBorderHook(this),this.focusBorder&&(this.focusBorder.destroy(),delete this.focusBorder)}}),Chart.prototype.renderFocusBorder=function(){var o=this.focusElement,e=this.options.accessibility.keyboardNavigation.focusBorder;o&&(o.removeFocusBorder(),e.enabled&&o.addFocusBorder(e.margin,{stroke:e.style.color,strokeWidth:e.style.lineWidth,r:e.style.borderRadius}))},Chart.prototype.setFocusToElement=function(o,e){var r=this.options.accessibility.keyboardNavigation.focusBorder,e=e||o.element;e&&e.focus&&(e.hcEvents&&e.hcEvents.focusin||addEvent(e,"focusin",function(){}),e.focus(),r.hideBrowserFocusOutline&&(e.style.outline="none")),this.focusElement&&this.focusElement.removeFocusBorder(),this.focusElement=o,this.renderFocusBorder()};