"use strict";import Chart from"../../Core/Chart/Chart.js";import U from"../../Core/Utilities.js";var extend=U.extend;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../Utils/HTMLUtilities.js";var removeElement=HTMLUtilities.removeElement,getFakeMouseEvent=HTMLUtilities.getFakeMouseEvent;function getExportMenuButtonElement(t){return t.exportSVGElements&&t.exportSVGElements[0]}function exportingShouldHaveA11y(t){var e=t.options.exporting,t=getExportMenuButtonElement(t);return!!(e&&!1!==e.enabled&&e.accessibility&&e.accessibility.enabled&&t&&t.element)}Chart.prototype.showExportMenu=function(){var t=getExportMenuButtonElement(this);!t||(t=t.element).onclick&&t.onclick(getFakeMouseEvent("click"))},Chart.prototype.hideExportMenu=function(){var t=this,e=t.exportDivElements;e&&t.exportContextMenu&&(e.forEach(function(t){"highcharts-menu-item"===t.className&&t.onmouseout&&t.onmouseout(getFakeMouseEvent("mouseout"))}),t.highlightedExportItemIx=0,t.exportContextMenu.hideMenu(),t.container.focus())},Chart.prototype.highlightExportItem=function(t){var e,o=this.exportDivElements&&this.exportDivElements[t],n=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];return!(!o||"LI"!==o.tagName||o.children&&o.children.length)&&(e=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus,o.focus&&e&&o.focus(),n&&n.onmouseout&&n.onmouseout(getFakeMouseEvent("mouseout")),o.onmouseover&&o.onmouseover(getFakeMouseEvent("mouseover")),this.highlightedExportItemIx=t,!0)},Chart.prototype.highlightLastExportItem=function(){var t,e=this;if(e.exportDivElements)for(t=e.exportDivElements.length;t--;)if(e.highlightExportItem(t))return!0;return!1};var MenuComponent=function(){};MenuComponent.prototype=new AccessibilityComponent,extend(MenuComponent.prototype,{init:function(){var t=this.chart,e=this;this.addEvent(t,"exportMenuShown",function(){e.onMenuShown()}),this.addEvent(t,"exportMenuHidden",function(){e.onMenuHidden()})},onMenuHidden:function(){var t=this.chart.exportContextMenu;t&&t.setAttribute("aria-hidden","true"),this.isExportMenuShown=!1,this.setExportButtonExpandedState("false")},onMenuShown:function(){var t=this.chart,e=t.exportContextMenu;e&&(this.addAccessibleContextMenuAttribs(),unhideChartElementFromAT(t,e)),this.isExportMenuShown=!0,this.setExportButtonExpandedState("true")},setExportButtonExpandedState:function(t){var e=this.exportButtonProxy;e&&e.setAttribute("aria-expanded",t)},onChartRender:function(){var t=this.chart,e=t.options.accessibility;removeElement(this.exportProxyGroup),exportingShouldHaveA11y(t)&&(this.exportProxyGroup=this.addProxyGroup("all"===e.landmarkVerbosity?{"aria-label":t.langFormat("accessibility.exporting.exportRegionLabel",{chart:t}),role:"region"}:{}),e=getExportMenuButtonElement(this.chart),this.exportButtonProxy=this.createProxyButton(e,this.exportProxyGroup,{"aria-label":t.langFormat("accessibility.exporting.menuButtonLabel",{chart:t}),"aria-expanded":!1}))},addAccessibleContextMenuAttribs:function(){var t=this.chart,e=t.exportDivElements;e&&e.length&&(e.forEach(function(t){"LI"!==t.tagName||t.children&&t.children.length?t.setAttribute("aria-hidden","true"):t.setAttribute("tabindex",-1)}),(e=e[0].parentNode).removeAttribute("aria-hidden"),e.setAttribute("aria-label",t.langFormat("accessibility.exporting.chartMenuLabel",{chart:t})))},getKeyboardNavigation:function(){var t=this.keyCodes,o=this.chart,n=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.left,t.up],function(){return n.onKbdPrevious(this)}],[[t.right,t.down],function(){return n.onKbdNext(this)}],[[t.enter,t.space],function(){return n.onKbdClick(this)}]],validate:function(){return o.exportChart&&!1!==o.options.exporting.enabled&&!1!==o.options.exporting.accessibility.enabled},init:function(){var t=n.exportButtonProxy,e=o.exportingGroup;e&&t&&o.setFocusToElement(e,t)},terminate:function(){o.hideExportMenu()}})},onKbdPrevious:function(t){for(var e=this.chart,o=e.options.accessibility,n=t.response,i=e.highlightedExportItemIx||0;i--;)if(e.highlightExportItem(i))return n.success;return o.keyboardNavigation.wrapAround?(e.highlightLastExportItem(),n.success):n.prev},onKbdNext:function(t){for(var e=this.chart,o=e.options.accessibility,n=t.response,i=(e.highlightedExportItemIx||0)+1;i<e.exportDivElements.length;++i)if(e.highlightExportItem(i))return n.success;return o.keyboardNavigation.wrapAround?(e.highlightExportItem(0),n.success):n.next},onKbdClick:function(t){var e=this.chart,o=e.exportDivElements[e.highlightedExportItemIx],n=getExportMenuButtonElement(e).element;return this.isExportMenuShown?this.fakeClickEvent(o):(this.fakeClickEvent(n),e.highlightExportItem(0)),t.response.success}});export default MenuComponent;