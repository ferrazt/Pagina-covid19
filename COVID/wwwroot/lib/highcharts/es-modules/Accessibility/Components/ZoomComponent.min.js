"use strict";import AccessibilityComponent from"../AccessibilityComponent.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import H from"../../Core/Globals.js";var noop=H.noop;import HTMLUtilities from"../Utils/HTMLUtilities.js";var removeElement=HTMLUtilities.removeElement,setElAttrs=HTMLUtilities.setElAttrs;import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";var extend=U.extend,pick=U.pick;function chartHasMapZoom(t){return!!(t.mapZoom&&t.mapNavButtons&&t.mapNavButtons.length)}H.Axis.prototype.panStep=function(t,o){var e=o||3,n=this.getExtremes(),i=(n.max-n.min)/e*t,o=n.max+i,e=n.min+i,i=o-e;t<0&&e<n.dataMin?o=(e=n.dataMin)+i:0<t&&o>n.dataMax&&(e=(o=n.dataMax)-i),this.setExtremes(e,o)};var ZoomComponent=noop;ZoomComponent.prototype=new AccessibilityComponent,extend(ZoomComponent.prototype,{init:function(){var o=this,e=this.chart;["afterShowResetZoom","afterDrilldown","drillupall"].forEach(function(t){o.addEvent(e,t,function(){o.updateProxyOverlays()})})},onChartUpdate:function(){var e=this.chart,n=this;e.mapNavButtons&&e.mapNavButtons.forEach(function(t,o){unhideChartElementFromAT(e,t.element),n.setMapNavButtonAttrs(t.element,"accessibility.zoom.mapZoom"+(o?"Out":"In"))})},setMapNavButtonAttrs:function(t,o){var e=this.chart,e=e.langFormat(o,{chart:e});setElAttrs(t,{tabindex:-1,role:"button","aria-label":e})},onChartRender:function(){this.updateProxyOverlays()},updateProxyOverlays:function(){var t=this.chart;removeElement(this.drillUpProxyGroup),removeElement(this.resetZoomProxyGroup),t.resetZoomButton&&this.recreateProxyButtonAndGroup(t.resetZoomButton,"resetZoomProxyButton","resetZoomProxyGroup",t.langFormat("accessibility.zoom.resetZoomButton",{chart:t})),t.drillUpButton&&this.recreateProxyButtonAndGroup(t.drillUpButton,"drillUpProxyButton","drillUpProxyGroup",t.langFormat("accessibility.drillUpButton",{chart:t,buttonText:t.getDrilldownBackText()}))},recreateProxyButtonAndGroup:function(t,o,e,n){removeElement(this[e]),this[e]=this.addProxyGroup(),this[o]=this.createProxyButton(t,this[e],{"aria-label":n,tabindex:-1})},getMapZoomNavigation:function(){var t=this.keyCodes,o=this.chart,e=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.up,t.down,t.left,t.right],function(t){return e.onMapKbdArrow(this,t)}],[[t.tab],function(t,o){return e.onMapKbdTab(this,o)}],[[t.space,t.enter],function(){return e.onMapKbdClick(this)}]],validate:function(){return chartHasMapZoom(o)},init:function(t){return e.onMapNavInit(t)}})},onMapKbdArrow:function(t,o){var e=this.keyCodes,n=o===e.up||o===e.down?"yAxis":"xAxis",e=o===e.left||o===e.up?-1:1;return this.chart[n][0].panStep(e),t.response.success},onMapKbdTab:function(t,o){var e=this.chart,n=t.response,t=o.shiftKey,o=t&&!this.focusedMapNavButtonIx||!t&&this.focusedMapNavButtonIx;return e.mapNavButtons[this.focusedMapNavButtonIx].setState(0),o?(e.mapZoom(),n[t?"prev":"next"]):(this.focusedMapNavButtonIx+=t?-1:1,t=e.mapNavButtons[this.focusedMapNavButtonIx],e.setFocusToElement(t.box,t.element),t.setState(2),n.success)},onMapKbdClick:function(t){return this.fakeClickEvent(this.chart.mapNavButtons[this.focusedMapNavButtonIx].element),t.response.success},onMapNavInit:function(t){var o=this.chart,e=o.mapNavButtons[0],n=o.mapNavButtons[1],n=0<t?e:n;o.setFocusToElement(n.box,n.element),n.setState(2),this.focusedMapNavButtonIx=0<t?0:1},simpleButtonNavigation:function(t,o,e){var n=this.keyCodes,i=this,r=this.chart;return new KeyboardNavigationHandler(r,{keyCodeMap:[[[n.tab,n.up,n.down,n.left,n.right],function(t,o){t=t===n.tab&&o.shiftKey||t===n.left||t===n.up;return this.response[t?"prev":"next"]}],[[n.space,n.enter],function(){var t=e(this,r);return pick(t,this.response.success)}]],validate:function(){return r[t]&&r[t].box&&i[o]},init:function(){r.setFocusToElement(r[t].box,i[o])}})},getKeyboardNavigation:function(){return[this.simpleButtonNavigation("resetZoomButton","resetZoomProxyButton",function(t,o){o.zoomOut()}),this.simpleButtonNavigation("drillUpButton","drillUpProxyButton",function(t,o){return o.drillUp(),t.response.prev}),this.getMapZoomNavigation()]}});export default ZoomComponent;