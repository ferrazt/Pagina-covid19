"use strict";import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";var doc=H.doc;import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,merge=U.merge,objectEach=U.objectEach,pick=U.pick;import"./MapNavigationOptionsDefault.js";function stopEvent(t){t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)}function MapNavigation(t){this.init(t)}MapNavigation.prototype.init=function(t){(this.chart=t).mapNavButtons=[]},MapNavigation.prototype.update=function(t){function n(t){this.handler.call(h,t),stopEvent(t)}var a,s,d,h=this.chart,r=h.options.mapNavigation,l=h.mapNavButtons;for(t&&(r=h.options.mapNavigation=merge(h.options.mapNavigation,t));l.length;)l.pop().destroy();pick(r.enableButtons,r.enabled)&&!h.renderer.forExport&&objectEach(r.buttons,function(t,e){t=merge(r.buttonOptions,t),!h.styledMode&&t.theme&&((a=t.theme).style=merge(t.theme.style,t.style),d=a.states,s=d&&d.hover,d=d&&d.select,delete a.states);var i,o=h.renderer.button(t.text||"",0,0,n,a,s,d,void 0,"zoomIn"===e?"topbutton":"bottombutton").addClass("highcharts-map-navigation highcharts-"+{zoomIn:"zoom-in",zoomOut:"zoom-out"}[e]).attr({width:t.width,height:t.height,title:h.options.lang[e],padding:t.padding,zIndex:5}).add();o.handler=t.onclick,addEvent(o.element,"dblclick",stopEvent),l.push(o),extend(t,{width:o.width,height:2*o.height}),h.hasLoaded?o.align(t,!1,t.alignTo):i=addEvent(h,"load",function(){o.element&&o.align(t,!1,t.alignTo),i()})}),this.updateEvents(r)},MapNavigation.prototype.updateEvents=function(t){var e=this.chart;pick(t.enableDoubleClickZoom,t.enabled)||t.enableDoubleClickZoomTo?this.unbindDblClick=this.unbindDblClick||addEvent(e.container,"dblclick",function(t){e.pointer.onContainerDblClick(t)}):this.unbindDblClick&&(this.unbindDblClick=this.unbindDblClick()),pick(t.enableMouseWheelZoom,t.enabled)?this.unbindMouseWheel=this.unbindMouseWheel||addEvent(e.container,void 0!==doc.onwheel?"wheel":void 0!==doc.onmousewheel?"mousewheel":"DOMMouseScroll",function(t){return e.pointer.inClass(t.target,"highcharts-no-mousewheel")||(e.pointer.onContainerMouseWheel(t),stopEvent(t)),!1}):this.unbindMouseWheel&&(this.unbindMouseWheel=this.unbindMouseWheel())},extend(Chart.prototype,{fitToBox:function(i,o){return[["x","width"],["y","height"]].forEach(function(t){var e=t[0],t=t[1];i[e]+i[t]>o[e]+o[t]&&(i[t]>o[t]?(i[t]=o[t],i[e]=o[e]):i[e]=o[e]+o[t]-i[t]),i[t]>o[t]&&(i[t]=o[t]),i[e]<o[e]&&(i[e]=o[e])}),i},mapZoom:function(t,e,i,o,n,a){var s=this,d=s.xAxis[0],h=d.max-d.min,r=pick(e,d.min+h/2),l=h*t,p=s.yAxis[0],c=p.max-p.min,u=pick(i,p.min+c/2),m=c*t,h=o?(o-d.pos)/d.len:.5,c=n?(n-p.pos)/p.len:.5,l=s.fitToBox({x:r-l*h,y:u-m*c,width:l,height:m},{x:d.dataMin,y:p.dataMin,width:d.dataMax-d.dataMin,height:p.dataMax-p.dataMin}),m=l.x<=d.dataMin&&l.width>=d.dataMax-d.dataMin&&l.y<=p.dataMin&&l.height>=p.dataMax-p.dataMin;o&&d.mapAxis&&(d.mapAxis.fixTo=[o-d.pos,e]),n&&p.mapAxis&&(p.mapAxis.fixTo=[n-p.pos,i]),void 0===t||m?(d.setExtremes(void 0,void 0,!1),p.setExtremes(void 0,void 0,!1)):(d.setExtremes(l.x,l.x+l.width,!1),p.setExtremes(l.y,l.y+l.height,!1)),s.redraw(a)}}),addEvent(Chart,"beforeRender",function(){this.mapNavigation=new MapNavigation(this),this.mapNavigation.update()}),H.MapNavigation=MapNavigation;