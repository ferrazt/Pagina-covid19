"use strict";import H from"./Globals.js";var win=H.win;import U from"./Utilities.js";var defined=U.defined,error=U.error,extend=U.extend,isObject=U.isObject,merge=U.merge,objectEach=U.objectEach,pad=U.pad,pick=U.pick,splat=U.splat,timeUnits=U.timeUnits,hasNewSafariBug=H.isSafari&&Intl&&Intl.DateTimeFormat.prototype.formatRange,hasOldSafariBug=H.isSafari&&Intl&&!Intl.DateTimeFormat.prototype.formatRange,Time=function(){function e(e){this.options={},this.useUTC=!1,this.variableTimezone=!1,this.Date=win.Date,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.update(e)}return e.prototype.get=function(e,t){if(this.variableTimezone||this.timezoneOffset){var i=t.getTime(),n=i-this.getTimezoneOffset(t);t.setTime(n);n=t["getUTC"+e]();return t.setTime(i),n}return this.useUTC?t["getUTC"+e]():t["get"+e]()},e.prototype.set=function(e,t,i){if(this.variableTimezone||this.timezoneOffset){if("Milliseconds"===e||"Seconds"===e||"Minutes"===e&&this.getTimezoneOffset(t)%36e5==0)return t["setUTC"+e](i);var n=this.getTimezoneOffset(t),s=t.getTime()-n;t.setTime(s),t["setUTC"+e](i);n=this.getTimezoneOffset(t),s=t.getTime()+n;return t.setTime(s)}return this.useUTC||hasNewSafariBug&&"FullYear"===e?t["setUTC"+e](i):t["set"+e](i)},e.prototype.update=function(e){var t=pick(e&&e.useUTC,!0);this.options=e=merge(!0,this.options||{},e),this.Date=e.Date||win.Date||Date,this.useUTC=t,this.timezoneOffset=t&&e.timezoneOffset,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.variableTimezone=t&&!(!e.getTimezoneOffset&&!e.timezone)},e.prototype.makeTime=function(e,t,i,n,s,o){var a,r,m;return this.useUTC?(a=this.Date.UTC.apply(0,arguments),(r=this.getTimezoneOffset(a))!==(m=this.getTimezoneOffset(a+=r))?a+=m-r:r-36e5!==this.getTimezoneOffset(a-36e5)||hasOldSafariBug||(a-=36e5)):a=new this.Date(e,t,pick(i,1),pick(n,0),pick(s,0),pick(o,0)).getTime(),a},e.prototype.timezoneOffsetFunction=function(){var e=this,t=this.options,i=t.moment||win.moment;if(!this.useUTC)return function(e){return 6e4*new Date(e.toString()).getTimezoneOffset()};if(t.timezone){if(i)return function(e){return 6e4*-i.tz(e,t.timezone).utcOffset()};error(25)}return this.useUTC&&t.getTimezoneOffset?function(e){return 6e4*t.getTimezoneOffset(e.valueOf())}:function(){return 6e4*(e.timezoneOffset||0)}},e.prototype.dateFormat=function(i,n,e){if(!defined(n)||isNaN(n))return H.defaultOptions.lang&&H.defaultOptions.lang.invalidDate||"";i=pick(i,"%Y-%m-%d %H:%M:%S");var s=this,t=new this.Date(n),o=this.get("Hours",t),a=this.get("Day",t),r=this.get("Date",t),m=this.get("Month",t),f=this.get("FullYear",t),u=H.defaultOptions.lang,h=u&&u.weekdays,g=u&&u.shortWeekdays,t=extend({a:g?g[a]:h[a].substr(0,3),A:h[a],d:pad(r),e:pad(r,2," "),w:a,b:u.shortMonths[m],B:u.months[m],m:pad(m+1),o:m+1,y:f.toString().substr(2,2),Y:f,H:pad(o),k:o,I:pad(o%12||12),l:o%12||12,M:pad(this.get("Minutes",t)),p:o<12?"AM":"PM",P:o<12?"am":"pm",S:pad(t.getSeconds()),L:pad(Math.floor(n%1e3),3)},H.dateFormats);return objectEach(t,function(e,t){for(;-1!==i.indexOf("%"+t);)i=i.replace("%"+t,"function"==typeof e?e.call(s,n):e)}),e?i.substr(0,1).toUpperCase()+i.substr(1):i},e.prototype.resolveDTLFormat=function(e){return isObject(e,!0)?e:{main:(e=splat(e))[0],from:e[1],to:e[2]}},e.prototype.getTimeTicks=function(e,t,i,n){var s,o=this,a=o.Date,r=[],m={},f=new a(t),u=e.unitRange,h=e.count||1;if(n=pick(n,1),defined(t)){o.set("Milliseconds",f,u>=timeUnits.second?0:h*Math.floor(o.get("Milliseconds",f)/h)),u>=timeUnits.second&&o.set("Seconds",f,u>=timeUnits.minute?0:h*Math.floor(o.get("Seconds",f)/h)),u>=timeUnits.minute&&o.set("Minutes",f,u>=timeUnits.hour?0:h*Math.floor(o.get("Minutes",f)/h)),u>=timeUnits.hour&&o.set("Hours",f,u>=timeUnits.day?0:h*Math.floor(o.get("Hours",f)/h)),u>=timeUnits.day&&o.set("Date",f,u>=timeUnits.month?1:Math.max(1,h*Math.floor(o.get("Date",f)/h))),u>=timeUnits.month&&(o.set("Month",f,u>=timeUnits.year?0:h*Math.floor(o.get("Month",f)/h)),g=o.get("FullYear",f)),u>=timeUnits.year&&o.set("FullYear",f,g-=g%h),u===timeUnits.week&&(a=o.get("Day",f),o.set("Date",f,o.get("Date",f)-a+n+(a<n?-7:0)));var g=o.get("FullYear",f),p=o.get("Month",f),l=o.get("Date",f),T=o.get("Hours",f);t=f.getTime(),!o.variableTimezone&&o.useUTC||!defined(i)||(s=i-t>4*timeUnits.month||o.getTimezoneOffset(t)!==o.getTimezoneOffset(i));for(var d=f.getTime(),c=1;d<i;)r.push(d),u===timeUnits.year?d=o.makeTime(g+c*h,0):u===timeUnits.month?d=o.makeTime(g,p+c*h):!s||u!==timeUnits.day&&u!==timeUnits.week?s&&u===timeUnits.hour&&1<h?d=o.makeTime(g,p,l,T+c*h):d+=u*h:d=o.makeTime(g,p,l+c*h*(u===timeUnits.day?1:7)),c++;r.push(d),u<=timeUnits.hour&&r.length<1e4&&r.forEach(function(e){e%18e5==0&&"000000000"===o.dateFormat("%H%M%S%L",e)&&(m[e]="day")})}return r.info=extend(e,{higherRanks:m,totalRange:u*h}),r},e}();export default Time;