"use strict";var __extends=this&&this.__extends||function(){var s=function(t,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};return function(t,i){function e(){this.constructor=t}s(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();import A from"../Animation/AnimationUtilities.js";var animObject=A.animObject;import Axis from"../Axis/Axis.js";import Chart from"../Chart/Chart.js";import F from"../../Core/FormatUtilities.js";var format=F.format;import D from"../DefaultOptions.js";var getOptions=D.getOptions;import Palette from"../../Core/Color/Palette.js";import Point from"../Series/Point.js";var pointTooltipFormatter=Point.prototype.tooltipFormatter;import Series from"../Series/Series.js";var _a=Series.prototype,seriesInit=_a.init,seriesProcessData=_a.processData;import SVGRenderer from"../Renderer/SVG/SVGRenderer.js";import U from"../Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,defined=U.defined,extend=U.extend,find=U.find,isNumber=U.isNumber,isString=U.isString,merge=U.merge,pick=U.pick,splat=U.splat;import"../Pointer.js";import"../Navigator.js";import"../Scrollbar.js";import"../../Extensions/RangeSelector.js";var StockChart=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return __extends(t,a),t.prototype.init=function(e,t){var s=getOptions(),i=e.xAxis,r=e.yAxis,o=pick(e.navigator&&e.navigator.enabled,s.navigator.enabled,!0);e.xAxis=e.yAxis=void 0;o=merge({chart:{panning:{enabled:!0,type:"x"},pinchType:"x"},navigator:{enabled:o},scrollbar:{enabled:pick(s.scrollbar&&s.scrollbar.enabled,!0)},rangeSelector:{enabled:pick(s.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(s.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},e,{isStock:!0});e.xAxis=i,e.yAxis=r,o.xAxis=splat(e.xAxis||{}).map(function(t,i){return merge(getDefaultAxisOptions("xAxis",t),s.xAxis,s.xAxis&&s.xAxis[i],t,getForcedAxisOptions("xAxis",e))}),o.yAxis=splat(e.yAxis||{}).map(function(t,i){return merge(getDefaultAxisOptions("yAxis",t),s.yAxis,s.yAxis&&s.yAxis[i],t)}),a.prototype.init.call(this,o,t)},t.prototype.createAxis=function(t,i){return i.axis=merge(getDefaultAxisOptions(t,i.axis),i.axis,getForcedAxisOptions(t,this.userOptions)),a.prototype.createAxis.call(this,t,i)},t}(Chart);function getDefaultAxisOptions(t,i){return"xAxis"===t?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0}:"yAxis"===t?{labels:{y:-2},opposite:pick(i.opposite,!0),showLastLabel:!(!i.categories&&"category"!==i.type),title:{text:null}}:{}}function getForcedAxisOptions(t,i){if("xAxis"!==t)return{};var e=getOptions(),t={type:"datetime",categories:void 0};return pick(i.navigator&&i.navigator.enabled,e.navigator.enabled,!0)&&(t.startOnTick=!1,t.endOnTick=!1),t}!function(s){s.stockChart=function(t,i,e){return new s(t,i,e)}}(StockChart=StockChart||{}),addEvent(Series,"setOptions",function(t){var i;this.chart.options.isStock&&(this.is("column")||this.is("columnrange")?i={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(i={marker:{enabled:!1,radius:2}}),i&&(t.plotOptions[this.type]=merge(t.plotOptions[this.type],i)))}),addEvent(Axis,"autoLabelAlign",function(t){var i,e=this.chart,s=this.options,r=e._labelPanes=e._labelPanes||{},e=this.options.labels;this.chart.options.isStock&&"yAxis"===this.coll&&!r[i=s.top+","+s.height]&&e.enabled&&(15===e.x&&(e.x=0),void 0===e.align&&(e.align="right"),r[i]=this,t.align="right",t.preventDefault())}),addEvent(Axis,"destroy",function(){var t=this.chart,i=this.options&&this.options.top+","+this.options.height;i&&t._labelPanes&&t._labelPanes[i]===this&&delete t._labelPanes[i]}),addEvent(Axis,"getPlotLinePath",function(t){var e,s,r,o,a,n,i,l,h=this,p=(this.isLinked&&!this.series?this.linkedParent:this).series,c=h.chart,d=c.renderer,x=h.left,u=h.top,f=[],m=[],g=t.translatedValue,y=t.value,A=t.force;(c.options.isStock&&!1!==t.acrossPanes&&"xAxis"===h.coll||"yAxis"===h.coll)&&(t.preventDefault(),i=h.coll,l="xAxis"===i?"yAxis":"xAxis",i=h.options[l],m=isNumber(i)?[c[l][i]]:isString(i)?[c.get(i)]:p.map(function(t){return t[l]}),(h.isXAxis?c.yAxis:c.xAxis).forEach(function(t){var i;defined(t.options.id)&&-1!==t.options.id.indexOf("navigator")||(i=t.isXAxis?"yAxis":"xAxis",i=defined(t.options[i])?c[i][t.options[i]]:c[i][0],h===i&&m.push(t))}),a=m.length?[]:[(h.isXAxis?c.yAxis:c.xAxis)[0]],m.forEach(function(i){-1!==a.indexOf(i)||find(a,function(t){return t.pos===i.pos&&t.len===i.len})||a.push(i)}),n=pick(g,h.translate(y,null,null,t.old)),isNumber(n)&&(h.horiz?a.forEach(function(t){var i;s=t.pos,o=s+t.len,e=r=Math.round(n+h.transB),"pass"!==A&&(e<x||e>x+h.width)&&(A?e=r=clamp(e,x,x+h.width):i=!0),i||f.push(["M",e,s],["L",r,o])}):a.forEach(function(t){var i;e=t.pos,r=e+t.len,s=o=Math.round(u+h.height-n),"pass"!==A&&(s<u||s>u+h.height)&&(A?s=o=clamp(s,u,u+h.height):i=!0),i||f.push(["M",e,s],["L",r,o])})),t.path=0<f.length?d.crispPolyLine(f,t.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(t,i){for(var e=0;e<t.length;e+=2){var s=t[e],r=t[e+1];s[1]===r[1]&&(s[1]=r[1]=Math.round(s[1])-i%2/2),s[2]===r[2]&&(s[2]=r[2]=Math.round(s[2])+i%2/2)}return t},addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(t){var i,e,s,r,o,a,n,l,h,p,c,d,x,u,f,m,g;this.crosshair&&this.crosshair.label&&this.crosshair.label.enabled&&this.cross&&isNumber(this.min)&&isNumber(this.max)&&(i=this.chart,c=this.logarithmic,e=this.crosshair.label,s=this.horiz,r=this.opposite,p=this.left,n=this.top,o=this.crossLabel,l=e.format,h="",d="inside"===this.options.tickPosition,x=!1!==this.crosshair.snap,u=0,m=t.e||this.cross&&this.cross.e,f=t.point,g=this.min,t=this.max,c&&(g=c.lin2log(g),t=c.lin2log(t)),c=s?"center":r?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",o||(o=this.crossLabel=i.renderer.label("",0,void 0,e.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(f?f.series.colorIndex:this.series[0]&&this.series[0].colorIndex)).attr({align:e.align||c,padding:pick(e.padding,8),r:pick(e.borderRadius,3),zIndex:2}).add(this.labelGroup),i.styledMode||o.attr({fill:e.backgroundColor||f&&f.series&&f.series.color||Palette.neutralColor60,stroke:e.borderColor||"","stroke-width":e.borderWidth||0}).css(extend({color:Palette.backgroundColor,fontWeight:"normal",fontSize:"11px",textAlign:"center"},e.style||{}))),n=s?(a=x?(f.plotX||0)+p:m.chartX,n+(r?0:this.height)):(a=r?this.width+p:0,x?(f.plotY||0)+n:m.chartY),l||e.formatter||(l="{value"+((h=this.dateTime?"%b %d, %Y":h)?":"+h:"")+"}"),m=x?this.isXAxis?f.x:f.y:this.toValue(s?m.chartX:m.chartY),g=f?f.series.isPointInside(f):isNumber(m)&&g<m&&m<t,t="",l?t=format(l,{value:m},i):e.formatter&&isNumber(m)&&(t=e.formatter.call(this,m)),o.attr({text:t,x:a,y:n,visibility:g?"visible":"hidden"}),g=o.getBBox(),isNumber(o.y)&&(s?(d&&!r||!d&&r)&&(n=o.y-g.height):n=o.y-g.height/2),p=s?{left:p-g.x,right:p+this.width-g.x}:{left:"left"===this.labelAlign?p:0,right:"right"===this.labelAlign?p+this.width:i.chartWidth},o.translateX<p.left&&(u=p.left-o.translateX),o.translateX+g.width>=p.right&&(u=-(o.translateX+g.width-p.right)),o.attr({x:a+u,y:n,anchorX:s?a:this.opposite?0:i.chartWidth,anchorY:s?this.opposite?i.chartHeight:0:n+g.height/2}))}),Series.prototype.init=function(){seriesInit.apply(this,arguments),this.initCompare(this.options.compare)},Series.prototype.setCompare=function(t){this.initCompare(t),this.userOptions.compare=t},Series.prototype.initCompare=function(s){this.modifyValue="value"===s||"percent"===s?function(t,i){var e=this.compareValue;return void 0!==t&&void 0!==e?("value"===s?t-=e:t=t/e*100-(100===this.options.compareBase?0:100),i&&(i.change=t),t):0}:null,this.chart.hasRendered&&(this.isDirty=!0)},Series.prototype.processData=function(t){var i,e,s,r,o,a=this,n=-1,l=!0===a.options.compareStart?0:1;if(seriesProcessData.apply(this,arguments),a.xAxis&&a.processedYData)for(e=a.processedXData,r=(s=a.processedYData).length,a.pointArrayMap&&(n=a.pointArrayMap.indexOf(a.options.pointValKey||a.pointValKey||"y")),i=0;i<r-l;i++)if(o=s[i]&&-1<n?s[i][n]:s[i],isNumber(o)&&e[i+l]>=a.xAxis.min&&0!==o){a.compareValue=o;break}},addEvent(Series,"afterGetExtremes",function(t){var i=t.dataExtremes;this.modifyValue&&i&&(t=[this.modifyValue(i.dataMin),this.modifyValue(i.dataMax)],i.dataMin=arrayMin(t),i.dataMax=arrayMax(t))}),Axis.prototype.setCompare=function(i,t){this.isXAxis||(this.series.forEach(function(t){t.setCompare(i)}),pick(t,!0)&&this.chart.redraw())},Point.prototype.tooltipFormatter=function(t){var i=this.series.chart.numberFormatter;return t=t.replace("{point.change}",(0<this.change?"+":"")+i(this.change,pick(this.series.tooltipOptions.changeDecimals,2))),pointTooltipFormatter.apply(this,[t])},addEvent(Series,"render",function(){var t,i,e,s=this.chart;s.is3d&&s.is3d()||s.polar||!this.xAxis||this.xAxis.isRadial||!1===this.options.clip||(e=this.yAxis.len,this.xAxis.axisLine&&(i=s.plotTop+s.plotHeight-this.yAxis.pos-this.yAxis.len,t=Math.floor(this.xAxis.axisLine.strokeWidth()/2),0<=i&&(e-=Math.max(t-i,0))),s.hasLoaded&&(this.clipBox||!this.isDirty||this.isDirtyData)||(this.clipBox=this.clipBox||merge(s.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=e),s.hasRendered&&(t=animObject(this.options.animation),i=this.getSharedClipKey(t),(t=s.sharedClips[i])&&(t.animate({width:this.xAxis.len,height:e}),(i=s.sharedClips[i+"m"])&&i.animate({width:this.xAxis.len}))))}),addEvent(Chart,"update",function(t){t=t.options;"scrollbar"in t&&this.navigator&&(merge(!0,this.options.scrollbar,t.scrollbar),this.navigator.update({},!1),delete t.scrollbar)});export default StockChart;