"use strict";import Axis from"./Axis.js";import Series from"../Series/Series.js";import StackItem from"../../Extensions/Stacking.js";import U from"../Utilities.js";var BrokenAxis,addEvent=U.addEvent,find=U.find,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick;!function(i){function t(){void 0!==this.brokenAxis&&this.brokenAxis.setBreaks(this.options.breaks,!1)}function s(){var i=this;i.brokenAxis&&i.brokenAxis.hasBreaks&&(i.options.ordinal=!1)}function n(){var i=this,r=i.brokenAxis;if(r&&r.hasBreaks){for(var e=i.tickPositions,t=i.tickPositions.info,s=[],n=0;n<e.length;n++)r.isInAnyBreak(e[n])||s.push(e[n]);i.tickPositions=s,i.tickPositions.info=t}}function o(){var i=this;i.brokenAxis||(i.brokenAxis=new r(i))}function a(){var i=this,r=i.isDirty,e=i.options.connectNulls,t=i.points,s=i.xAxis,n=i.yAxis;if(r)for(var o=t.length;o--;){var a=t[o],f=!(null===a.y&&!1===e)&&(s&&s.brokenAxis&&s.brokenAxis.isInAnyBreak(a.x,!0)||n&&n.brokenAxis&&n.brokenAxis.isInAnyBreak(a.y,!0));a.visible=!f&&!1!==a.options.visible}}function f(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,pick(this.pointArrayMap,["y"]))}function k(e,i){var t,s,n,o,r,a=this,f=a.points;e&&e.brokenAxis&&e.brokenAxis.hasBreaks&&(r=e.brokenAxis,i.forEach(function(i){t=r&&r.breakArray||[],s=e.isXAxis?e.min:pick(a.options.threshold,e.min),f.forEach(function(r){o=pick(r["stack"+i.toUpperCase()],r[i]),t.forEach(function(i){isNumber(s)&&isNumber(o)&&(n=!1,s<i.from&&o>i.to||s>i.from&&o<i.from?n="pointBreak":(s<i.from&&o>i.from&&o<i.to||s>i.from&&o>i.to&&o<i.from)&&(n="pointInBreak"),n&&fireEvent(e,n,{point:r,brk:i}))})})}))}function u(){var i=this.currentDataGrouping,i=i&&i.gapSize,r=this.points.slice(),e=this.yAxis,t=this.options.gapSize,s=r.length-1;if(t&&0<s){"value"!==this.options.gapUnit&&(t*=this.basePointRange),i&&t<i&&i>=this.basePointRange&&(t=i);for(var n,o,a=void 0;s--;)a&&!1!==a.visible||(a=r[s+1]),n=r[s],!1!==a.visible&&!1!==n.visible&&(a.x-n.x>t&&(o=(n.x+a.x)/2,r.splice(s+1,0,{isNull:!0,x:o}),e.stacking&&this.options.stacking&&((e.stacking.stacks[this.stackKey][o]=new StackItem(e,e.options.stackLabels,!1,o,this.stack)).total=0)),a=n)}return this.getGraphPath(r)}i.compose=function(i,r){var e;return-1===i.keepProps.indexOf("brokenAxis")&&(i.keepProps.push("brokenAxis"),(e=Series.prototype).drawBreaks=k,e.gappedPath=u,addEvent(i,"init",o),addEvent(i,"afterInit",t),addEvent(i,"afterSetTickPositions",n),addEvent(i,"afterSetOptions",s),addEvent(r,"afterGeneratePoints",a),addEvent(r,"afterRender",f)),i};var r=(h.isInBreak=function(i,r){var e=i.repeat||1/0,t=i.from,s=i.to-i.from,e=t<=r?(r-t)%e:e-(t-r)%e,e=i.inclusive?e<=s:e<s&&0!=e;return e},h.lin2Val=function(i){var r=this.brokenAxis,e=r&&r.breakArray;if(!e||!isNumber(i))return i;for(var t,s=i,n=0;n<e.length&&!((t=e[n]).from>=s);n++)(t.to<s||h.isInBreak(t,s))&&(s+=t.len);return s},h.val2Lin=function(i){var r=this.brokenAxis,e=r&&r.breakArray;if(!e||!isNumber(i))return i;for(var t,s=i,n=0;n<e.length;n++)if((t=e[n]).to<=i)s-=t.len;else{if(t.from>=i)break;if(h.isInBreak(t,i)){s-=i-t.from;break}}return s},h.prototype.findBreakAt=function(r,i){return find(i,function(i){return i.from<r&&r<i.to})},h.prototype.isInAnyBreak=function(i,r){var e,t,s,n=this.axis,o=n.options.breaks||[],a=o.length;if(a&&isNumber(i)){for(;a--;)h.isInBreak(o[a],i)&&(e=!0,t=t||pick(o[a].showPoints,!n.isXAxis));s=e&&r?e&&!t:e}return s},h.prototype.setBreaks=function(i,r){var c=this,p=c.axis,e=isArray(i)&&!!i.length;p.isDirty=c.hasBreaks!==e,c.hasBreaks=e,p.options.breaks=p.userOptions.breaks=i,p.forceRedraw=!0,p.series.forEach(function(i){i.isDirty=!0}),e||p.val2lin!==h.val2Lin||(delete p.val2lin,delete p.lin2val),e&&(p.userOptions.ordinal=!1,p.lin2val=h.lin2Val,p.val2lin=h.val2Lin,p.setExtremes=function(i,r,e,t,s){if(c.hasBreaks){for(var n=this.options.breaks||[],o=void 0;o=c.findBreakAt(i,n);)i=o.to;for(;o=c.findBreakAt(r,n);)r=o.from;r<i&&(r=i)}Axis.prototype.setExtremes.call(this,i,r,e,t,s)},p.setAxisTranslation=function(){var i,r,e,t,s,n,o,a,f,k,u;Axis.prototype.setAxisTranslation.call(this),c.unitLength=void 0,c.hasBreaks&&(i=p.options.breaks||[],r=[],e=[],t=pick(p.pointRangePadding,0),s=0,a=p.userMin||p.min,f=p.userMax||p.max,i.forEach(function(i){o=i.repeat||1/0,isNumber(a)&&isNumber(f)&&(h.isInBreak(i,a)&&(a+=i.to%o-a%o),h.isInBreak(i,f)&&(f-=f%o-i.from%o))}),i.forEach(function(i){if(k=i.from,o=i.repeat||1/0,isNumber(a)&&isNumber(f)){for(;a<k-o;)k-=o;for(;k<a;)k+=o;for(u=k;u<f;u+=o)r.push({value:u,move:"in"}),r.push({value:u+i.to-i.from,move:"out",size:i.breakSize})}}),r.sort(function(i,r){return i.value===r.value?("in"===i.move?0:1)-("in"===r.move?0:1):i.value-r.value}),n=0,k=a,r.forEach(function(i){1===(n+="in"===i.move?1:-1)&&"in"===i.move&&(k=i.value),0===n&&isNumber(k)&&(e.push({from:k,to:i.value,len:i.value-k-(i.size||0)}),s+=i.value-k-(i.size||0))}),c.breakArray=e,isNumber(a)&&isNumber(f)&&isNumber(p.min)&&(c.unitLength=f-a-s+t,fireEvent(p,"afterBreaks"),p.staticScale?p.transA=p.staticScale:c.unitLength&&(p.transA*=(f-p.min+t)/c.unitLength),t&&(p.minPixelPadding=p.transA*(p.minPointOffset||0)),p.min=a,p.max=f))}),pick(r,!0)&&p.chart.redraw()},h);function h(i){this.hasBreaks=!1,this.axis=i}i.Additions=r}(BrokenAxis=BrokenAxis||{});export default BrokenAxis;