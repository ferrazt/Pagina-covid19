"use strict";import Axis from"./Axis.js";import AxisDefaults from"./AxisDefaults.js";import Tick from"./Tick.js";import HiddenAxis from"./HiddenAxis.js";import U from"../Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength,wrap=U.wrap,RadialAxis=function(){function d(){}return d.init=function(i){var e=Axis.prototype;i.setOptions=function(t){t=this.options=merge(i.constructor.defaultOptions,this.defaultPolarOptions,t);t.plotBands||(t.plotBands=[]),fireEvent(this,"afterSetOptions")},i.getOffset=function(){e.getOffset.call(this),this.chart.axisOffset[this.side]=0},i.getLinePath=function(t,i,e){var s,a=this.pane.center,n=this.chart,r=pick(i,a[2]/2-this.offset),o=this.left||0,l=this.top||0;return(e=void 0===e?this.horiz?0:this.center&&-this.center[3]/2:e)&&(r+=e),this.isCircular||void 0!==i?((s=this.chart.renderer.symbols.arc(o+a[0],l+a[1],r,r,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})).xBounds=[o+a[0]],s.yBounds=[l+a[1]-r]):(r=this.postTranslate(this.angleRad,r),s=[["M",this.center[0]+n.plotLeft,this.center[1]+n.plotTop],["L",r.x,r.y]]),s},i.setAxisTranslation=function(){e.setAxisTranslation.call(this),this.center&&(this.isCircular?this.transA=(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.transA=(this.center[2]-this.center[3])/2/(this.max-this.min||1),this.isXAxis?this.minPixelPadding=this.transA*this.minPointOffset:this.minPixelPadding=0)},i.beforeSetTickPositions=function(){this.autoConnect=this.isCircular&&void 0===pick(this.userMax,this.options.max)&&correctFloat(this.endAngleRad-this.startAngleRad)===correctFloat(2*Math.PI),!this.isCircular&&this.chart.inverted&&this.max++,this.autoConnect&&(this.max+=(this.categories?1:this.pointRange)||this.closestPointRange||0)},i.setAxisSize=function(){var t,i;e.setAxisSize.call(this),this.isRadial&&(this.pane.updateCenter(this),t=this.center=this.pane.center.slice(),this.isCircular?this.sector=this.endAngleRad-this.startAngleRad:(i=this.postTranslate(this.angleRad,t[3]/2),t[0]=i.x-this.chart.plotLeft,t[1]=i.y-this.chart.plotTop),this.len=this.width=this.height=(t[2]-t[3])*pick(this.sector,1)/2)},i.getPosition=function(t,i){t=this.translate(t);return this.postTranslate(this.isCircular?t:this.angleRad,pick(this.isCircular?i:t<0?0:t,this.center[2]/2)-this.offset)},i.postTranslate=function(t,i){var e=this.chart,s=this.center;return t=this.startAngleRad+t,{x:e.plotLeft+s[0]+Math.cos(t)*i,y:e.plotTop+s[1]+Math.sin(t)*i}},i.getPlotBandPath=function(t,i,e){var s,a,n,r,o=function(t){if("string"!=typeof t)return t;var i=parseInt(t,10);return i=f.test(t)?i*c/100:i},l=this.center,h=this.startAngleRad,c=l[2]/2,d=Math.min(this.offset,0),p=this.left||0,u=this.top||0,f=/%$/,g=this.isCircular,x=pick(o(e.outerRadius),c),v=o(e.innerRadius),o=pick(o(e.thickness),10);return"polygon"===this.options.gridLineInterpolation?r=this.getPlotLinePath({value:t}).concat(this.getPlotLinePath({value:i,reverse:!0})):(t=Math.max(t,this.min),i=Math.min(i,this.max),t=this.translate(t),i=this.translate(i),g||(x=t||0,v=i||0),"circle"!==e.shape&&g?(a=h+(t||0),s=h+(i||0)):(a=-Math.PI/2,s=1.5*Math.PI,n=!0),o-=d,r=this.chart.renderer.symbols.arc(p+l[0],u+l[1],x-=d,x,{start:Math.min(a,s),end:Math.max(a,s),innerR:pick(v,x-o),open:n}),g&&(a=(s+a)/2,p=p+l[0]+l[2]/2*Math.cos(a),r.xBounds=a>-Math.PI/2&&a<Math.PI/2?[p,this.chart.plotWidth]:[0,p],r.yBounds=[u+l[1]+l[2]/2*Math.sin(a)],r.yBounds[0]+=a>-Math.PI&&a<0||a>Math.PI?-10:10)),r},i.getCrosshairPosition=function(t,i,e){var s,a,n,r=this,o=t.value,l=r.pane.center;return r.isCircular?(defined(o)?t.point&&(t.point.shapeArgs||{}).start&&(o=r.chart.inverted?r.translate(t.point.rectPlotY,!0):t.point.x):(a=t.chartX||0,n=t.chartY||0,o=r.translate(Math.atan2(n-e,a-i)-r.startAngleRad,!0)),a=(s=r.getPosition(o)).x,n=s.y):(defined(o)||(a=t.chartX,n=t.chartY),defined(a)&&defined(n)&&(e=l[1]+r.chart.plotTop,o=r.translate(Math.min(Math.sqrt(Math.pow(a-i,2)+Math.pow(n-e,2)),l[2]/2)-l[3]/2,!0))),[o,a||0,n||0]},i.getPlotLinePath=function(t){var i,e,s,a,n,r=this,o=r.pane.center,l=r.chart,h=l.inverted,c=t.value,d=t.reverse,p=r.getPosition(c),u=r.pane.options.background?r.pane.options.background[0]||r.pane.options.background:{},f=u.innerRadius||"0%",g=u.outerRadius||"100%",x=o[0]+l.plotLeft,v=o[1]+l.plotTop,P=p.x,A=p.y,m=r.height,u=t.isCrosshair,p=o[3]/2;if(u&&(c=(a=this.getCrosshairPosition(t,x,v))[0],P=a[1],A=a[2]),r.isCircular)a=Math.sqrt(Math.pow(P-x,2)+Math.pow(A-v,2)),f="string"==typeof f?relativeLength(f,1):f/a,g="string"==typeof g?relativeLength(g,1):g/a,o&&p&&(f<(a=p/a)&&(f=a),g<a&&(g=a)),n=[["M",x+f*(P-x),v-f*(v-A)],["L",P-(1-g)*(P-x),A+(1-g)*(v-A)]];else if((c=r.translate(c))&&(c<0||m<c)&&(c=0),"circle"===r.options.gridLineInterpolation)n=r.getLinePath(0,c,p);else if(n=[],l[h?"yAxis":"xAxis"].forEach(function(t){t.pane===r.pane&&(i=t)}),i){s=i.tickPositions,i.autoConnect&&(s=s.concat([s[0]])),d&&(s=s.slice().reverse()),c&&(c+=p);for(var R=0;R<s.length;R++)e=i.getPosition(s[R],c),n.push(R?["L",e.x,e.y]:["M",e.x,e.y])}return n},i.getTitlePosition=function(){var t=this.center,i=this.chart,e=this.options.title;return{x:i.plotLeft+t[0]+(e.x||0),y:i.plotTop+t[1]-{high:.5,middle:.25,low:0}[e.align]*t[2]+(e.y||0)}},i.createLabelCollector=function(){var i=this;return function(){if(i.isRadial&&i.tickPositions&&i.options.labels&&!0!==i.options.labels.allowOverlap)return i.tickPositions.map(function(t){return i.ticks[t]&&i.ticks[t].label}).filter(function(t){return Boolean(t)})}}},d.compose=function(t,i){addEvent(t,"init",function(t){var i,e=this,s=e.chart,a=s.inverted,n=s.angular,r=s.polar,o=e.isXAxis,l=e.coll,h=n&&o,c=s.options,t=t.userOptions.pane||0,t=e.pane=s.pane&&s.pane[t];"colorAxis"!==l?(n?((h?HiddenAxis:d).init(e),(i=!o)&&(e.defaultPolarOptions=d.defaultRadialGaugeOptions)):r&&(d.init(e),i=e.horiz,e.defaultPolarOptions=i?d.defaultCircularOptions:merge("xAxis"===l?AxisDefaults.defaultXAxisOptions:AxisDefaults.defaultYAxisOptions,d.defaultRadialOptions),a&&"yAxis"===l&&(e.defaultPolarOptions.stackLabels=AxisDefaults.defaultYAxisOptions.stackLabels,e.defaultPolarOptions.reversedStacks=!0)),n||r?(e.isRadial=!0,c.chart.zoomType=null,e.labelCollector||(e.labelCollector=e.createLabelCollector()),e.labelCollector&&s.labelCollectors.push(e.labelCollector)):this.isRadial=!1,t&&i&&(t.axis=e),e.isCircular=i):this.isRadial=!1}),addEvent(t,"afterInit",function(){var t=this,i=t.chart,e=t.options,s=i.angular&&t.isXAxis,a=t.pane,n=a&&a.options;!s&&a&&(i.angular||i.polar)&&(t.angleRad=(e.angle||0)*Math.PI/180,t.startAngleRad=(n.startAngle-90)*Math.PI/180,t.endAngleRad=(pick(n.endAngle,n.startAngle+360)-90)*Math.PI/180,t.offset=e.offset||0)}),addEvent(t,"autoLabelAlign",function(t){this.isRadial&&(t.align=void 0,t.preventDefault())}),addEvent(t,"destroy",function(){var t,i=this;i.chart&&i.chart.labelCollectors&&(0<=(t=i.labelCollector?i.chart.labelCollectors.indexOf(i.labelCollector):-1)&&i.chart.labelCollectors.splice(t,1))}),addEvent(t,"initialAxisTranslation",function(){this.isRadial&&this.beforeSetTickPositions()}),addEvent(i,"afterGetPosition",function(t){this.axis.getPosition&&extend(t.pos,this.axis.getPosition(this.pos))}),addEvent(i,"afterGetLabelPosition",function(t){var i,e,s,a,n,r,o,l,h,c,d,p,u,f,g=this.axis,x=this.label;x&&(i=x.getBBox(),s=(e=g.options.labels).y,n=20,r=e.align,o=(g.translate(this.pos)+g.startAngleRad+Math.PI/2)/Math.PI*180%360,h="end",d=c=(l=Math.round(o))<0?l+360:l,u=p=0,f=defined(s)?0:.3*-i.height,g.isRadial&&(a=g.getPosition(this.pos,g.center[2]/2+relativeLength(pick(e.distance,-25),g.center[2]/2,-g.center[2]/2)),"auto"===e.rotation?x.attr({rotation:o}):defined(s)||(s=g.chart.renderer.fontMetrics(x.styles&&x.styles.fontSize).b-i.height/2),defined(r)||(r=g.isCircular?(n=i.width>g.len*g.tickInterval/(g.max-g.min)?0:n)<o&&o<180-n?"left":180+n<o&&o<360-n?"right":"center":"center",x.attr({align:r})),"auto"===r&&2===g.tickPositions.length&&g.isCircular&&(90<c&&c<180?c=180-c:270<c&&c<=360&&(c=540-c),g.pane.options.startAngle!==l&&g.pane.options.startAngle!==l+360&&g.pane.options.startAngle!==l-360||(h="start"),r=-90<=l&&l<=90||-360<=l&&l<=-270||270<=l&&l<=360?"start"===h?"right":"left":"start"===h?"left":"right",c<15||180<=c&&c<195?p=.3*i.height:15<=c&&c<=35?p="start"===h?0:.75*i.height:195<=c&&c<=215?p="start"===h?.75*i.height:0:35<c&&c<=90?p="start"===h?.25*-i.height:i.height:215<c&&c<=270&&(p="start"===h?i.height:.25*-i.height),(d=180<d&&d<=360?360-d:d)<15?u="start"===h?.15*-i.height:.15*i.height:165<d&&d<=180&&(u="start"===h?.15*i.height:.15*-i.height),x.attr({align:r=70<d&&d<110?"center":r}),x.translate(u,p+f)),t.pos.x=a.x+(e.x||0),t.pos.y=a.y+(s||0)))}),wrap(i.prototype,"getMarkPath",function(t,i,e,s,a,n,r){var o=this.axis,r=o.isRadial?["M",i,e,"L",(o=o.getPosition(this.pos,o.center[2]/2+s)).x,o.y]:t.call(this,i,e,s,a,n,r);return r})},d.defaultCircularOptions={gridLineWidth:1,labels:{align:void 0,distance:15,x:0,y:void 0,style:{textOverflow:"none"}},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},d.defaultRadialGaugeOptions={labels:{align:"center",x:0,y:void 0},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},d.defaultRadialOptions={gridLineInterpolation:"circle",gridLineWidth:1,labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},d}();RadialAxis.compose(Axis,Tick);export default RadialAxis;