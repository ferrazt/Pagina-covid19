"use strict";import Axis from"./Axis.js";import AxisDefaults from"./AxisDefaults.js";import H from"../Globals.js";var dateFormats=H.dateFormats;import U from"../Utilities.js";var GridAxis,addEvent=U.addEvent,defined=U.defined,erase=U.erase,find=U.find,isArray=U.isArray,isNumber=U.isNumber,merge=U.merge,pick=U.pick,timeUnits=U.timeUnits,wrap=U.wrap;function argsToArray(t){return Array.prototype.slice.call(t,1)}function isObject(t){return U.isObject(t,!0)}function applyGridOptions(t){var i=t.options;i.labels.align=pick(i.labels.align,"center"),t.categories||(i.showLastLabel=!1),t.labelRotation=0,i.labels.rotation=0}!function(x){var t;function r(r,t){var n={width:0,height:0};return t.forEach(function(t){var i,e=r[t],t=0;isObject(e)&&(i=(e=isObject(e.label)?e.label:{}).getBBox?e.getBBox().height:0,e.textStr&&!isNumber(e.textPxLength)&&(e.textPxLength=e.getBBox().width),t=isNumber(e.textPxLength)?Math.round(e.textPxLength):0,e.textStr&&(t=Math.round(e.getBBox().width)),n.height=Math.max(i,n.height),n.width=Math.max(t,n.width))}),"treegrid"===this.options.type&&this.treeGrid&&this.treeGrid.mapOfPosToGridNode&&(t=this.treeGrid.mapOfPosToGridNode[-1].height||0,n.width+=this.options.labels.indentation*(t-1)),n}function n(){var t=this.grid;(t&&t.columns||[]).forEach(function(t){t.getOffset()})}function o(t){var i,e,r,n,o,s,a,d,l,h,c,g,f,u,p=this;!0===(p.options.grid||{}).enabled&&(u=p.axisTitle,i=p.height,e=p.horiz,r=p.left,n=p.offset,o=p.opposite,s=p.options,a=p.top,d=p.width,l=p.tickSize(),h=u&&u.getBBox().width,c=s.title.x,g=s.title.y,f=pick(s.title.margin,e?5:10),u=p.chart.renderer.fontMetrics(s.title.style.fontSize,u).f,p=(e?a+i:r)+(e?1:-1)*(o?-1:1)*(l?l[0]/2:0)+(p.side===x.Side.bottom?u:0),t.titlePosition.x=e?r-(h||0)/2-f+c:p+(o?d:0)+n+c,t.titlePosition.y=e?p-(o?i:0)+(o?u:-u)/2+n+g:a-f+g)}function s(){var t=this,i=t.chart,e=t.options.grid,r=void 0===e?{}:e,n=t.userOptions;if(r.enabled&&applyGridOptions(t),r.columns)for(var o=t.grid.columns=[],s=t.grid.columnIndex=0;++s<r.columns.length;){var a=merge(n,r.columns[r.columns.length-s-1],{linkedTo:0,type:"category",scrollbar:{enabled:!1}});delete a.grid.columns;a=new Axis(t.chart,a);a.grid.isColumn=!0,a.grid.columnIndex=s,erase(i.axes,a),erase(i[t.coll],a),o.push(a)}}function a(){var t,i,e,r,n,o,s,a=this,d=a.grid,l=a.options;!0===(l.grid||{}).enabled&&(t=a.min||0,i=a.max||0,a.maxLabelDimensions=a.getMaxLabelDimensions(a.ticks,a.tickPositions),a.rightWall&&a.rightWall.destroy(),a.grid&&a.grid.isOuterAxis()&&a.axisLine&&((r=l.lineWidth)&&(n=(s=a.getLinePath(r))[0],e=s[1],r=((a.tickSize("tick")||[1])[0]-1)*(a.side===x.Side.top||a.side===x.Side.left?-1:1),"M"===n[0]&&"L"===e[0]&&(a.horiz?(n[2]+=r,e[2]+=r):(n[1]+=r,e[1]+=r)),!a.horiz&&a.chart.marginRight&&(n=[n,["L",a.left,n[2]||0]],o=["L",a.chart.chartWidth-a.chart.marginRight,a.toPixels(i+a.tickmarkOffset)],o=[["M",e[1]||0,a.toPixels(i+a.tickmarkOffset)],o],a.grid.upperBorder||t%1==0||(a.grid.upperBorder=a.grid.renderBorder(n)),a.grid.upperBorder&&(a.grid.upperBorder.attr({stroke:l.lineColor,"stroke-width":l.lineWidth}),a.grid.upperBorder.animate({d:n})),a.grid.lowerBorder||i%1==0||(a.grid.lowerBorder=a.grid.renderBorder(o)),a.grid.lowerBorder&&(a.grid.lowerBorder.attr({stroke:l.lineColor,"stroke-width":l.lineWidth}),a.grid.lowerBorder.animate({d:o}))),a.grid.axisLineExtra?(a.grid.axisLineExtra.attr({stroke:l.lineColor,"stroke-width":l.lineWidth}),a.grid.axisLineExtra.animate({d:s})):a.grid.axisLineExtra=a.grid.renderBorder(s),a.axisLine[a.showAxis?"show":"hide"](!0))),(d&&d.columns||[]).forEach(function(t){t.render()}),!a.horiz&&a.chart.hasRendered&&(a.scrollbar||a.linkedParent&&a.linkedParent.scrollbar)&&(o=a.tickmarkOffset,l=a.tickPositions[a.tickPositions.length-1],s=a.tickPositions[0],(d=a.ticks[s].label)&&(o<t-s?d.hide():d.show()),(d=a.ticks[l].label)&&(o<l-i?d.hide():d.show()),(d=a.ticks[l].mark)&&(l-i<o&&0<l-i&&a.ticks[l].isLast?d.hide():a.ticks[l-1]&&d.show())))}function d(){var t=this,i=t.tickPositions&&t.tickPositions.info,e=t.options,r=e.grid||{},n=t.userOptions.labels||{};r.enabled&&(t.horiz?(t.series.forEach(function(t){t.options.pointRange=0}),i&&e.dateTimeLabelFormats&&e.labels&&!defined(n.align)&&(!1===e.dateTimeLabelFormats[i.unitName].range||1<i.count)&&(e.labels.align="left",defined(n.x)||(e.labels.x=3))):"treegrid"!==this.options.type&&t.grid&&t.grid.columns&&(this.minPointOffset=this.tickInterval))}function l(t){var l,i=this.options,e=t.userOptions,t=i&&isObject(i.grid)?i.grid:{};!0===t.enabled&&(l=merge(!0,{className:"highcharts-grid-axis "+(e.className||""),dateTimeLabelFormats:{hour:{list:["%H:%M","%H"]},day:{list:["%A, %e. %B","%a, %e. %b","%E"]},week:{list:["Week %W","W%W"]},month:{list:["%B","%b","%o"]}},grid:{borderWidth:1},labels:{padding:2,style:{fontSize:"13px"}},margin:0,title:{text:null,reserveSpace:!1,rotation:0},units:[["millisecond",[1,10,100]],["second",[1,10]],["minute",[1,5,15]],["hour",[1,6]],["day",[1]],["week",[1]],["month",[1]],["year",null]]},e),"xAxis"===this.coll&&(defined(e.linkedTo)&&!defined(e.tickPixelInterval)&&(l.tickPixelInterval=350),defined(e.tickPixelInterval)||!defined(e.linkedTo)||defined(e.tickPositioner)||defined(e.tickInterval)||(l.tickPositioner=function(t,i){var e=this.linkedParent&&this.linkedParent.tickPositions&&this.linkedParent.tickPositions.info;if(e){for(var r=l.units||[],n=void 0,o=void 0,s=void 0,a=0;a<r.length;a++)if(r[a][0]===e.unitName){n=a;break}r[n+1]?(s=r[n+1][0],o=(r[n+1][1]||[1])[0]):"year"===e.unitName&&(s="year",o=10*e.count);var d=timeUnits[s];return this.tickInterval=d*o,this.getTimeTicks({unitRange:d,count:o,unitName:s},t,i,this.options.startOfWeek)}})),merge(!0,this.options,l),this.horiz&&(i.minPadding=pick(e.minPadding,0),i.maxPadding=pick(e.maxPadding,0)),isNumber(i.grid.borderWidth)&&(i.tickWidth=i.lineWidth=t.borderWidth))}function h(t){var i=t.userOptions,t=i&&i.grid||{},i=t.columns;t.enabled&&i&&merge(!0,this.options,i[i.length-1])}function c(){(this.grid.columns||[]).forEach(function(t){t.setScale()})}function g(t){var i=AxisDefaults.defaultLeftAxisOptions,e=this.horiz,r=this.maxLabelDimensions,n=this.options.grid,n=void 0===n?{}:n;n.enabled&&r&&(i=2*Math.abs(i.labels.x),r=e?n.cellHeight||i+r.height:i+r.width,isArray(t.tickSize)?t.tickSize[0]=r:t.tickSize=[r,0])}function f(){this.axes.forEach(function(t){(t.grid&&t.grid.columns||[]).forEach(function(t){t.setAxisSize(),t.setAxisTranslation()})})}function u(i){var t=this.grid;(t.columns||[]).forEach(function(t){t.destroy(i.keepEvents)}),t.columns=void 0}function p(t){var i=t.userOptions||{},t=i.grid||{};t.enabled&&defined(t.borderColor)&&(i.tickColor=i.lineColor=t.borderColor),this.grid||(this.grid=new e(this))}function m(t){var i,e,r,n,o=this.label,s=this.axis,a=s.reversed,d=s.chart,l=s.options.grid||{},h=s.options.labels,c=h.align,g=x.Side[s.side],f=t.tickmarkOffset,u=s.tickPositions,p=this.pos-f,m=isNumber(u[t.index+1])?u[t.index+1]-f:(s.max||0)+f,u=s.tickSize("tick"),f=u?u[0]:0,u=u?u[1]/2:0;!0===l.enabled&&("top"===g?e=(i=s.top+s.offset)-f:"bottom"===g?i=(e=d.chartHeight-s.bottom+s.offset)+f:(i=s.top+s.len-(s.translate(a?m:p)||0),e=s.top+s.len-(s.translate(a?p:m)||0)),"right"===g?n=(r=d.chartWidth-s.right+s.offset)+f:"left"===g?r=(n=s.left+s.offset)-f:(r=Math.round(s.left+(s.translate(a?m:p)||0))-u,n=Math.min(Math.round(s.left+(s.translate(a?p:m)||0))-u,s.left+s.len)),this.slotWidth=n-r,t.pos.x="left"===c?r:"right"===c?n:r+(n-r)/2,t.pos.y=e+(i-e)/2,d=d.renderer.fontMetrics(h.style.fontSize,o&&o.element),o=o?o.getBBox().height:0,h.useHTML?t.pos.y+=d.b+-o/2:(o=Math.round(o/d.h),t.pos.y+=(d.b-(d.h-d.f))/2+-((o-1)*d.h)/2),t.pos.x+=s.horiz&&h.x||0)}function k(t){var i,e,r,n,o,s=t.axis,a=t.value;s.options.grid&&s.options.grid.enabled&&(n=s.tickPositions,i=(s.linkedParent||s).series[0],e=a===n[0],r=a===n[n.length-1],o=void 0,(n=i&&find(i.options.data,function(t){return t[s.isXAxis?"x":"y"]===a}))&&i.is("gantt")&&(o=merge(n),H.seriesTypes.gantt.prototype.pointClass.setGanttPointAliases(o)),t.isFirst=e,t.isLast=r,t.point=o)}function b(){var t=this,i=t.options,e=i.grid||{},r=t.categories,n=t.tickPositions,o=n[0],s=n[n.length-1],a=t.linkedParent&&t.linkedParent.min,d=t.linkedParent&&t.linkedParent.max,l=a||t.min,a=d||t.max,d=t.tickInterval,s=a<s&&s-d<a;!0!==e.enabled||r||!t.horiz&&!t.isLinked||(o<l&&l<o+d&&!i.startOnTick&&(n[0]=l),s&&!i.endOnTick&&(n[n.length-1]=a))}function v(t){var i=this.options.grid;return!0===(void 0===i?{}:i).enabled&&this.categories?this.tickInterval:t.apply(this,argsToArray(arguments))}(t=x.Side||(x.Side={}))[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left",x.compose=function(t,i,e){return-1===t.keepProps.indexOf("grid")&&(t.keepProps.push("grid"),t.prototype.getMaxLabelDimensions=r,wrap(t.prototype,"unsquish",v),addEvent(t,"init",p),addEvent(t,"afterGetOffset",n),addEvent(t,"afterGetTitlePosition",o),addEvent(t,"afterInit",s),addEvent(t,"afterRender",a),addEvent(t,"afterSetAxisTranslation",d),addEvent(t,"afterSetOptions",l),addEvent(t,"afterSetOptions",h),addEvent(t,"afterSetScale",c),addEvent(t,"afterTickSize",g),addEvent(t,"trimTicks",b),addEvent(t,"destroy",u)),addEvent(i,"afterSetChartSize",f),addEvent(e,"afterGetLabelPosition",m),addEvent(e,"labelFormat",k),t};var e=(i.prototype.isOuterAxis=function(){var e=this.axis,t=e.chart,i=e.grid.columnIndex,r=e.linkedParent&&e.linkedParent.grid.columns||e.grid.columns,n=i?e.linkedParent:e,o=-1,s=0;return t[e.coll].forEach(function(t,i){t.side!==e.side||t.options.isInternal||(s=i,t===n&&(o=i))}),s===o&&(!isNumber(i)||r.length===i)},i.prototype.renderBorder=function(t){var i=this.axis,e=i.chart.renderer,r=i.options,i=e.path(t).addClass("highcharts-axis-line").add(i.axisBorder);return e.styledMode||i.attr({stroke:r.lineColor,"stroke-width":r.lineWidth,zIndex:7}),i},i);function i(t){this.axis=t}x.Additions=e}(GridAxis=GridAxis||{}),dateFormats.E=function(t){return this.dateFormat("%a",t,!0).charAt(0)},dateFormats.W=function(t){var i=new this.Date(t),e=(this.get("Day",i)+6)%7,t=new this.Date(i.valueOf());this.set("Date",t,this.get("Date",i)-e+3);e=new this.Date(this.get("FullYear",t),0,1);return 4!==this.get("Day",e)&&(this.set("Month",i,0),this.set("Date",i,1+(11-this.get("Day",e))%7)),(1+Math.floor((t.valueOf()-e.valueOf())/6048e5)).toString()};export default GridAxis;