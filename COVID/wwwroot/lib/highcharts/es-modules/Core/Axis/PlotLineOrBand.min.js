"use strict";import Axis from"./Axis.js";import palette from"../../Core/Color/Palette.js";import U from"../Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,PlotLineOrBand=function(){function t(t,e){this.axis=t,e&&(this.options=e,this.id=e.id)}return t.prototype.render=function(){fireEvent(this,"render");var i=this,t=i.axis,e=t.horiz,n=t.logarithmic,r=i.options,o=r.label,s=i.label,a=r.to,d=r.from,l=r.value,h=defined(d)&&defined(a),c=defined(l),p=i.svgElem,f=!p,u=[],L=r.color,g=pick(r.zIndex,0),P=r.events,m={class:"highcharts-plot-"+(h?"band ":"line ")+(r.className||"")},x={},y=t.chart.renderer,v=h?"bands":"lines";if(n&&(d=n.log2lin(d),a=n.log2lin(a),l=n.log2lin(l)),t.chart.styledMode||(c?(m.stroke=L||palette.neutralColor40,m["stroke-width"]=pick(r.width,1),r.dashStyle&&(m.dashstyle=r.dashStyle)):h&&(m.fill=L||palette.highlightColor10,r.borderWidth&&(m.stroke=r.borderColor,m["stroke-width"]=r.borderWidth))),x.zIndex=g,(L=t.plotLinesAndBandsGroups[v+="-"+g])||(t.plotLinesAndBandsGroups[v]=L=y.g("plot-"+v).attr(x).add()),f&&(i.svgElem=p=y.path().attr(m).add(L)),c)u=t.getPlotLinePath({value:l,lineWidth:p.strokeWidth(),acrossPanes:r.acrossPanes});else{if(!h)return;u=t.getPlotBandPath(d,a,r)}return!i.eventsAdded&&P&&(objectEach(P,function(t,e){p.on(e,function(t){P[e].apply(i,[t])})}),i.eventsAdded=!0),(f||!p.d)&&u&&u.length?p.attr({d:u}):p&&(u?(p.show(!0),p.animate({d:u})):p.d&&(p.hide(),s&&(i.label=s=s.destroy()))),o&&(defined(o.text)||defined(o.formatter))&&u&&u.length&&0<t.width&&0<t.height&&!u.isFlat?(o=merge({align:e&&h&&"center",x:e?!h&&4:10,verticalAlign:!e&&h&&"middle",y:e?h?16:10:h?6:-4,rotation:e&&!h&&90},o),this.renderLabel(o,u,h,g)):s&&s.hide(),i},t.prototype.renderLabel=function(t,e,i,n){var r,o,s=this,a=s.label,d=s.axis.chart.renderer;a||((r={align:t.textAlign||t.align,rotation:t.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(t.className||"")}).zIndex=n,o=this.getLabelText(t),s.label=a=d.text(o,0,0,t.useHTML).attr(r).add(),this.axis.chart.styledMode||a.css(t.style)),o=e.xBounds||[e[0][1],e[1][1],(i?e[2]:e[0])[1]],r=e.yBounds||[e[0][2],e[1][2],(i?e[2]:e[0])[2]],i=arrayMin(o),e=arrayMin(r),a.align(t,!1,{x:i,y:e,width:arrayMax(o)-i,height:arrayMax(r)-e}),a.show(!0)},t.prototype.getLabelText=function(t){return defined(t.formatter)?t.formatter.call(this):t.text},t.prototype.destroy=function(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)},t}();extend(Axis.prototype,{getPlotBandPath:function(t,e,i){void 0===i&&(i=this.options);var n,r,o=this.getPlotLinePath({value:e,force:!0,acrossPanes:i.acrossPanes}),s=this.getPlotLinePath({value:t,force:!0,acrossPanes:i.acrossPanes}),a=[],d=this.horiz,l=1,e=!isNumber(this.min)||!isNumber(this.max)||t<this.min&&e<this.min||t>this.max&&e>this.max;if(s&&o)for(e&&(r=s.toString()===o.toString(),l=0),n=0;n<s.length;n+=2){var h=s[n],c=s[n+1],p=o[n],f=o[n+1];"M"!==h[0]&&"L"!==h[0]||"M"!==c[0]&&"L"!==c[0]||"M"!==p[0]&&"L"!==p[0]||"M"!==f[0]&&"L"!==f[0]||(d&&p[1]===h[1]?(p[1]+=l,f[1]+=l):d||p[2]!==h[2]||(p[2]+=l,f[2]+=l),a.push(["M",h[1],h[2]],["L",c[1],c[2]],["L",f[1],f[2]],["L",p[1],p[2]],["Z"])),a.isFlat=r}else s=null;return a},addPlotBand:function(t){return this.addPlotBandOrLine(t,"plotBands")},addPlotLine:function(t){return this.addPlotBandOrLine(t,"plotLines")},addPlotBandOrLine:function(t,e){var i,n=this,r=new PlotLineOrBand(this,t),o=this.userOptions;return(r=this.visible?r.render():r)&&(this._addedPlotLB||(this._addedPlotLB=!0,(o.plotLines||[]).concat(o.plotBands||[]).forEach(function(t){n.addPlotBandOrLine(t)})),e&&((i=o[e]||[]).push(t),o[e]=i),this.plotLinesAndBands.push(r)),r},removePlotBandOrLine:function(e){var t=this.plotLinesAndBands,i=this.options,n=this.userOptions;if(t){for(var r=t.length;r--;)t[r].id===e&&t[r].destroy();[i.plotLines||[],n.plotLines||[],i.plotBands||[],n.plotBands||[]].forEach(function(t){for(r=t.length;r--;)(t[r]||{}).id===e&&erase(t,t[r])})}},removePlotBand:function(t){this.removePlotBandOrLine(t)},removePlotLine:function(t){this.removePlotBandOrLine(t)}});export default PlotLineOrBand;