"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import H from"../../Globals.js";var isFirefox=H.isFirefox,isMS=H.isMS,isWebKit=H.isWebKit,win=H.win;import SVGElement from"../SVG/SVGElement.js";import U from"../../Utilities.js";var css=U.css,defined=U.defined,extend=U.extend,pick=U.pick,pInt=U.pInt,HTMLElement=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.compose=function(t){var e=t.prototype,t=o.prototype;e.getSpanCorrection=t.getSpanCorrection,e.htmlCss=t.htmlCss,e.htmlGetBBox=t.htmlGetBBox,e.htmlUpdateTransform=t.htmlUpdateTransform,e.setSpanRotation=t.setSpanRotation},o.prototype.getSpanCorrection=function(t,e,o){this.xCorr=-t*o,this.yCorr=-e},o.prototype.htmlCss=function(t){var e,o=this,n="SPAN"===o.element.tagName&&t&&"width"in t,i=pick(n&&t.width,void 0);return n&&(delete t.width,o.textWidth=i,e=!0),t&&"ellipsis"===t.textOverflow&&(t.whiteSpace="nowrap",t.overflow="hidden"),o.styles=extend(o.styles,t),css(o.element,t),e&&o.htmlUpdateTransform(),o},o.prototype.htmlGetBBox=function(){var t=this.element;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}},o.prototype.htmlUpdateTransform=function(){var t,e,o,n,i,r,s,a,d,l,p,f,h,c;this.added?(e=(t=this).renderer,o=t.element,n=t.translateX||0,i=t.translateY||0,r=t.x||0,s=t.y||0,d={left:0,center:.5,right:1}[a=t.textAlign||"left"],c=t.styles,l=c&&c.whiteSpace,css(o,{marginLeft:n,marginTop:i}),!e.styledMode&&t.shadows&&t.shadows.forEach(function(t){css(t,{marginLeft:n+1,marginTop:i+1})}),t.inverted&&[].forEach.call(o.childNodes,function(t){e.invertChild(t,o)}),"SPAN"===o.tagName&&(p=t.rotation,f=t.textWidth&&pInt(t.textWidth),h=[p,a,o.innerHTML,t.textWidth,t.textAlign].join(","),c=void 0,f!==t.oldTextWidth&&(f>t.oldTextWidth||(t.textPxLength||(css(o,{width:"",whiteSpace:l||"nowrap"}),o.offsetWidth))>f)&&(/[ \-]/.test(o.textContent||o.innerText)||"ellipsis"===o.style.textOverflow)?(css(o,{width:f+"px",display:"block",whiteSpace:l||"normal"}),t.oldTextWidth=f,t.hasBoxWidthChanged=!0):t.hasBoxWidthChanged=!1,h!==t.cTT&&(c=e.fontMetrics(o.style.fontSize,o).b,!defined(p)||p===(t.oldRotation||0)&&a===t.oldAlign||t.setSpanRotation(p,d,c),t.getSpanCorrection(!defined(p)&&t.textPxLength||o.offsetWidth,c,d,p,a)),css(o,{left:r+(t.xCorr||0)+"px",top:s+(t.yCorr||0)+"px"}),t.cTT=h,t.oldRotation=p,t.oldAlign=a)):this.alignOnAdd=!0},o.prototype.setSpanRotation=function(t,e,o){var n={},i=isMS&&!/Edge/.test(win.navigator.userAgent)?"-ms-transform":isWebKit?"-webkit-transform":isFirefox?"MozTransform":win.opera?"-o-transform":void 0;i&&(n[i]=n.transform="rotate("+t+"deg)",n[i+(isFirefox?"Origin":"-origin")]=n.transformOrigin=100*e+"% "+o+"px",css(this.element,n))},o}(SVGElement);export default HTMLElement;