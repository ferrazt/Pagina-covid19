"use strict";import AST from"../HTML/AST.js";import Color from"../../Color/Color.js";import H from"../../Globals.js";var charts=H.charts,deg2rad=H.deg2rad,doc=H.doc,isFirefox=H.isFirefox,isMS=H.isMS,isWebKit=H.isWebKit,noop=H.noop,SVG_NS=H.SVG_NS,symbolSizes=H.symbolSizes,win=H.win;import Palette from"../../Color/Palette.js";import RendererRegistry from"../RendererRegistry.js";import SVGElement from"./SVGElement.js";import SVGLabel from"./SVGLabel.js";import Symbols from"./Symbols.js";import TextBuilder from"./TextBuilder.js";import U from"../../Utilities.js";var hasInternalReferenceBug,addEvent=U.addEvent,attr=U.attr,createElement=U.createElement,css=U.css,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,pick=U.pick,pInt=U.pInt,uniqueKey=U.uniqueKey,SVGRenderer=function(){function t(t,e,i,r,n,o,s){this.alignedObjects=void 0,this.box=void 0,this.boxWrapper=void 0,this.cache=void 0,this.cacheKeys=void 0,this.chartIndex=void 0,this.defs=void 0,this.globalAnimation=void 0,this.gradients=void 0,this.height=void 0,this.imgCount=void 0,this.isSVG=void 0,this.style=void 0,this.url=void 0,this.width=void 0,this.init(t,e,i,r,n,o,s)}return t.prototype.init=function(t,e,i,r,n,o,s){var a,l=this,h=l.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),d=h.element;s||h.css(this.getStyle(r)),t.appendChild(d),attr(t,"dir","ltr"),-1===t.innerHTML.indexOf("xmlns")&&attr(d,"xmlns",this.SVG_NS),l.isSVG=!0,this.box=d,this.boxWrapper=h,l.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(doc.createTextNode("Created with Highcharts 9.1.2")),l.defs=this.createElement("defs").add(),l.allowHTML=o,l.forExport=n,l.styledMode=s,l.gradients={},l.cache={},l.cacheKeys=[],l.imgCount=0,l.setSize(e,i,!1),isFirefox&&t.getBoundingClientRect&&((i=function(){css(t,{left:0,top:0}),a=t.getBoundingClientRect(),css(t,{left:Math.ceil(a.left)-a.left+"px",top:Math.ceil(a.top)-a.top+"px"})})(),l.unSubPixelFix=addEvent(win,"resize",i))},t.prototype.definition=function(t){return new AST([t]).addToDOM(this.defs.element)},t.prototype.getReferenceURL=function(){var t,e;if((isFirefox||isWebKit)&&doc.getElementsByTagName("base").length&&(defined(hasInternalReferenceBug)||(e=uniqueKey(),t=new AST([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:e},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":"url(#"+e+")",fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(doc.body),css(t,{position:"fixed",top:0,left:0,zIndex:9e5}),e=doc.elementFromPoint(6,6),hasInternalReferenceBug="hitme"===(e&&e.id),doc.body.removeChild(t)),hasInternalReferenceBug))return win.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20");return""},t.prototype.getStyle=function(t){return this.style=extend({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},t),this.style},t.prototype.setStyle=function(t){this.boxWrapper.css(this.getStyle(t))},t.prototype.isHidden=function(){return!this.boxWrapper.getBBox().width},t.prototype.destroy=function(){var t=this,e=t.defs;return t.box=null,t.boxWrapper=t.boxWrapper.destroy(),destroyObjectProperties(t.gradients||{}),t.gradients=null,e&&(t.defs=e.destroy()),t.unSubPixelFix&&t.unSubPixelFix(),t.alignedObjects=null},t.prototype.createElement=function(t){var e=new this.Element;return e.init(this,t),e},t.prototype.getRadialAttr=function(t,e){return{cx:t[0]-t[2]/2+(e.cx||0)*t[2],cy:t[1]-t[2]/2+(e.cy||0)*t[2],r:(e.r||0)*t[2]}},t.prototype.buildText=function(t){new TextBuilder(t).buildSVG()},t.prototype.getContrast=function(t){return(t=Color.parse(t).rgba)[0]*=1,t[1]*=1.2,t[2]*=.5,459<t[0]+t[1]+t[2]?"#000000":"#FFFFFF"},t.prototype.button=function(t,e,i,r,n,o,s,a,l,h){var d,c,u,p,m=this.label(t,e,i,l,void 0,void 0,h,void 0,"button"),g=this.styledMode,f=0,n=(y=n?merge(n):{})&&y.style||{},y=AST.filterUserAttributes(y);return m.attr(merge({padding:8,r:2},y)),g||(y=merge({fill:Palette.neutralColor3,stroke:Palette.neutralColor20,"stroke-width":1,style:{color:Palette.neutralColor80,cursor:"pointer",fontWeight:"normal"}},{style:n},y),d=y.style,delete y.style,o=merge(y,{fill:Palette.neutralColor10},AST.filterUserAttributes(o||{})),c=o.style,delete o.style,s=merge(y,{fill:Palette.highlightColor10,style:{color:Palette.neutralColor100,fontWeight:"bold"}},AST.filterUserAttributes(s||{})),u=s.style,delete s.style,a=merge(y,{style:{color:Palette.neutralColor20}},AST.filterUserAttributes(a||{})),p=a.style,delete a.style),addEvent(m.element,isMS?"mouseover":"mouseenter",function(){3!==f&&m.setState(1)}),addEvent(m.element,isMS?"mouseout":"mouseleave",function(){3!==f&&m.setState(f)}),m.setState=function(t){1!==t&&(m.state=f=t),m.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),g||m.attr([y,o,s,a][t||0]).css([d,c,u,p][t||0])},g||m.attr(y).css(extend({cursor:"default"},d)),m.on("touchstart",function(t){return t.stopPropagation()}).on("click",function(t){3!==f&&r.call(m,t)})},t.prototype.crispLine=function(t,e,i){void 0===i&&(i="round");var r=t[0],n=t[1];return defined(r[1])&&r[1]===n[1]&&(r[1]=n[1]=Math[i](r[1])-e%2/2),defined(r[2])&&r[2]===n[2]&&(r[2]=n[2]=Math[i](r[2])+e%2/2),t},t.prototype.path=function(t){var e=this.styledMode?{}:{fill:"none"};return isArray(t)?e.d=t:isObject(t)&&extend(e,t),this.createElement("path").attr(e)},t.prototype.circle=function(t,e,i){e=isObject(t)?t:void 0===t?{}:{x:t,y:e,r:i},i=this.createElement("circle");return i.xSetter=i.ySetter=function(t,e,i){i.setAttribute("c"+e,t)},i.attr(e)},t.prototype.arc=function(t,e,i,r,n,o){isObject(t)?(e=(s=t).y,i=s.r,r=s.innerR,n=s.start,o=s.end,t=s.x):s={innerR:r,start:n,end:o};var s=this.symbol("arc",t,e,i,i,s);return s.r=i,s},t.prototype.rect=function(t,e,i,r,n,o){n=isObject(t)?t.r:n;var s=this.createElement("rect"),r=isObject(t)?t:void 0===t?{}:{x:t,y:e,width:Math.max(i,0),height:Math.max(r,0)};return this.styledMode||(void 0!==o&&(r["stroke-width"]=o,r=s.crisp(r)),r.fill="none"),n&&(r.r=n),s.rSetter=function(t,e,i){s.r=t,attr(i,{rx:t,ry:t})},s.rGetter=function(){return s.r||0},s.attr(r)},t.prototype.setSize=function(t,e,i){this.width=t,this.height=e,this.boxWrapper.animate({width:t,height:e},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:pick(i,!0)?void 0:0}),this.alignElements()},t.prototype.g=function(t){var e=this.createElement("g");return t?e.attr({class:"highcharts-"+t}):e},t.prototype.image=function(e,t,i,r,n,o){function s(t,e){t.setAttributeNS?t.setAttributeNS("http://www.w3.org/1999/xlink","href",e):t.setAttribute("hc-svg-href",e)}var a={preserveAspectRatio:"none"};1<arguments.length&&extend(a,{x:t,y:i,width:r,height:n});var l=this.createElement("image").attr(a),n=function(t){s(l.element,e),o.call(l,t)};return o?(s(l.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),a=new win.Image,addEvent(a,"load",n),a.src=e,a.complete&&n({})):s(l.element,e),l},t.prototype.symbol=function(t,e,i,r,n,o){var s,a,l,h,d=this,c=/^url\((.*?)\)$/,u=c.test(t),p=!u&&(this.symbols[t]?t:"circle"),m=p&&this.symbols[p];return m?("number"==typeof e&&(s=m.call(this.symbols,Math.round(e||0),Math.round(i||0),r||0,n||0,o)),s=this.path(s),d.styledMode||s.attr("fill","none"),extend(s,{symbolName:p||void 0,x:e,y:i,width:r,height:n}),o&&extend(s,o)):u&&(l=t.match(c)[1],(h=s=this.image(l)).imgwidth=pick(symbolSizes[l]&&symbolSizes[l].width,o&&o.width),h.imgheight=pick(symbolSizes[l]&&symbolSizes[l].height,o&&o.height),a=function(t){return t.attr({width:t.width,height:t.height})},["width","height"].forEach(function(t){h[t+"Setter"]=function(t,e){var i=this["img"+e];this[e]=t,defined(i)&&(o&&"within"===o.backgroundSize&&this.width&&this.height&&(i=Math.round(i*Math.min(this.width/this.imgwidth,this.height/this.imgheight))),this.element&&this.element.setAttribute(e,i),this.alignByTranslate||(i=((this[e]||0)-i)/2,this.attr("width"===e?{translateX:i}:{translateY:i})))}}),defined(e)&&h.attr({x:e,y:i}),h.isImg=!0,defined(h.imgwidth)&&defined(h.imgheight)?a(h):(h.attr({width:0,height:0}),createElement("img",{onload:function(){var t=charts[d.chartIndex];0===this.width&&(css(this,{position:"absolute",top:"-999em"}),doc.body.appendChild(this)),symbolSizes[l]={width:this.width,height:this.height},h.imgwidth=this.width,h.imgheight=this.height,h.element&&a(h),this.parentNode&&this.parentNode.removeChild(this),d.imgCount--,d.imgCount||!t||t.hasLoaded||t.onload()},src:l}),this.imgCount++)),s},t.prototype.clipRect=function(t,e,i,r){var n=uniqueKey()+"-",o=this.createElement("clipPath").attr({id:n}).add(this.defs),r=this.rect(t,e,i,r,0).add(o);return r.id=n,r.clipPath=o,r.count=0,r},t.prototype.text=function(t,e,i,r){var n={};if(r&&(this.allowHTML||!this.forExport))return this.html(t,e,i);n.x=Math.round(e||0),i&&(n.y=Math.round(i)),defined(t)&&(n.text=t);n=this.createElement("text").attr(n);return r||(n.xSetter=function(t,e,i){for(var r=i.getElementsByTagName("tspan"),n=i.getAttribute(e),o=0,s=void 0;o<r.length;o++)(s=r[o]).getAttribute(e)===n&&s.setAttribute(e,t);i.setAttribute(e,t)}),n},t.prototype.fontMetrics=function(t,e){t=!this.styledMode&&/px/.test(t)||!win.getComputedStyle?t||e&&e.style&&e.style.fontSize||this.style&&this.style.fontSize:e&&SVGElement.prototype.getStyle.call(e,"font-size");e=(t=/px/.test(t)?pInt(t):12)<24?t+3:Math.round(1.2*t);return{h:e,b:Math.round(.8*e),f:t}},t.prototype.rotCorr=function(t,e,i){var r=t;return e&&i&&(r=Math.max(r*Math.cos(e*deg2rad),4)),{x:-t/3*Math.sin(e*deg2rad),y:r}},t.prototype.pathToSegments=function(t){for(var e=[],i=[],r={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2},n=0;n<t.length;n++)isString(i[0])&&isNumber(t[n])&&i.length===r[i[0].toUpperCase()]&&t.splice(n,0,i[0].replace("M","L").replace("m","l")),"string"==typeof t[n]&&(i.length&&e.push(i.slice(0)),i.length=0),i.push(t[n]);return e.push(i.slice(0)),e},t.prototype.label=function(t,e,i,r,n,o,s,a,l){return new SVGLabel(this,t,e,i,r,n,o,s,a,l)},t.prototype.alignElements=function(){this.alignedObjects.forEach(function(t){return t.align()})},t}();extend(SVGRenderer.prototype,{Element:SVGElement,SVG_NS:SVG_NS,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Symbols,draw:noop}),RendererRegistry.registerRendererType("svg",SVGRenderer,!0);export default SVGRenderer;