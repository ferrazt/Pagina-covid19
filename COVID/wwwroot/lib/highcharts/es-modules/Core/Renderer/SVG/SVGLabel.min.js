var __extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import SVGElement from"./SVGElement.js";import U from"../../Utilities.js";var defined=U.defined,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent,SVGLabel=function(c){function g(t,e,i,s,o,h,n,r,d,a){var x,p=c.call(this)||this;return p.paddingLeftSetter=p.paddingSetter,p.paddingRightSetter=p.paddingSetter,p.init(t,"g"),p.textStr=e,p.x=i,p.y=s,p.anchorX=h,p.anchorY=n,p.baseline=d,p.className=a,p.addClass("button"===a?"highcharts-no-tooltip":"highcharts-label"),a&&p.addClass("highcharts-"+a),p.text=t.text("",0,0,r).attr({zIndex:1}),"string"==typeof o&&((x=/^url\((.*?)\)$/.test(o))||p.renderer.symbols[o])&&(p.symbolKey=o),p.bBox=g.emptyBBox,p.padding=3,p.baselineOffset=0,p.needsBox=t.styledMode||x,p.deferredAttr={},p.alignFactor=0,p}return __extends(g,c),g.prototype.alignSetter=function(t){t={left:0,center:.5,right:1}[t];t!==this.alignFactor&&(this.alignFactor=t,this.bBox&&isNumber(this.xSetting)&&this.attr({x:this.xSetting}))},g.prototype.anchorXSetter=function(t,e){this.anchorX=t,this.boxAttr(e,Math.round(t)-this.getCrispAdjust()-this.xSetting)},g.prototype.anchorYSetter=function(t,e){this.anchorY=t,this.boxAttr(e,t-this.ySetting)},g.prototype.boxAttr=function(t,e){this.box?this.box.attr(t,e):this.deferredAttr[t]=e},g.prototype.css=function(e){var i,t;return e&&(i={},e=merge(e),g.textProps.forEach(function(t){void 0!==e[t]&&(i[t]=e[t],delete e[t])}),this.text.css(i),t="width"in i,"fontSize"in i||"fontWeight"in i?this.updateTextPadding():t&&this.updateBoxSize()),SVGElement.prototype.css.call(this,e)},g.prototype.destroy=function(){removeEvent(this.element,"mouseenter"),removeEvent(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),SVGElement.prototype.destroy.call(this)},g.prototype.fillSetter=function(t,e){t&&(this.needsBox=!0),this.fill=t,this.boxAttr(e,t)},g.prototype.getBBox=function(){this.textStr&&0===this.bBox.width&&0===this.bBox.height&&this.updateBoxSize();var t=this.padding,e=pick(this.paddingLeft,t);return{width:this.width,height:this.height,x:this.bBox.x-e,y:this.bBox.y-t}},g.prototype.getCrispAdjust=function(){return this.renderer.styledMode&&this.box?this.box.strokeWidth()%2/2:(this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2},g.prototype.heightSetter=function(t){this.heightSetting=t},g.prototype.on=function(e,i){var t,s=this,o=s.text,h=o&&"SPAN"===o.element.tagName?o:void 0;return h&&(t=function(t){("mouseenter"===e||"mouseleave"===e)&&t.relatedTarget instanceof Element&&(s.element.compareDocumentPosition(t.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY||h.element.compareDocumentPosition(t.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)||i.call(s.element,t)},h.on(e,t)),SVGElement.prototype.on.call(s,e,t||i),s},g.prototype.onAdd=function(){var t=this.textStr;this.text.add(this),this.attr({text:defined(t)?t:"",x:this.x,y:this.y}),this.box&&defined(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})},g.prototype.paddingSetter=function(t,e){isNumber(t)?t!==this[e]&&(this[e]=t,this.updateTextPadding()):this[e]=void 0},g.prototype.rSetter=function(t,e){this.boxAttr(e,t)},g.prototype.shadow=function(t){return t&&!this.renderer.styledMode&&(this.updateBoxSize(),this.box&&this.box.shadow(t)),this},g.prototype.strokeSetter=function(t,e){this.stroke=t,this.boxAttr(e,t)},g.prototype["stroke-widthSetter"]=function(t,e){t&&(this.needsBox=!0),this["stroke-width"]=t,this.boxAttr(e,t)},g.prototype["text-alignSetter"]=function(t){this.textAlign=t},g.prototype.textSetter=function(t){void 0!==t&&this.text.attr({text:t}),this.updateTextPadding()},g.prototype.updateBoxSize=function(){var t=this.text.element.style,e={},i=this.padding,s=this.bBox=isNumber(this.widthSetting)&&isNumber(this.heightSetting)&&!this.textAlign||!defined(this.text.textStr)?g.emptyBBox:this.text.getBBox();this.width=this.getPaddedWidth(),this.height=(this.heightSetting||s.height||0)+2*i;var o,t=this.renderer.fontMetrics(t&&t.fontSize,this.text);this.baselineOffset=i+Math.min((this.text.firstLineMetrics||t).b,s.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-t.h)/2),this.needsBox&&(this.box||((o=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect()).addClass(("button"===this.className?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),o.add(this)),o=this.getCrispAdjust(),e.x=o,e.y=(this.baseline?-this.baselineOffset:0)+o,e.width=Math.round(this.width),e.height=Math.round(this.height),this.box.attr(extend(e,this.deferredAttr)),this.deferredAttr={})},g.prototype.updateTextPadding=function(){var t=this.text;this.updateBoxSize();var e=this.baseline?0:this.baselineOffset,i=pick(this.paddingLeft,this.padding);defined(this.widthSetting)&&this.bBox&&("center"===this.textAlign||"right"===this.textAlign)&&(i+={center:.5,right:1}[this.textAlign]*(this.widthSetting-this.bBox.width)),i===t.x&&e===t.y||(t.attr("x",i),t.hasBoxWidthChanged&&(this.bBox=t.getBBox(!0)),void 0!==e&&t.attr("y",e)),t.x=i,t.y=e},g.prototype.widthSetter=function(t){this.widthSetting=isNumber(t)?t:void 0},g.prototype.getPaddedWidth=function(){var t=this.padding,e=pick(this.paddingLeft,t),t=pick(this.paddingRight,t);return(this.widthSetting||this.bBox.width||0)+e+t},g.prototype.xSetter=function(t){this.x=t,this.alignFactor&&(t-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(t),this.attr("translateX",this.xSetting)},g.prototype.ySetter=function(t){this.ySetting=this.y=Math.round(t),this.attr("translateY",this.ySetting)},g.emptyBBox={width:0,height:0,x:0,y:0},g.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","textAlign","textDecoration","textOutline","textOverflow","width"],g}(SVGElement);export default SVGLabel;