"use strict";var __extends=this&&this.__extends||function(){var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};return function(t,i){function e(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();import Axis from"../../Core/Axis/Axis.js";import BubblePoint from"./BubblePoint.js";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var noop=H.noop;import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var _a=SeriesRegistry.seriesTypes,ColumnSeries=_a.column,ScatterSeries=_a.scatter;import U from"../../Core/Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,pInt=U.pInt;import"../Column/ColumnSeries.js";import"../Scatter/ScatterSeries.js";import"./BubbleLegend.js";var BubbleSeries=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.data=void 0,t.maxPxSize=void 0,t.minPxSize=void 0,t.options=void 0,t.points=void 0,t.radii=void 0,t.yData=void 0,t.zData=void 0,t}return __extends(t,a),t.prototype.animate=function(t){!t&&this.points.length<this.options.animationLimit&&this.points.forEach(function(t){var i=t.graphic;i&&i.width&&(this.hasRendered||i.attr({x:t.plotX,y:t.plotY,width:1,height:1}),i.animate(this.markerAttribs(t),this.options.animation))},this)},t.prototype.getRadii=function(t,i,e){for(var r,o=this.zData,a=this.yData,s=e.minPxSize,n=e.maxPxSize,l=[],p=0,h=o.length;p<h;p++)r=o[p],l.push(this.getRadius(t,i,s,n,r,a[p]));this.radii=l},t.prototype.getRadius=function(t,i,e,r,o,a){var s=this.options,n="width"!==s.sizeBy,l=s.zThreshold,p=i-t,h=.5;if(null===a||null===o)return null;if(isNumber(o)){if(s.sizeByAbsoluteValue&&(o=Math.abs(o-l),i=p=Math.max(i-l,Math.abs(t-l)),t=0),o<t)return e/2-1;0<p&&(h=(o-t)/p)}return n&&0<=h&&(h=Math.sqrt(h)),Math.ceil(e+h*(r-e))/2},t.prototype.hasData=function(){return!!this.processedXData.length},t.prototype.pointAttribs=function(t,i){var e=this.options.marker.fillOpacity,i=Series.prototype.pointAttribs.call(this,t,i);return 1!==e&&(i.fill=color(i.fill).setOpacity(e).get("rgba")),i},t.prototype.translate=function(){var t,i,e,r=this.data,o=this.radii;for(a.prototype.translate.call(this),t=r.length;t--;)i=r[t],e=o?o[t]:0,isNumber(e)&&e>=this.minPxSize/2?(i.marker=extend(i.marker,{radius:e,width:2*e,height:2*e}),i.dlBox={x:i.plotX-e,y:i.plotY-e,width:2*e,height:2*e}):i.shapeArgs=i.plotY=i.dlBox=void 0},t.defaultOptions=merge(ScatterSeries.defaultOptions,{dataLabels:{formatter:function(){return this.point.z},inside:!0,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"}),t}(ScatterSeries);extend(BubbleSeries.prototype,{alignDataLabel:ColumnSeries.prototype.alignDataLabel,applyZones:noop,bubblePadding:!0,buildKDTree:noop,directTouch:!0,isBubble:!0,pointArrayMap:["y","z"],pointClass:BubblePoint,parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",zoneAxis:"z"}),Axis.prototype.beforePadding=function(){var o=this,t=this.len,i=this.chart,a=0,s=t,n=this.isXAxis,l=n?"xData":"yData",p=this.min,h={},u=Math.min(i.plotWidth,i.plotHeight),m=Number.MAX_VALUE,d=-Number.MAX_VALUE,c=this.max-p,b=t/c,e=[];this.series.forEach(function(t){var r=t.options;!t.bubblePadding||!t.visible&&i.options.chart.ignoreHiddenSeries||(o.allowZoomOutside=!0,e.push(t),n&&(["minSize","maxSize"].forEach(function(t){var i=r[t],e=/%$/.test(i),i=pInt(i);h[t]=e?u*i/100:i}),t.minPxSize=h.minSize,t.maxPxSize=Math.max(h.maxSize,h.minSize),(t=t.zData.filter(isNumber)).length&&(m=pick(r.zMin,clamp(arrayMin(t),!1===r.displayNegative?r.zThreshold:-Number.MAX_VALUE,m)),d=pick(r.zMax,Math.max(d,arrayMax(t))))))}),e.forEach(function(t){var i,e=t[l],r=e.length;if(n&&t.getRadii(m,d,t),0<c)for(;r--;)isNumber(e[r])&&o.dataMin<=e[r]&&e[r]<=o.max&&(i=t.radii?t.radii[r]:0,a=Math.min((e[r]-p)*b-i,a),s=Math.max((e[r]-p)*b+i,s))}),e.length&&0<c&&!this.logarithmic&&(s-=t,b*=(t+Math.max(0,a)-Math.min(s,t))/t,[["min","userMin",a],["max","userMax",s]].forEach(function(t){void 0===pick(o.options[t[0]],o[t[1]])&&(o[t[0]]+=t[2]/b)}))},SeriesRegistry.registerSeriesType("bubble",BubbleSeries);export default BubbleSeries;