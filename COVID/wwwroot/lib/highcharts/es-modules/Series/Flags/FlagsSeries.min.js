"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import FlagsPoint from"./FlagsPoint.js";import H from"../../Core/Globals.js";var noop=H.noop;import OnSeriesMixin from"../../Mixins/OnSeries.js";import palette from"../../Core/Color/Palette.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,ColumnSeries=SeriesRegistry.seriesTypes.column;import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,extend=U.extend,merge=U.merge,objectEach=U.objectEach,wrap=U.wrap;import"./FlagsSymbols.js";var FlagsSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.animate=function(t){t&&this.setClip()},t.prototype.drawPoints=function(){for(var t,e,o,r,i,s,n,a,l=this,p=l.points,h=l.chart,c=h.renderer,d=h.inverted,u=l.options,g=u.y,f=l.yAxis,y={},m=[],v=p.length;v--;)r=p[v],n=(d?r.plotY:r.plotX)>l.xAxis.len,t=r.plotX,i=r.stackIndex,o=r.options.shape||u.shape,void 0!==(e=r.plotY)&&(e=r.plotY+g-(void 0!==i&&i*u.stackDistance)),r.anchorX=i?void 0:r.plotX,s=i?void 0:r.plotY,a="flag"!==o,i=r.graphic,void 0!==e&&0<=t&&!n?((i=i&&r.hasNewShapeType()?i.destroy():i)||(i=r.graphic=c.label("",null,null,o,null,null,u.useHTML).addClass("highcharts-point").add(l.markerGroup),r.graphic.div&&(r.graphic.div.point=r),i.isNew=!0),i.attr({align:a?"center":"left",width:u.width,height:u.height,"text-align":u.textAlign}),h.styledMode||i.attr(l.pointAttribs(r)).css(merge(u.style,r.style)).shadow(u.shadow),0<t&&(t-=i.strokeWidth()%2),s={y:e,anchorY:s},u.allowOverlapX&&(s.x=t,s.anchorX=r.anchorX),i.attr({text:r.options.title||u.title||"A"})[i.isNew?"attr":"animate"](s),u.allowOverlapX||(y[r.plotX]?y[r.plotX].size=Math.max(y[r.plotX].size,i.width):y[r.plotX]={align:a?.5:0,size:i.width,target:t,anchorX:t}),r.tooltipPos=[t,e+f.pos-h.plotTop]):i&&(r.graphic=i.destroy());u.allowOverlapX||(objectEach(y,function(t){t.plotX=t.anchorX,m.push(t)}),H.distribute(m,(d?f:this.xAxis).len,100),p.forEach(function(t){var e=t.graphic&&y[t.plotX];e&&(t.graphic[t.graphic.isNew?"attr":"animate"]({x:e.pos+e.align*e.size,anchorX:t.anchorX}),defined(e.pos)?t.graphic.isNew=!1:(t.graphic.attr({x:-9999,anchorX:-9999}),t.graphic.isNew=!0))})),u.useHTML&&wrap(l.markerGroup,"on",function(t){return SVGElement.prototype.on.apply(t.apply(this,[].slice.call(arguments,1)),[].slice.call(arguments,1))})},t.prototype.drawTracker=function(){var o=this.points;e.prototype.drawTracker.call(this),o.forEach(function(e){var t=e.graphic;t&&(e.unbindMouseOver&&e.unbindMouseOver(),e.unbindMouseOver=addEvent(t.element,"mouseover",function(){0<e.stackIndex&&!e.raised&&(e._y=t.y,t.attr({y:e._y-8}),e.raised=!0),o.forEach(function(t){t!==e&&t.raised&&t.graphic&&(t.graphic.attr({y:t._y}),t.raised=!1)})}))})},t.prototype.pointAttribs=function(t,e){var o=this.options,r=t&&t.color||this.color,i=o.lineColor,s=t&&t.lineWidth,t=t&&t.fillColor||o.fillColor;return e&&(t=o.states[e].fillColor,i=o.states[e].lineColor,s=o.states[e].lineWidth),{fill:t||r,stroke:i||r,"stroke-width":s||o.lineWidth||0}},t.prototype.setClip=function(){Series.prototype.setClip.apply(this,arguments),!1!==this.options.clip&&this.sharedClipKey&&this.markerGroup&&this.markerGroup.clip(this.chart.sharedClips[this.sharedClipKey])},t.defaultOptions=merge(ColumnSeries.defaultOptions,{pointRange:0,allowOverlapX:!1,shape:"flag",stackDistance:12,textAlign:"center",tooltip:{pointFormat:"{point.text}"},threshold:null,y:-30,fillColor:palette.backgroundColor,lineWidth:1,states:{hover:{lineColor:palette.neutralColor100,fillColor:palette.highlightColor20}},style:{fontSize:"11px",fontWeight:"bold"}}),t}(ColumnSeries);extend(FlagsSeries.prototype,{allowDG:!1,buildKDTree:noop,forceCrop:!0,getPlotBox:OnSeriesMixin.getPlotBox,init:Series.prototype.init,invertGroups:noop,invertible:!1,noSharedTooltip:!0,pointClass:FlagsPoint,sorted:!1,takeOrdinalPosition:!1,trackerGroups:["markerGroup"],translate:OnSeriesMixin.translate}),SeriesRegistry.registerSeriesType("flags",FlagsSeries);export default FlagsSeries;