import PolygonMixin from"../../Mixins/Polygon.js";var isPolygonsColliding=PolygonMixin.isPolygonsColliding,movePolygon=PolygonMixin.movePolygon;import U from"../../Core/Utilities.js";var WordcloudUtils,extend=U.extend,find=U.find,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge;!function(t){function l(t,i){return!(i.left>t.right||i.right<t.left||i.top>t.bottom||i.bottom<t.top)}function g(o,t){function e(t){var i=l(r,t.rect);return i=i&&(o.rotation%90||t.rotation%90)?isPolygonsColliding(n,t.polygon):i}var i=!1,r=o.rect,n=o.polygon,a=o.lastCollidedWith;return a&&((i=e(a))||delete o.lastCollidedWith),i=i||!!find(t,function(t){var i=e(t);return i&&(o.lastCollidedWith=t),i})}function o(t,i){function o(t){return"boolean"==typeof t}var e=4*t,r=Math.ceil((Math.sqrt(e)-1)/2),n=2*r+1,a=Math.pow(n,2),l=!1;return--n,t<=1e4&&(o(l)&&a-n<=e&&(l={x:r-(a-e),y:-r}),a-=n,o(l)&&a-n<=e&&(l={x:-r,y:a-e-r}),a-=n,(l=o(l)?a-n<=e?{x:a-e-r,y:r}:{x:r,y:r-(a-e-n)}:l).x*=5,l.y*=5),l}function d(t,i){var o=-i.width/2,e=i.width/2,r=-i.height/2,i=i.height/2;return!(o<t.left&&e>t.right&&r<t.top&&i>t.bottom)}t.isRectanglesIntersecting=l,t.intersectsAnyWord=g,t.archimedeanSpiral=function(t,i){var o=i.field,e=!1,i=o.width*o.width+o.height*o.height,o=.8*t;return t<=1e4&&(e={x:o*Math.cos(o),y:o*Math.sin(o)},Math.min(Math.abs(e.x),Math.abs(e.y))<i||(e=!1)),e},t.squareSpiral=o,t.rectangularSpiral=function(t,i){return t=o(t),i=i.field,t&&(t.x*=i.ratioX,t.y*=i.ratioY),t},t.getRandomPosition=function(t){return Math.round(t*(Math.random()+.5)/2)},t.getScale=function(t,i,o){var e=2*Math.max(Math.abs(o.top),Math.abs(o.bottom)),o=2*Math.max(Math.abs(o.left),Math.abs(o.right));return Math.min(0<o?1/o*t:1,0<e?1/e*i:1)},t.getPlayingField=function(t,i,o){var e=o.reduce(function(t,i){var o=i.dimensions,i=Math.max(o.width,o.height);return t.maxHeight=Math.max(t.maxHeight,o.height),t.maxWidth=Math.max(t.maxWidth,o.width),t.area+=i*i,t},{maxHeight:0,maxWidth:0,area:0});return{width:(o=Math.max(e.maxHeight,e.maxWidth,.85*Math.sqrt(e.area)))*(e=i<t?t/i:1),height:o*(t=t<i?i/t:1),ratioX:e,ratioY:t}},t.getRotation=function(t,i,o,e){var r=!1;return r=isNumber(t)&&isNumber(i)&&isNumber(o)&&isNumber(e)&&0<t&&-1<i&&o<e?o+i%t*((e-o)/(t-1||1)):r},t.getSpiral=function(t,i){for(var o=[],e=1;e<1e4;e++)o.push(t(e,i));return function(t){return t<=1e4&&o[t-1]}},t.outsidePlayingField=d,t.intersectionTesting=function(t,i){var o=i.placed,e=i.field,r=i.rectangle,n=i.polygon,a=i.spiral,l=1,h={x:0,y:0},u=t.rect=extend({},r);for(t.polygon=n,t.rotation=i.rotation;!1!==h&&(g(t,o)||d(u,e));)h=a(l),isObject(h)&&(u.left=r.left+h.x,u.right=r.right+h.x,u.top=r.top+h.y,u.bottom=r.bottom+h.y,t.polygon=movePolygon(h.x,h.y,n)),l++;return h},t.extendPlayingField=function(t,i){var o,e,r;return t=isObject(t)&&isObject(i)?(r=i.bottom-i.top,o=i.right-i.left,e=t.ratioX,i=t.ratioY,merge(t,{width:t.width+2*((r=r*i<o*e?o:r)*e),height:t.height+2*(r*i)})):t},t.updateFieldBoundaries=function(t,i){return(!isNumber(t.left)||t.left>i.left)&&(t.left=i.left),(!isNumber(t.right)||t.right<i.right)&&(t.right=i.right),(!isNumber(t.top)||t.top>i.top)&&(t.top=i.top),(!isNumber(t.bottom)||t.bottom<i.bottom)&&(t.bottom=i.bottom),t}}(WordcloudUtils=WordcloudUtils||{});export default WordcloudUtils;