"use strict";var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();import H from"../../Core/Globals.js";var noop=H.noop;import PolygonMixin from"../../Mixins/Polygon.js";var getBoundingBoxFromPolygon=PolygonMixin.getBoundingBoxFromPolygon,getPolygon=PolygonMixin.getPolygon,isPolygonsColliding=PolygonMixin.isPolygonsColliding,rotate2DToOrigin=PolygonMixin.rotate2DToOrigin,rotate2DToPoint=PolygonMixin.rotate2DToPoint;import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var ColumnSeries=SeriesRegistry.seriesTypes.column;import U from"../../Core/Utilities.js";var extend=U.extend,find=U.find,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge;import WordcloudPoint from"./WordcloudPoint.js";import WordcloudUtils from"./WordcloudUtils.js";var WordcloudSeries=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,o),t.prototype.bindAxes=function(){var t={endOnTick:!1,gridLineWidth:0,lineWidth:0,maxPadding:0,startOnTick:!1,title:void 0,tickPositions:[]};Series.prototype.bindAxes.call(this),extend(this.yAxis.options,t),extend(this.xAxis.options,t)},t.prototype.pointAttribs=function(t,o){o=H.seriesTypes.column.prototype.pointAttribs.call(this,t,o);return delete o.stroke,delete o["stroke-width"],o},t.prototype.deriveFontSize=function(t,o,i){t=isNumber(t)?t:0,o=isNumber(o)?o:1,i=isNumber(i)?i:1;return Math.floor(Math.max(i,t*o))},t.prototype.drawPoints=function(){var a,d,p=this,c=p.hasRendered,t=p.xAxis,o=p.yAxis,i=p.chart,g=p.group,u=p.options,y=u.animation,m=u.allowExtendPlayingField,x=i.renderer,e=x.text().add(g),h=[],f=p.placementStrategy[u.placementStrategy],P=u.rotation,i=p.points.map(function(t){return t.weight}),S=Math.max.apply(null,i),W=p.points.concat().sort(function(t,o){return o.weight-t.weight});p.group.attr({scaleX:1,scaleY:1}),W.forEach(function(t){var o=1/S*t.weight,o=p.deriveFontSize(o,u.maxFontSize,u.minFontSize),o=extend({fontSize:o+"px"},u.style);e.css(o).attr({x:0,y:0,text:t.name}),o=e.getBBox(!0),t.dimensions={height:o.height,width:o.width}}),d=WordcloudUtils.getPlayingField(t.len,o.len,W),a=WordcloudUtils.getSpiral(p.spirals[u.spiral],{field:d}),W.forEach(function(t){var o,i=1/S*t.weight,e=p.deriveFontSize(i,u.maxFontSize,u.minFontSize),n=extend({fontSize:e+"px"},u.style),r=f(t,{data:W,field:d,placed:h,rotation:P}),s=extend(p.pointAttribs(t,t.selected&&"select"),{align:"center","alignment-baseline":"middle",x:r.x,y:r.y,text:t.name,rotation:isNumber(r.rotation)?r.rotation:void 0}),l=getPolygon(r.x,r.y,t.dimensions.width,t.dimensions.height,r.rotation),i=getBoundingBoxFromPolygon(l),e=WordcloudUtils.intersectionTesting(t,{rectangle:i,polygon:l,field:d,placed:h,spiral:a,rotation:r.rotation});!e&&m&&(d=WordcloudUtils.extendPlayingField(d,i),e=WordcloudUtils.intersectionTesting(t,{rectangle:i,polygon:l,field:d,placed:h,spiral:a,rotation:r.rotation})),isObject(e)?(s.x=(s.x||0)+e.x,s.y=(s.y||0)+e.y,i.left+=e.x,i.right+=e.x,i.top+=e.y,i.bottom+=e.y,d=WordcloudUtils.updateFieldBoundaries(d,i),h.push(t),t.isNull=!1,t.isInside=!0):t.isNull=!0,y&&(o={x:s.x,y:s.y},c?(delete s.x,delete s.y):(s.x=0,s.y=0)),t.draw({animatableAttribs:o,attribs:s,css:n,group:g,renderer:x,shapeArgs:void 0,shapeType:"text"})}),e=e.destroy(),o=WordcloudUtils.getScale(t.len,o.len,d),p.group.attr({scaleX:o,scaleY:o})},t.prototype.hasData=function(){return isObject(this)&&!0===this.visible&&isArray(this.points)&&0<this.points.length},t.prototype.getPlotBox=function(){var t=this.chart,o=t.inverted,i=this[o?"yAxis":"xAxis"],e=this[o?"xAxis":"yAxis"],n=i?i.len:t.plotWidth,o=e?e.len:t.plotHeight;return{translateX:(i?i.left:t.plotLeft)+n/2,translateY:(e?e.top:t.plotTop)+o/2,scaleX:1,scaleY:1}},t.defaultOptions=merge(ColumnSeries.defaultOptions,{allowExtendPlayingField:!0,animation:{duration:500},borderWidth:0,clip:!1,colorByPoint:!0,minFontSize:1,maxFontSize:25,placementStrategy:"center",rotation:{from:0,orientations:2,to:90},showInLegend:!1,spiral:"rectangular",style:{fontFamily:"sans-serif",fontWeight:"900",whiteSpace:"nowrap"},tooltip:{followPointer:!0,pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}: <b>{point.weight}</b><br/>'}}),t}(ColumnSeries);extend(WordcloudSeries.prototype,{animate:Series.prototype.animate,animateDrilldown:noop,animateDrillupFrom:noop,pointClass:WordcloudPoint,setClip:noop,placementStrategy:{random:function(t,o){var i=o.field,o=o.rotation;return{x:WordcloudUtils.getRandomPosition(i.width)-i.width/2,y:WordcloudUtils.getRandomPosition(i.height)-i.height/2,rotation:WordcloudUtils.getRotation(o.orientations,t.index,o.from,o.to)}},center:function(t,o){o=o.rotation;return{x:0,y:0,rotation:WordcloudUtils.getRotation(o.orientations,t.index,o.from,o.to)}}},pointArrayMap:["weight"],spirals:{archimedean:WordcloudUtils.archimedeanSpiral,rectangular:WordcloudUtils.rectangularSpiral,square:WordcloudUtils.squareSpiral},utils:{extendPlayingField:WordcloudUtils.extendPlayingField,getRotation:WordcloudUtils.getRotation,isPolygonsColliding:isPolygonsColliding,rotate2DToOrigin:rotate2DToOrigin,rotate2DToPoint:rotate2DToPoint}}),SeriesRegistry.registerSeriesType("wordcloud",WordcloudSeries);export default WordcloudSeries;