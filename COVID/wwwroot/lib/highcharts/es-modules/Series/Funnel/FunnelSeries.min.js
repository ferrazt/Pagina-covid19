"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Chart from"../../Core/Chart/Chart.js";import H from"../../Core/Globals.js";var noop=H.noop;import palette from"../../Core/Color/Palette.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,PieSeries=SeriesRegistry.seriesTypes.pie;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,merge=U.merge,pick=U.pick,FunnelSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.alignDataLabel=function(t,e,i,o,r){var a=t.series,n=a.options.reversed,s=t.dlBox||t.shapeArgs,l=i.align,p=i.verticalAlign,d=((a.options||{}).dataLabels||{}).inside,h=a.center[1],c=n?2*h-t.plotY:t.plotY,h=a.getWidthAt(c-s.height/2+e.height),a="middle"===p?(s.topWidth-s.bottomWidth)/4:(h-s.bottomWidth)/2,c=s.y,h=s.x;"middle"===p?c=s.y-s.height/2+e.height/2:"top"===p&&(c=s.y-s.height+e.height+i.padding),("top"===p&&!n||"bottom"===p&&n||"middle"===p)&&("right"===l?h=s.x-i.padding+a:"left"===l&&(h=s.x+i.padding-a)),o={x:h,y:n?c-s.height:c,width:s.bottomWidth,height:s.height},i.verticalAlign="bottom",d&&!t.visible||Series.prototype.alignDataLabel.call(this,t,e,i,o,r),d&&(!t.visible&&t.dataLabel&&(t.dataLabel.placed=!1),t.contrastColor&&e.css({color:t.contrastColor}))},t.prototype.drawDataLabels=function(){var t,e,i,o,r,a=this,n=a.data,s=a.options.dataLabels.distance,l=n.length;for(a.center[2]-=2*s;l--;)e=(t=(i=n[l]).half)?1:-1,r=i.plotY,i.labelDistance=pick(i.options.dataLabels&&i.options.dataLabels.distance,s),a.maxLabelDistance=Math.max(i.labelDistance,a.maxLabelDistance||0),o=a.getX(r,t,i),i.labelPosition={natural:{x:0,y:r},final:{},alignment:t?"right":"left",connectorPosition:{breakAt:{x:o+(i.labelDistance-5)*e,y:r},touchingSliceAt:{x:o+i.labelDistance*e,y:r}}};SeriesRegistry.seriesTypes[a.options.dataLabels.inside?"column":"pie"].prototype.drawDataLabels.call(this)},t.prototype.translate=function(){var e,i,o,r,a,n,s,l,p,d=0,h=this,t=h.chart,c=h.options,g=c.reversed,u=c.ignoreHiddenPoint,f=t.plotWidth,b=t.plotHeight,y=0,t=c.center,v=_(t[0],f),m=_(t[1],b),L=_(c.width,f),x=_(c.height,b),A=_(c.neckWidth,f),S=_(c.neckHeight,b),W=m-x/2+x-S,b=h.data,C="left"===c.dataLabels.position?1:0;function _(t,e){return/%$/.test(t)?e*parseInt(t,10)/100:parseInt(t,10)}h.getWidthAt=function(t){return W<t||x===S?A:A+(L-A)*(1-(t-(m-x/2))/(x-S))},h.getX=function(t,e,i){return v+(e?-1:1)*(h.getWidthAt(g?2*m-t:t)/2+i.labelDistance)},h.center=[v,m,x],h.centerX=v,b.forEach(function(t){u&&!1===t.visible||(d+=t.y)}),b.forEach(function(t){p=null,i=d?t.y/d:0,s=(r=m-x/2+y*x)+i*x,e=h.getWidthAt(r),a=(o=v-e/2)+e,e=h.getWidthAt(s),l=(n=v-e/2)+e,W<r?(o=n=v-A/2,a=l=v+A/2):W<s&&(p=s,e=h.getWidthAt(W),l=(n=v-e/2)+e,s=W),g&&(r=2*m-r,s=2*m-s,null!==p&&(p=2*m-p)),e=[["M",o,r],["L",a,r],["L",l,s]],null!==p&&e.push(["L",l,p],["L",n,p]),e.push(["L",n,s],["Z"]),t.shapeType="path",t.shapeArgs={d:e},t.percentage=100*i,t.plotX=v,t.plotY=(r+(p||s))/2,t.tooltipPos=[v,t.plotY],t.dlBox={x:n,y:r,topWidth:a-o,bottomWidth:l-n,height:Math.abs(pick(p,s)-r),width:NaN},t.slice=noop,t.half=C,u&&!1===t.visible||(y+=i)}),fireEvent(h,"afterTranslate")},t.prototype.sortByAngle=function(t){t.sort(function(t,e){return t.plotY-e.plotY})},t.defaultOptions=merge(PieSeries.defaultOptions,{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1,verticalAlign:"middle"},states:{select:{color:palette.neutralColor20,borderColor:palette.neutralColor100}}}),t}(PieSeries);extend(FunnelSeries.prototype,{animate:noop}),addEvent(Chart,"afterHideAllOverlappingLabels",function(){this.series.forEach(function(t){var e=t.options&&t.options.dataLabels;isArray(e)&&(e=e[0]),t.is("pie")&&t.placeDataLabels&&e&&!e.inside&&t.placeDataLabels()})}),SeriesRegistry.registerSeriesType("funnel",FunnelSeries);export default FunnelSeries;