import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";import NavigationBindings from"../Extensions/Annotations/NavigationBindings.js";import D from"../Core/DefaultOptions.js";var setOptions=D.setOptions;import U from"../Core/Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,extend=U.extend,fireEvent=U.fireEvent,getStyle=U.getStyle,isArray=U.isArray,merge=U.merge,pick=U.pick,DIV="div",SPAN="span",UL="ul",LI="li",PREFIX="highcharts-",activeClass=PREFIX+"active";setOptions({lang:{stockTools:{gui:{simpleShapes:"Simple shapes",lines:"Lines",crookedLines:"Crooked lines",measure:"Measure",advanced:"Advanced",toggleAnnotations:"Toggle annotations",verticalLabels:"Vertical labels",flags:"Flags",zoomChange:"Zoom change",typeChange:"Type change",saveChart:"Save chart",indicators:"Indicators",currentPriceIndicator:"Current Price Indicators",zoomX:"Zoom X",zoomY:"Zoom Y",zoomXY:"Zooom XY",fullScreen:"Fullscreen",typeOHLC:"OHLC",typeLine:"Line",typeCandlestick:"Candlestick",circle:"Circle",label:"Label",rectangle:"Rectangle",flagCirclepin:"Flag circle",flagDiamondpin:"Flag diamond",flagSquarepin:"Flag square",flagSimplepin:"Flag simple",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",infinityLine:"Infinity line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel"}},navigation:{popup:{circle:"Circle",rectangle:"Rectangle",label:"Label",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel",infinityLine:"Infinity line",measure:"Measure",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",flags:"Flags",addButton:"add",saveButton:"save",editButton:"edit",removeButton:"remove",series:"Series",volume:"Volume",connector:"Connector",innerBackground:"Inner background",outerBackground:"Outer background",crosshairX:"Crosshair X",crosshairY:"Crosshair Y",tunnel:"Tunnel",background:"Background",index:"Index",period:"Period",standardDeviation:"Standard deviation",periodTenkan:"Tenkan period",periodSenkouSpanB:"Senkou Span B period",periodATR:"ATR period",multiplierATR:"ATR multiplier",shortPeriod:"Short period",longPeriod:"Long period",signalPeriod:"Signal period",decimals:"Decimals",algorithm:"Algorithm",topBand:"Top band",bottomBand:"Bottom band",initialAccelerationFactor:"Initial acceleration factor",maxAccelerationFactor:"Max acceleration factor",increment:"Increment",multiplier:"Multiplier",ranges:"Ranges",highIndex:"High index",lowIndex:"Low index",deviation:"Deviation",xAxisUnit:"x-axis unit",factor:"Factor",fastAvgPeriod:"Fast average period",slowAvgPeriod:"Slow average period",average:"Average"}}},stockTools:{gui:{enabled:!0,className:"highcharts-bindings-wrapper",toolbarClassName:"stocktools-toolbar",buttons:["indicators","separator","simpleShapes","lines","crookedLines","measure","advanced","toggleAnnotations","separator","verticalLabels","flags","separator","zoomChange","fullScreen","typeChange","separator","currentPriceIndicator","saveChart"],definitions:{separator:{symbol:"separator.svg"},simpleShapes:{items:["label","circle","rectangle"],circle:{symbol:"circle.svg"},rectangle:{symbol:"rectangle.svg"},label:{symbol:"label.svg"}},flags:{items:["flagCirclepin","flagDiamondpin","flagSquarepin","flagSimplepin"],flagSimplepin:{symbol:"flag-basic.svg"},flagDiamondpin:{symbol:"flag-diamond.svg"},flagSquarepin:{symbol:"flag-trapeze.svg"},flagCirclepin:{symbol:"flag-elipse.svg"}},lines:{items:["segment","arrowSegment","ray","arrowRay","line","arrowLine","horizontalLine","verticalLine"],segment:{symbol:"segment.svg"},arrowSegment:{symbol:"arrow-segment.svg"},ray:{symbol:"ray.svg"},arrowRay:{symbol:"arrow-ray.svg"},line:{symbol:"line.svg"},arrowLine:{symbol:"arrow-line.svg"},verticalLine:{symbol:"vertical-line.svg"},horizontalLine:{symbol:"horizontal-line.svg"}},crookedLines:{items:["elliott3","elliott5","crooked3","crooked5"],crooked3:{symbol:"crooked-3.svg"},crooked5:{symbol:"crooked-5.svg"},elliott3:{symbol:"elliott-3.svg"},elliott5:{symbol:"elliott-5.svg"}},verticalLabels:{items:["verticalCounter","verticalLabel","verticalArrow"],verticalCounter:{symbol:"vertical-counter.svg"},verticalLabel:{symbol:"vertical-label.svg"},verticalArrow:{symbol:"vertical-arrow.svg"}},advanced:{items:["fibonacci","pitchfork","parallelChannel"],pitchfork:{symbol:"pitchfork.svg"},fibonacci:{symbol:"fibonacci.svg"},parallelChannel:{symbol:"parallel-channel.svg"}},measure:{items:["measureXY","measureX","measureY"],measureX:{symbol:"measure-x.svg"},measureY:{symbol:"measure-y.svg"},measureXY:{symbol:"measure-xy.svg"}},toggleAnnotations:{symbol:"annotations-visible.svg"},currentPriceIndicator:{symbol:"current-price-show.svg"},indicators:{symbol:"indicators.svg"},zoomChange:{items:["zoomX","zoomY","zoomXY"],zoomX:{symbol:"zoom-x.svg"},zoomY:{symbol:"zoom-y.svg"},zoomXY:{symbol:"zoom-xy.svg"}},typeChange:{items:["typeOHLC","typeLine","typeCandlestick"],typeOHLC:{symbol:"series-ohlc.svg"},typeLine:{symbol:"series-line.svg"},typeCandlestick:{symbol:"series-candlestick.svg"}},fullScreen:{symbol:"fullscreen.svg"},saveChart:{symbol:"save-chart.svg"}}}}}),addEvent(Chart,"afterGetContainer",function(){this.setStockTools()}),addEvent(Chart,"getMargins",function(){var e=this.stockTools&&this.stockTools.listWrapper,e=e&&(e.startWidth+getStyle(e,"padding-left")+getStyle(e,"padding-right")||e.offsetWidth);e&&e<this.plotWidth&&(this.plotLeft+=e,this.spacing[3]+=e)},{order:0}),["beforeRender","beforeRedraw"].forEach(function(e){addEvent(Chart,e,function(){var e,t,o,i;this.stockTools&&(i=this.options.chart,t=!1,(e=(o=this.stockTools.listWrapper)&&(o.startWidth+getStyle(o,"padding-left")+getStyle(o,"padding-right")||o.offsetWidth))&&e<this.plotWidth?(i=(o=pick(i.spacingLeft,i.spacing&&i.spacing[3],0)+e)-this.spacingBox.x,this.spacingBox.x=o,this.spacingBox.width-=i,t=!0):0===e&&(t=!0),e!==this.stockTools.prevOffsetWidth&&(this.stockTools.prevOffsetWidth=e,t&&(this.isDirtyLegend=!0)))})}),addEvent(Chart,"destroy",function(){this.stockTools&&this.stockTools.destroy()}),addEvent(Chart,"redraw",function(){this.stockTools&&this.stockTools.guiEnabled&&this.stockTools.redraw()});var Toolbar=function(){function n(e,t,o){this.arrowDown=void 0,this.arrowUp=void 0,this.arrowWrapper=void 0,this.listWrapper=void 0,this.showhideBtn=void 0,this.submenu=void 0,this.toolbar=void 0,this.wrapper=void 0,this.chart=o,this.options=e,this.lang=t,this.iconsURL=this.getIconsURL(),this.guiEnabled=e.enabled,this.visible=pick(e.visible,!0),this.placed=pick(e.placed,!1),this.eventsToUnbind=[],this.guiEnabled&&(this.createHTML(),this.init(),this.showHideNavigatorion()),fireEvent(this,"afterInit")}return n.prototype.init=function(){var t,o=this,i=this.lang,e=this.options,a=this.toolbar,r=o.addSubmenu,s=e.buttons,n=e.definitions,l=a.childNodes;s.forEach(function(e){t=o.addButton(a,n,e,i),o.eventsToUnbind.push(addEvent(t.buttonWrapper,"click",function(){o.eraseActiveButtons(l,t.buttonWrapper)})),isArray(n[e].items)&&r.call(o,t,n[e])})},n.prototype.addSubmenu=function(e,t){var o,i=this,a=e.submenuArrow,r=e.buttonWrapper,s=getStyle(r,"width"),n=this.wrapper,l=this.listWrapper,c=this.toolbar.childNodes,d=0;this.submenu=o=createElement(UL,{className:PREFIX+"submenu-wrapper"},void 0,r),this.addSubmenuItems(r,t),i.eventsToUnbind.push(addEvent(a,"click",function(e){e.stopPropagation(),i.eraseActiveButtons(c,r),0<=r.className.indexOf(PREFIX+"current")?(l.style.width=l.startWidth+"px",r.classList.remove(PREFIX+"current"),o.style.display="none"):(o.style.display="block",d=o.offsetHeight-r.offsetHeight-3,o.offsetHeight+r.offsetTop>n.offsetHeight&&r.offsetTop>d||(d=0),css(o,{top:-d+"px",left:s+3+"px"}),r.className+=" "+PREFIX+"current",l.startWidth=n.offsetWidth,l.style.width=l.startWidth+getStyle(l,"padding-left")+o.offsetWidth+3+"px")}))},n.prototype.addSubmenuItems=function(t,o){var e,i,a=this,r=this.submenu,s=this.lang,n=this.listWrapper;o.items.forEach(function(e){i=a.addButton(r,o,e,s),a.eventsToUnbind.push(addEvent(i.mainButton,"click",function(){a.switchSymbol(this,t,!0),n.style.width=n.startWidth+"px",r.style.display="none"}))}),e=r.querySelectorAll("li > ."+PREFIX+"menu-item-btn")[0],a.switchSymbol(e,!1)},n.prototype.eraseActiveButtons=function(e,t,o){[].forEach.call(e,function(e){e!==t&&(e.classList.remove(PREFIX+"current"),e.classList.remove(PREFIX+"active"),0<(o=e.querySelectorAll("."+PREFIX+"submenu-wrapper")).length&&(o[0].style.display="none"))})},n.prototype.addButton=function(e,t,o,i){void 0===i&&(i={});var a,r=t[o],s=r.items,t=r.className||"",o=createElement(LI,{className:pick(n.prototype.classMapping[o],"")+" "+t,title:i[o]||o},void 0,e),e=createElement(SPAN,{className:PREFIX+"menu-item-btn"},void 0,o);return s&&s.length?(a=createElement(SPAN,{className:PREFIX+"submenu-item-arrow "+PREFIX+"arrow-right"},void 0,o)).style.backgroundImage="url("+this.iconsURL+"arrow-bottom.svg)":e.style.backgroundImage="url("+this.iconsURL+r.symbol+")",{buttonWrapper:o,mainButton:e,submenuArrow:a}},n.prototype.addNavigation=function(){var e=this,t=e.wrapper;e.arrowWrapper=createElement(DIV,{className:PREFIX+"arrow-wrapper"}),e.arrowUp=createElement(DIV,{className:PREFIX+"arrow-up"},void 0,e.arrowWrapper),e.arrowUp.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",e.arrowDown=createElement(DIV,{className:PREFIX+"arrow-down"},void 0,e.arrowWrapper),e.arrowDown.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",t.insertBefore(e.arrowWrapper,t.childNodes[0]),e.scrollButtons()},n.prototype.scrollButtons=function(){var e=0,t=this,o=t.wrapper,i=t.toolbar,a=.1*o.offsetHeight;t.eventsToUnbind.push(addEvent(t.arrowUp,"click",function(){0<e&&(e-=a,i.style.marginTop=-e+"px")})),t.eventsToUnbind.push(addEvent(t.arrowDown,"click",function(){o.offsetHeight+e<=i.offsetHeight+a&&(e+=a,i.style.marginTop=-e+"px")}))},n.prototype.createHTML=function(){var e=this,t=e.chart,o=e.options,i=t.container,a=t.options.navigation,a=a&&a.bindingsClassName,r=e.wrapper=createElement(DIV,{className:PREFIX+"stocktools-wrapper "+o.className+" "+a});i.appendChild(r),["mousemove","click","touchstart"].forEach(function(e){addEvent(r,e,function(e){return e.stopPropagation()})}),addEvent(r,"mouseover",function(e){return t.pointer.onContainerMouseLeave(e)}),e.toolbar=i=createElement(UL,{className:PREFIX+"stocktools-toolbar "+o.toolbarClassName}),e.listWrapper=o=createElement(DIV,{className:PREFIX+"menu-wrapper"}),r.insertBefore(o,r.childNodes[0]),o.insertBefore(i,o.childNodes[0]),e.showHideToolbar(),e.addNavigation()},n.prototype.showHideNavigatorion=function(){this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50?this.arrowWrapper.style.display="block":(this.toolbar.style.marginTop="0px",this.arrowWrapper.style.display="none")},n.prototype.showHideToolbar=function(){var e,t=this.chart,o=this.wrapper,i=this.listWrapper,a=this.submenu,r=this.visible;this.showhideBtn=e=createElement(DIV,{className:PREFIX+"toggle-toolbar "+PREFIX+"arrow-left"},void 0,o),e.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",r?(o.style.height="100%",e.style.top=getStyle(i,"padding-top")+"px",e.style.left=o.offsetWidth+getStyle(i,"padding-left")+"px"):(a&&(a.style.display="none"),e.style.left="0px",this.visible=r=!1,i.classList.add(PREFIX+"hide"),e.classList.toggle(PREFIX+"arrow-right"),o.style.height=e.offsetHeight+"px"),this.eventsToUnbind.push(addEvent(e,"click",function(){t.update({stockTools:{gui:{visible:!r,placed:!0}}})}))},n.prototype.switchSymbol=function(e,t){var o=e.parentNode,i=o.classList.value,o=o.parentNode.parentNode;-1<i.indexOf("highcharts-disabled-btn")||(o.className="",i&&o.classList.add(i.trim()),o.querySelectorAll("."+PREFIX+"menu-item-btn")[0].style.backgroundImage=e.style.backgroundImage,t&&this.selectButton(o))},n.prototype.selectButton=function(e){0<=e.className.indexOf(activeClass)?e.classList.remove(activeClass):e.classList.add(activeClass)},n.prototype.unselectAllButtons=function(t){var e=t.parentNode.querySelectorAll("."+activeClass);[].forEach.call(e,function(e){e!==t&&e.classList.remove(activeClass)})},n.prototype.update=function(e,t){merge(!0,this.chart.options.stockTools,e),this.destroy(),this.chart.setStockTools(e),this.chart.navigationBindings&&this.chart.navigationBindings.update(),this.chart.isDirtyBox=!0,pick(t,!0)&&this.chart.redraw()},n.prototype.destroy=function(){var e=this.wrapper,t=e&&e.parentNode;this.eventsToUnbind.forEach(function(e){e()}),t&&t.removeChild(e)},n.prototype.redraw=function(){this.showHideNavigatorion()},n.prototype.getIconsURL=function(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/9.1.2/gfx/stock-icons/"},n}();Toolbar.prototype.classMapping={circle:PREFIX+"circle-annotation",rectangle:PREFIX+"rectangle-annotation",label:PREFIX+"label-annotation",segment:PREFIX+"segment",arrowSegment:PREFIX+"arrow-segment",ray:PREFIX+"ray",arrowRay:PREFIX+"arrow-ray",line:PREFIX+"infinity-line",arrowLine:PREFIX+"arrow-infinity-line",verticalLine:PREFIX+"vertical-line",horizontalLine:PREFIX+"horizontal-line",crooked3:PREFIX+"crooked3",crooked5:PREFIX+"crooked5",elliott3:PREFIX+"elliott3",elliott5:PREFIX+"elliott5",pitchfork:PREFIX+"pitchfork",fibonacci:PREFIX+"fibonacci",parallelChannel:PREFIX+"parallel-channel",measureX:PREFIX+"measure-x",measureY:PREFIX+"measure-y",measureXY:PREFIX+"measure-xy",verticalCounter:PREFIX+"vertical-counter",verticalLabel:PREFIX+"vertical-label",verticalArrow:PREFIX+"vertical-arrow",currentPriceIndicator:PREFIX+"current-price-indicator",indicators:PREFIX+"indicators",flagCirclepin:PREFIX+"flag-circlepin",flagDiamondpin:PREFIX+"flag-diamondpin",flagSquarepin:PREFIX+"flag-squarepin",flagSimplepin:PREFIX+"flag-simplepin",zoomX:PREFIX+"zoom-x",zoomY:PREFIX+"zoom-y",zoomXY:PREFIX+"zoom-xy",typeLine:PREFIX+"series-type-line",typeOHLC:PREFIX+"series-type-ohlc",typeCandlestick:PREFIX+"series-type-candlestick",fullScreen:PREFIX+"full-screen",toggleAnnotations:PREFIX+"toggle-annotations",saveChart:PREFIX+"save-chart",separator:PREFIX+"separator"},extend(Chart.prototype,{setStockTools:function(e){var t=this.options,o=t.lang,e=merge(t.stockTools&&t.stockTools.gui,e&&e.gui),o=o&&o.stockTools&&o.stockTools.gui;this.stockTools=new Toolbar(e,o,this),this.stockTools.guiEnabled&&(this.isDirtyBox=!0)}}),addEvent(NavigationBindings,"selectButton",function(e){var t=e.button,o=PREFIX+"submenu-wrapper",i=this.chart.stockTools;i&&i.guiEnabled&&(i.unselectAllButtons(e.button),0<=t.parentNode.className.indexOf(o)&&(t=t.parentNode.parentNode),i.selectButton(t))}),addEvent(NavigationBindings,"deselectButton",function(e){var t=e.button,e=this.chart.stockTools;e&&e.guiEnabled&&(0<=t.parentNode.className.indexOf(PREFIX+"submenu-wrapper")&&(t=t.parentNode.parentNode),e.selectButton(t))}),addEvent(Chart,"render",function(){var e=this,t=e.stockTools,o=t&&t.toolbar&&t.toolbar.querySelector(".highcharts-current-price-indicator");t&&e.navigationBindings&&e.options.series&&o&&(e.navigationBindings.constructor.prototype.utils.isPriceIndicatorEnabled(e.series)?o.firstChild.style["background-image"]='url("'+t.getIconsURL()+'current-price-hide.svg")':o.firstChild.style["background-image"]='url("'+t.getIconsURL()+'current-price-show.svg")')}),H.Toolbar=Toolbar;export default H.Toolbar;