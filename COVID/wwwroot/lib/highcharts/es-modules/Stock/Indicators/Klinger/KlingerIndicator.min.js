"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import RequiredIndicatorMixin from"../../../Mixins/IndicatorRequired.js";import MultipleLinesMixin from"../../../Mixins/MultipleLines.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var _a=SeriesRegistry.seriesTypes,SMAIndicator=_a.sma,EMAIndicator=_a.ema;import U from"../../../Core/Utilities.js";var correctFloat=U.correctFloat,error=U.error,extend=U.extend,isArray=U.isArray,merge=U.merge,KlingerIndicator=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=void 0,e.points=void 0,e.options=void 0,e.volumeSeries=void 0,e}return __extends(e,t),e.prototype.init=function(){var t=arguments,r=this;RequiredIndicatorMixin.isParentLoaded(EMAIndicator,"ema",r.type,function(e){e.prototype.init.apply(r,t)})},e.prototype.calculateTrend=function(e,t){return e[t][1]+e[t][2]+e[t][3]>e[t-1][1]+e[t-1][2]+e[t-1][3]?1:-1},e.prototype.isValidData=function(e){var t=this.chart,r=this.options,i=this.linkedParent,e=isArray(e)&&4===e.length,t=this.volumeSeries||(this.volumeSeries=t.get(r.params.volumeSeriesID));return t||error("Series "+r.params.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,i.chart),!(![i,t].every(function(e){return e&&e.xData&&e.xData.length>=r.params.slowAvgPeriod})||!e)},e.prototype.getCM=function(e,t,r,i,o){return correctFloat(t+(r===i?e:o))},e.prototype.getDM=function(e,t){return correctFloat(e-t)},e.prototype.getVolumeForce=function(e){for(var t,r,i,o,n=[],a=1,s=0,l=e[0][1]-e[0][2],p=0;a<e.length;a++)o=this.calculateTrend(e,a),r=this.getDM(e[a][1],e[a][2]),t=this.getCM(s,r,o,p,l),i=this.volumeSeries.yData[a]*o*Math.abs(2*(r/t-1))*100,n.push([i]),p=o,s=t,l=r;return n},e.prototype.getEMA=function(e,t,r,i,o,n,a){return EMAIndicator.prototype.calculateEma(a||[],e,void 0===n?1:n,i,t,void 0===o?-1:o,r)},e.prototype.getSMA=function(e,t,r){return EMAIndicator.prototype.accumulatePeriodPoints(e,t,r)/e},e.prototype.getValues=function(e,t){var r,i=[],o=e.xData,n=e.yData,a=[],s=[],l=[],p=0,u=0,c=void 0,d=void 0,g=null;if(this.isValidData(n[0])){for(var y=this.getVolumeForce(n),v=this.getSMA(t.fastAvgPeriod,0,y),f=this.getSMA(t.slowAvgPeriod,0,y),m=2/(t.fastAvgPeriod+1),h=2/(t.slowAvgPeriod+1);p<n.length;p++)p>=t.fastAvgPeriod&&(c=u=this.getEMA(y,c,v,m,0,p,o)[1]),p>=t.slowAvgPeriod&&(r=this.getEMA(y,d,f,h,0,p,o)[1],r=correctFloat(u-(d=r)),l.push(r),l.length>=t.signalPeriod&&(g=l.slice(-t.signalPeriod).reduce(function(e,t){return e+t})/t.signalPeriod),i.push([o[p],r,g]),a.push(o[p]),s.push([r,g]));return{values:i,xData:a,yData:s}}},e.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{fastAvgPeriod:34,slowAvgPeriod:55,signalPeriod:13,volumeSeriesID:"volume"},signalLine:{styles:{lineWidth:1,lineColor:"#ff0000"}},dataGrouping:{approximation:"averages"},tooltip:{pointFormat:'<span style="color: {point.color}">‚óè</span><b> {series.name}</b><br/><span style="color: {point.color}">Klinger</span>: {point.y}<br/><span style="color: {point.series.options.signalLine.styles.lineColor}">Signal</span>: {point.signal}<br/>'}}),e}(SMAIndicator);extend(KlingerIndicator.prototype,{linesApiNames:["signalLine"],nameBase:"Klinger",nameComponents:["fastAvgPeriod","slowAvgPeriod"],pointArrayMap:["y","signal"],parallelArrays:["x","y","signal"],pointValKey:"y",drawGraph:MultipleLinesMixin.drawGraph,getTranslatedLinesNames:MultipleLinesMixin.getTranslatedLinesNames,translate:MultipleLinesMixin.translate,toYData:MultipleLinesMixin.toYData}),SeriesRegistry.registerSeriesType("klinger",KlingerIndicator);export default KlingerIndicator;