"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};return function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();import RequiredIndicatorMixin from"../../../Mixins/IndicatorRequired.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var LineSeries=SeriesRegistry.seriesTypes.line;import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,error=U.error,extend=U.extend,isArray=U.isArray,merge=U.merge,pick=U.pick,splat=U.splat;import"./SMAComposition.js";var generateMessage=RequiredIndicatorMixin.generateMessage,SMAIndicator=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.data=void 0,e.dataEventsToUnbind=void 0,e.linkedParent=void 0,e.options=void 0,e.points=void 0,e}return __extends(e,n),e.prototype.destroy=function(){this.dataEventsToUnbind.forEach(function(e){e()}),n.prototype.destroy.apply(this,arguments)},e.prototype.getName=function(){var e=this.name,a=[];return e||((this.nameComponents||[]).forEach(function(e,t){a.push(this.options.params[e]+pick(this.nameSuffixes[t],""))},this),e=(this.nameBase||this.type.toUpperCase())+(this.nameComponents?" ("+a.join(", ")+")":"")),e},e.prototype.getValues=function(e,t){var a,i,r=t.period,n=e.xData,o=e.yData,s=o.length,p=0,d=0,u=[],c=[],l=[],y=-1;if(!(n.length<r)){for(isArray(o[0])&&(y=t.index||0);p<r-1;)d+=y<0?o[p]:o[p][y],p++;for(a=p;a<s;a++)d+=y<0?o[a]:o[a][y],i=[n[a],d/r],u.push(i),c.push(i[0]),l.push(i[1]),d-=y<0?o[a-p]:o[a-p][y];return{values:u,xData:c,yData:l}}},e.prototype.init=function(e,t){var a,d=this,i=d.requireIndicators();return i.allLoaded?(n.prototype.init.call(d,e,t),e.linkSeries(),d.dataEventsToUnbind=[],d.linkedParent?(d.dataEventsToUnbind.push(addEvent(d.bindTo.series?d.linkedParent:d.linkedParent.xAxis,d.bindTo.eventName,r)),void("init"===d.calculateOn?r():a=addEvent(d.chart,d.calculateOn,function(){r(),a()}))):error("Series "+d.options.linkedTo+" not found! Check `linkedTo`.",!1,e)):error(generateMessage(d.type,i.needed));function r(){var e,t,a,i,r=d.points||[],n=(d.xData||[]).length,o=d.getValues(d.linkedParent,d.options.params)||{values:[],xData:[],yData:[]},s=[],p=!0;if(n&&!d.hasGroupedData&&d.visible&&d.points)if(d.cropped){for(d.xAxis&&(t=d.xAxis.min,a=d.xAxis.max),e=d.cropData(o.xData,o.yData,t,a),i=0;i<e.xData.length;i++)s.push([e.xData[i]].concat(splat(e.yData[i])));t=o.xData.indexOf(d.xData[0]),a=o.xData.indexOf(d.xData[d.xData.length-1]),-1===t&&a===o.xData.length-2&&s[0][0]===r[0].x&&s.shift(),d.updateData(s)}else o.xData.length!==n-1&&o.xData.length!==n+1&&(p=!1,d.updateData(o.values));p&&(d.xData=o.xData,d.yData=o.yData,d.options.data=o.values),!1===d.bindTo.series&&(delete d.processedXData,d.isDirty=!0,d.redraw()),d.isDirtyData=!1}},e.prototype.processData=function(){var e=this,t=e.options.compareToMain,a=e.linkedParent;n.prototype.processData.apply(e,arguments),a&&a.compareValue&&t&&(e.compareValue=a.compareValue)},e.prototype.requireIndicators=function(){var t={allLoaded:!0};return this.requiredIndicators.forEach(function(e){SeriesRegistry.seriesTypes[e]?SeriesRegistry.seriesTypes[e].prototype.requireIndicators():(t.allLoaded=!1,t.needed=e)}),t},e.defaultOptions=merge(LineSeries.defaultOptions,{name:void 0,tooltip:{valueDecimals:4},linkedTo:void 0,compareToMain:!1,params:{index:0,period:14}}),e}(LineSeries);extend(SMAIndicator.prototype,{bindTo:{series:!0,eventName:"updatedData"},calculateOn:"init",hasDerivedData:!0,nameComponents:["period"],nameSuffixes:[],requiredIndicators:[],useCommonDataGrouping:!0}),SeriesRegistry.registerSeriesType("sma",SMAIndicator);export default SMAIndicator;