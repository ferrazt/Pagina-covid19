"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/marker-clusters",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){t=t?t._modules:{};function e(t,e,a,o){t.hasOwnProperty(e)||(t[e]=o.apply(null,a))}e(t,"Extensions/MarkerClusters.js",[t["Core/Animation/AnimationUtilities.js"],t["Core/Chart/Chart.js"],t["Core/DefaultOptions.js"],t["Core/Color/Palette.js"],t["Core/Series/Point.js"],t["Core/Series/Series.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Renderer/SVG/SVGRenderer.js"],t["Core/Utilities.js"],t["Core/Axis/Axis.js"]],function(t,e,a,o,i,r,n,s,l,p){var x=t.animObject,a=a.defaultOptions,n=n.seriesTypes,u=s.prototype.symbols,I=l.addEvent,v=l.defined,A=l.error,b=l.isArray,M=l.isFunction,D=l.isObject,k=l.isNumber,P=l.merge,S=l.objectEach,X=l.relativeLength,g=l.syncTimeout,n=n.scatter,Y=r.prototype.generatePoints,d=0,c=[],z={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:o.backgroundColor},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};function E(t){for(var e=t.length,a=0,o=0,i=0;i<e;i++)a+=t[i].x,o+=t[i].y;return{x:a/e,y:o/e}}function h(t,e){var a=[];return a.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){a[t.dataIndex]=t})}),t.noise.forEach(function(t){a[t.data[0].dataIndex]=t.data[0]}),a}function f(t,e,a){t.attr({opacity:e}).animate({opacity:1},a)}function y(t,e,a,o,i){t.point&&(o&&t.point.graphic&&(t.point.graphic.show(),f(t.point.graphic,e,a)),i&&t.point.dataLabel&&(t.point.dataLabel.show(),f(t.point.dataLabel,e,a)))}function C(t,e,a){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),a&&t.point.dataLabel&&t.point.dataLabel.hide())}function L(t,e,a,o){y(t,o,a,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}function O(){return Math.random().toString(36).substring(2,7)+"-"+d++}(a.plotOptions||{}).series=P((a.plotOptions||{}).series,{cluster:z,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}}),u.cluster=function(t,e,a,o){var i=a/2,r=o/2,a=u.arc(t+i,e+r,i-4,r-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),o=u.arc(t+i,e+r,i-3,r-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i-2,open:!1});return u.arc(t+i,e+r,i-1,r-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i,open:!1}).concat(o,a)},n.prototype.animateClusterPoint=function(t){var e,a,o,i,r=this,n=r.xAxis,s=r.yAxis,l=r.chart,p=r.options.cluster,u=x((p||{}).animation),d=u.duration||500,p=(r.markerClusterInfo||{}).pointsState,r=(p||{}).newState,c=(p||{}).oldState,h=[],f=!1,m=!1;c&&r&&(a=r[t.stateId],o=n.toPixels(a.x)-l.plotLeft,i=s.toPixels(a.y)-l.plotTop,1===a.parentsId.length?(t=(r||{})[t.stateId].parentsId[0],e=c[t],a.point&&a.point.graphic&&e&&e.point&&e.point.plotX&&e.point.plotY&&e.point.plotX!==a.point.plotX&&e.point.plotY!==a.point.plotY&&(t=a.point.graphic.getBBox(),p=a.point.graphic&&a.point.graphic.isImg?0:t.width/2,a.point.graphic.attr({x:e.point.plotX-p,y:e.point.plotY-p}),a.point.graphic.animate({x:o-(a.point.graphic.radius||0),y:i-(a.point.graphic.radius||0)},u,function(){m=!0,e.point&&e.point.destroy&&e.point.destroy()}),a.point.dataLabel&&a.point.dataLabel.alignAttr&&e.point.dataLabel&&e.point.dataLabel.alignAttr&&(a.point.dataLabel.attr({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y}),a.point.dataLabel.animate({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y},u)))):0===a.parentsId.length?(C(a,!0,!0),g(function(){y(a,.1,u,!0,!0)},d/2)):(C(a,!0,!0),a.parentsId.forEach(function(t){c&&c[t]&&(e=c[t],h.push(e),e.point&&e.point.graphic&&(f=!0,e.point.graphic.show(),e.point.graphic.animate({x:o-(e.point.graphic.radius||0),y:i-(e.point.graphic.radius||0),opacity:.4},u,function(){m=!0,L(a,h,u,.7)}),e.point.dataLabel&&-9999!==e.point.dataLabel.y&&a.point&&a.point.dataLabel&&a.point.dataLabel.alignAttr&&(e.point.dataLabel.show(),e.point.dataLabel.animate({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y,opacity:.4},u))))}),g(function(){m||L(a,h,u,.85)},d),f||g(function(){L(a,h,u,.1)},d/2)))},n.prototype.getGridOffset=function(){var t=this,e=t.chart,a=t.xAxis,o=t.yAxis;return{plotLeft:t.dataMinX&&t.dataMaxX?a.reversed?a.toPixels(t.dataMaxX):a.toPixels(t.dataMinX):e.plotLeft,plotTop:t.dataMinY&&t.dataMaxY?o.reversed?o.toPixels(t.dataMinY):o.toPixels(t.dataMaxY):e.plotTop}},n.prototype.getScaledGridSize=function(t){var e,a,o=this.xAxis,i=!0,r=1,n=1,t=t.processedGridSize||z.layoutAlgorithm.gridSize;for(this.gridValueSize||(this.gridValueSize=Math.abs(o.toValue(t)-o.toValue(0))),e=+(t/(o.toPixels(this.gridValueSize)-o.toPixels(0))).toFixed(14);i&&1!=e;)a=Math.pow(2,r),.75<e&&e<1.25?i=!1:1/a<=e&&e<1/a*2?(i=!1,n=a):e<=a&&a/2<e&&(i=!1,n=1/a),r++;return t/n/e},n.prototype.getRealExtremes=function(){var t,e=this.chart,a=this.xAxis,o=this.yAxis,i=a?a.toValue(e.plotLeft):0,r=a?a.toValue(e.plotLeft+e.plotWidth):0,a=o?o.toValue(e.plotTop):0,e=o?o.toValue(e.plotTop+e.plotHeight):0;return r<i&&(r=(t=[i,r])[0],i=t[1]),e<a&&(e=(t=[a,e])[0],a=t[1]),{minX:i,maxX:r,minY:a,maxY:e}},n.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,a,o,i,r,n=t.point||t.target,s=n.series,l=n.series.xAxis,p=n.series.yAxis,u=n.series.chart;(s.options.cluster||{}).drillToCluster&&n.clusteredData&&(a=n.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),o=n.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),i=a[0],r=a[a.length-1],s=o[0],n=o[o.length-1],a=Math.abs(.1*(r-i)),o=Math.abs(.1*(n-s)),u.pointer.zoomX=!0,u.pointer.zoomY=!0,r<i&&(i=(e=[r,i])[0],r=e[1]),n<s&&(s=(e=[n,s])[0],n=e[1]),u.zoom({originalEvent:t,xAxis:[{axis:l,min:i-a,max:r+a}],yAxis:[{axis:p,min:s-o,max:n+o}]}))})},n.prototype.getClusterDistancesFromPoint=function(t,e,a){for(var o,i=this.xAxis,r=this.yAxis,n=[],s=0;s<t.length;s++)o=Math.sqrt(Math.pow(i.toPixels(e)-i.toPixels(t[s].posX),2)+Math.pow(r.toPixels(a)-r.toPixels(t[s].posY),2)),n.push({clusterIndex:s,distance:o});return n.sort(function(t,e){return t.distance-e.distance})},n.prototype.getPointsState=function(t,e,a){var o,i,r,n=e?h(e,a):[],s=h(t,a),l={};for(c=[],t.clusters.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),r=0;r<s.length;r++)o=s[r],i=n[r],o&&i&&o.parentStateId&&i.parentStateId&&l[o.parentStateId]&&-1===l[o.parentStateId].parentsId.indexOf(i.parentStateId)&&(l[o.parentStateId].parentsId.push(i.parentStateId),-1===c.indexOf(i.parentStateId)&&c.push(i.parentStateId));return l},n.prototype.markerClusterAlgorithms={grid:function(t,e,a,o){for(var i,r,n=this.xAxis,s=this.yAxis,l={},p=this.getGridOffset(),u=this.getScaledGridSize(o),d=0;d<t.length;d++)r=n.toPixels(t[d])-p.plotLeft,i=s.toPixels(e[d])-p.plotTop,r=Math.floor(r/u),l[r=Math.floor(i/u)+"-"+r]||(l[r]=[]),l[r].push({dataIndex:a[d],x:t[d],y:e[d]});return l},kmeans:function(t,e,a,o){var i,r,n,s,l,p,u,d=this,c=[],h=[],f={},m=o.processedDistance||z.layoutAlgorithm.distance,x=o.iterations,g=0,y=!0,C=[];for(l in o.processedGridSize=o.processedDistance,s=d.markerClusterAlgorithms?d.markerClusterAlgorithms.grid.call(d,t,e,a,o):{})1<s[l].length&&(n=E(s[l]),c.push({posX:n.x,posY:n.y,oldX:0,oldY:0,startPointsLen:s[l].length,points:[]}));for(;y;){for(c.map(function(t){return t.points.length=0,t}),p=h.length=0;p<t.length;p++)i=t[p],r=e[p],((C=d.getClusterDistancesFromPoint(c,i,r)).length&&C[0].distance<m?c[C[0].clusterIndex].points:h).push({x:i,y:r,dataIndex:a[p]});for(u=0;u<c.length;u++)1===c[u].points.length&&(C=d.getClusterDistancesFromPoint(c,c[u].points[0].x,c[u].points[0].y))[1].distance<m&&(c[C[1].clusterIndex].points.push(c[u].points[0]),c[C[0].clusterIndex].points.length=0);for(y=!1,u=0;u<c.length;u++)n=E(c[u].points),c[u].oldX=c[u].posX,c[u].oldY=c[u].posY,c[u].posX=n.x,c[u].posY=n.y,(c[u].posX>c[u].oldX+1||c[u].posX<c[u].oldX-1||c[u].posY>c[u].oldY+1||c[u].posY<c[u].oldY-1)&&(y=!0);x&&(y=g<x-1),g++}return c.forEach(function(t,e){f["cluster"+e]=t.points}),h.forEach(function(t,e){f["noise"+e]=[t]}),f},optimizedKmeans:function(t,e,a,o){var i,r,n=this,s=n.xAxis,l=n.yAxis,p=o.processedDistance||z.layoutAlgorithm.gridSize,u={},d=n.getRealExtremes(),c=(n.options.cluster||{}).marker;return!n.markerClusterInfo||n.initMaxX&&n.initMaxX<d.maxX||n.initMinX&&n.initMinX>d.minX||n.initMaxY&&n.initMaxY<d.maxY||n.initMinY&&n.initMinY>d.minY?(n.initMaxX=d.maxX,n.initMinX=d.minX,n.initMaxY=d.maxY,n.initMinY=d.minY,u=n.markerClusterAlgorithms?n.markerClusterAlgorithms.kmeans.call(n,t,e,a,o):{},n.baseClusters=null):(n.baseClusters||(n.baseClusters={clusters:n.markerClusterInfo.clusters,noise:n.markerClusterInfo.noise}),n.baseClusters.clusters.forEach(function(a){a.pointsOutside=[],a.pointsInside=[],a.data.forEach(function(t){i=Math.sqrt(Math.pow(s.toPixels(t.x)-s.toPixels(a.x),2)+Math.pow(l.toPixels(t.y)-l.toPixels(a.y),2)),(r=(a.clusterZone&&a.clusterZone.marker&&a.clusterZone.marker.radius?a.clusterZone.marker:c&&c.radius?c:z.marker).radius)+(0<=p-r?p-r:r)<i&&v(a.pointsOutside)?a.pointsOutside.push(t):v(a.pointsInside)&&a.pointsInside.push(t)}),a.pointsInside.length&&(u[a.id]=a.pointsInside),a.pointsOutside.forEach(function(t,e){u[a.id+"_noise"+e]=[t]})}),n.baseClusters.noise.forEach(function(t){u[t.id]=t.data})),u}},n.prototype.preventClusterCollisions=function(t){var a,o,i,e,r,n,s,l,p,u,d,c=this,h=c.xAxis,f=c.yAxis,m=t.key.split("-").map(parseFloat),x=m[0],g=m[1],y=t.gridSize,C=t.groupedData,I=t.defaultRadius,k=t.clusterRadius,S=g*y,A=x*y,b=h.toPixels(t.x),M=f.toPixels(t.y),D=[],P=0,X=(c.options.cluster||{}).marker,Y=(c.options.cluster||{}).zones,L=c.getGridOffset();for(b-=L.plotLeft,M-=L.plotTop,n=1;n<5;n++)for(e=n%2?-1:1,r=n<3?-1:1,e=Math.floor((b+e*k)/y),d=[(r=Math.floor((M+r*k)/y))+"-"+e,r+"-"+g,x+"-"+e],s=0;s<d.length;s++)-1===D.indexOf(d[s])&&d[s]!==t.key&&D.push(d[s]);return D.forEach(function(t){var e;if(C[t]){if(C[t].posX||(u=E(C[t]),C[t].posX=u.x,C[t].posY=u.y),o=h.toPixels(C[t].posX||0)-L.plotLeft,i=f.toPixels(C[t].posY||0)-L.plotTop,e=t.split("-").map(parseFloat),p=e[0],l=e[1],Y)for(a=C[t].length,n=0;n<Y.length;n++)a>=Y[n].from&&a<=Y[n].to&&(P=v((Y[n].marker||{}).radius)?Y[n].marker.radius||0:(X&&X.radius?X:z.marker).radius);1<C[t].length&&0===P&&X&&X.radius?P=X.radius:1===C[t].length&&(P=I),u=k+P,P=0,l!==g&&Math.abs(b-o)<u&&(b=l-g<0?S+k:S+y-k),p!==x&&Math.abs(M-i)<u&&(M=p-x<0?A+k:A+y-k)}}),m=h.toValue(b+L.plotLeft),c=f.toValue(M+L.plotTop),{x:C[t.key].posX=m,y:C[t.key].posY=c}},n.prototype.isValidGroupedDataObject=function(t){var e,a=!1;return!!D(t)&&(S(t,function(t){if(a=!0,b(t)&&t.length){for(e=0;e<t.length;e++)if(!D(t[e])||!t[e].x||!t[e].y)return void(a=!1)}else a=!1}),a)},n.prototype.getClusteredData=function(t,e){var a,o,i,r,n,s,l,p,u,d,c,h,f,m=this,x=[],g=[],y=[],C=[],I=[],k=0,S=Math.max(2,e.minimumClusterSize||2);if(M(e.layoutAlgorithm.type)&&!m.isValidGroupedDataObject(t))return A("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,m.chart),!1;for(f in t)if(t[f].length>=S){if(i=t[f],a=O(),n=i.length,e.zones)for(h=0;h<e.zones.length;h++)n>=e.zones[h].from&&n<=e.zones[h].to&&((d=e.zones[h]).zoneIndex=h,u=e.zones[h].marker,c=e.zones[h].className);for(p=E(i),s="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:p.x,y:p.y}:(s=m.options.marker||{},m.preventClusterCollisions({x:p.x,y:p.y,key:f,groupedData:t,gridSize:m.getScaledGridSize(e.layoutAlgorithm),defaultRadius:s.radius||3+(s.lineWidth||0),clusterRadius:u&&u.radius?u.radius:(e.marker||{}).radius||z.marker.radius})),h=0;h<n;h++)i[h].parentStateId=a;if(y.push({x:s.x,y:s.y,id:f,stateId:a,index:k,data:i,clusterZone:d,clusterZoneClassName:c}),x.push(s.x),g.push(s.y),I.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:P(e.marker,{states:e.states},u||{})}}),m.options.data&&m.options.data.length)for(h=0;h<n;h++)D(m.options.data[i[h].dataIndex])&&(i[h].options=m.options.data[i[h].dataIndex]);k++,u=null}else for(h=0;h<t[f].length;h++)o=t[f][h],a=O(),l=null,r=((m.options||{}).data||[])[o.dataIndex],x.push(o.x),g.push(o.y),o.parentStateId=a,C.push({x:o.x,y:o.y,id:f,stateId:a,index:k,data:t[f]}),l=r&&"object"==typeof r&&!b(r)?P(r,{x:o.x,y:o.y}):{userOptions:r,x:o.x,y:o.y},I.push({options:l}),k++;return{clusters:y,noise:C,groupedXData:x,groupedYData:g,groupMap:I}},n.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},n.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},a=c.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==a.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},n.prototype.generatePoints=function(){var t,e,a,o,i,r,n,s,l,p,u,d=this,c=d.chart,h=d.xAxis,f=d.yAxis,m=d.options.cluster,x=d.getRealExtremes(),g=[],y=[],C=[];if(m&&m.enabled&&d.xData&&d.xData.length&&d.yData&&d.yData.length&&!c.polar){for(n=m.layoutAlgorithm.type,(s=m.layoutAlgorithm).processedGridSize=X(s.gridSize||z.layoutAlgorithm.gridSize,c.plotWidth),s.processedDistance=X(s.distance||z.layoutAlgorithm.distance,c.plotWidth),c=s.kmeansThreshold||z.layoutAlgorithm.kmeansThreshold,t=Math.abs(h.toValue(s.processedGridSize/2)-h.toValue(0)),e=Math.abs(f.toValue(s.processedGridSize/2)-f.toValue(0)),p=0;p<d.xData.length;p++)d.dataMaxX||(v(o)&&v(a)&&v(r)&&v(i)?k(d.yData[p])&&k(r)&&k(i)&&(o=Math.max(d.xData[p],o),a=Math.min(d.xData[p],a),r=Math.max(d.yData[p]||r,r),i=Math.min(d.yData[p]||i,i)):(o=a=d.xData[p],r=i=d.yData[p])),d.xData[p]>=x.minX-t&&d.xData[p]<=x.maxX+t&&(d.yData[p]||x.minY)>=x.minY-e&&(d.yData[p]||x.maxY)<=x.maxY+e&&(g.push(d.xData[p]),y.push(d.yData[p]),C.push(p));v(o)&&v(a)&&k(r)&&k(i)&&(d.dataMaxX=o,d.dataMinX=a,d.dataMaxY=r,d.dataMinY=i),c=(n=(M(n)?n:d.markerClusterAlgorithms?n&&d.markerClusterAlgorithms[n]?d.markerClusterAlgorithms[n]:g.length<c?d.markerClusterAlgorithms.kmeans:d.markerClusterAlgorithms.grid:function(){return!1}).call(this,g,y,C,s))&&d.getClusteredData(n,m),s=m.animation&&d.markerClusterInfo&&d.markerClusterInfo.pointsState&&d.markerClusterInfo.pointsState.oldState?((u=d.markerClusterInfo.pointsState.oldState)&&S(u,function(t){t.point&&t.point.destroy&&t.point.destroy()}),d.markerClusterInfo.pointsState.newState):{},n=d.xData.length,u=d.markerClusterInfo,c&&(d.processedXData=c.groupedXData,d.processedYData=c.groupedYData,d.hasGroupedData=!0,d.markerClusterInfo=c,d.groupMap=c.groupMap),Y.apply(this),c&&d.markerClusterInfo&&((d.markerClusterInfo.clusters||[]).forEach(function(t){(l=d.points[t.index]).isCluster=!0,l.clusteredData=t.data,l.clusterPointsAmount=t.data.length,t.point=l,I(l,"click",d.onDrillToCluster)}),(d.markerClusterInfo.noise||[]).forEach(function(t){t.point=d.points[t.index]}),m.animation&&d.markerClusterInfo&&(d.markerClusterInfo.pointsState={oldState:s,newState:d.getPointsState(c,u,n)}),m.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else Y.apply(this)},I(e,"render",function(){(this.series||[]).forEach(function(e){var t,a;e.markerClusterInfo&&(t=e.options.cluster,a=((e.markerClusterInfo||{}).pointsState||{}).oldState,(t||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==(e.xAxis.eventArgs||{}).trigger&&a&&Object.keys(a).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),I(i,"update",function(){if(this.dataGroup)return A("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),I(r,"destroy",n.prototype.destroyClusteredData),I(r,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),v(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),I(i,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;M(e)&&e.call(this,t)}),I(p,"setExtremes",function(){var e,t=this.chart,a=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=x((t.options.cluster||{}).animation),a=e.duration||0)}),g(function(){t.tooltip&&t.tooltip.destroy()},a)})}),e(t,"masters/modules/marker-clusters.src.js",[],function(){})});