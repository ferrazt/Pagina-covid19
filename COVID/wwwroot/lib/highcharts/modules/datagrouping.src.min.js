"use strict";!function(a){"object"==typeof module&&module.exports?module.exports=a.default=a:"function"==typeof define&&define.amd?define("highcharts/modules/datagrouping",["highcharts"],function(t){return a(t),a.Highcharts=t,a}):a("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){t=t?t._modules:{};function a(t,a,o,e){t.hasOwnProperty(a)||(t[a]=e.apply(null,o))}a(t,"Extensions/DataGrouping.js",[t["Core/Axis/Axis.js"],t["Core/Axis/DateTimeAxis.js"],t["Core/FormatUtilities.js"],t["Core/Globals.js"],t["Core/Series/Point.js"],t["Core/Series/Series.js"],t["Core/Tooltip.js"],t["Core/DefaultOptions.js"],t["Core/Utilities.js"]],function(e,x,t,a,o,i,r,n,s){var g=t.format,D=i.prototype,p=s.addEvent,u=s.arrayMax,l=s.arrayMin,d=s.correctFloat,k=s.defined,G=s.error,c=s.extend,W=s.isNumber,j=s.merge,M=s.pick,F=a.approximations={sum:function(t){var a,o=t.length;if(!o&&t.hasNulls)a=null;else if(o)for(a=0;o--;)a+=t[o];return a},average:function(t){var a=t.length,t=F.sum(t);return t=W(t)&&a?d(t/a):t},averages:function(){var a=[];return[].forEach.call(arguments,function(t){a.push(F.average(t))}),void 0===a[0]?void 0:a},open:function(t){return t.length?t[0]:t.hasNulls?null:void 0},high:function(t){return t.length?u(t):t.hasNulls?null:void 0},low:function(t){return t.length?l(t):t.hasNulls?null:void 0},close:function(t){return t.length?t[t.length-1]:t.hasNulls?null:void 0},ohlc:function(t,a,o,e){if(t=F.open(t),a=F.high(a),o=F.low(o),e=F.close(e),W(t)||W(a)||W(o)||W(e))return[t,a,o,e]},range:function(t,a){return t=F.low(t),a=F.high(a),W(t)||W(a)?[t,a]:null===t&&null===a?null:void 0}},t=function(t,a,o,e){var i,r,n,s,p,u,l=this,d=l.data,h=l.options&&l.options.data,g=[],c=[],f=[],m=t.length,x=!!a,D=[],G=l.pointArrayMap,M=G&&G.length,y=["x"].concat(G||["y"]),v=this.options.dataGrouping&&this.options.dataGrouping.groupAll,A=0,P=0;for(n="function"==typeof(u=e)?u:F[u]||F[l.getDGApproximation&&l.getDGApproximation()||"average"],M?G.forEach(function(){D.push([])}):D.push([]),s=M||1,p=0;p<=m&&!(t[p]>=o[0]);p++);for(;p<=m;p++){for(;void 0!==o[A+1]&&t[p]>=o[A+1]||p===m;){for(i=o[A],l.dataGroupInfo={start:v?P:l.cropStart+P,length:D[0].length},r=n.apply(l,D),l.pointClass&&!k(l.dataGroupInfo.options)&&(l.dataGroupInfo.options=j(l.pointClass.prototype.optionsToObject.call({series:l},l.options.data[l.cropStart+P])),y.forEach(function(t){delete l.dataGroupInfo.options[t]})),void 0!==r&&(g.push(i),c.push(r),f.push(l.dataGroupInfo)),P=p,H=0;H<s;H++)D[H].length=0,D[H].hasNulls=!1;if(A+=1,p===m)break}if(p===m)break;if(G)for(var S,b=l.options.dataGrouping&&l.options.dataGrouping.groupAll?p:l.cropStart+p,C=d&&d[b]||l.pointClass.prototype.applyOptions.apply({series:l},[h[b]]),H=0;H<M;H++)S=C[G[H]],W(S)?D[H].push(S):null===S&&(D[H].hasNulls=!0);else b=x?a[p]:null,W(b)?D[0].push(b):null===b&&(D[0].hasNulls=!0)}return{groupedXData:g,groupedYData:c,groupMap:f}},s={approximations:F,groupData:t},y=D.processData,h=D.generatePoints,f={groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%A, %b %e, %H:%M:%S.%L","%A, %b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%A, %b %e, %H:%M:%S","%A, %b %e, %H:%M:%S","-%H:%M:%S"],minute:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],hour:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],day:["%A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],week:["Week from %A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}},m={line:{},spline:{},area:{},areaspline:{},arearange:{},column:{groupPixelWidth:10},columnrange:{groupPixelWidth:10},candlestick:{groupPixelWidth:10},ohlc:{groupPixelWidth:5}},v=a.defaultDataGroupingUnits=[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]];return D.getDGApproximation=function(){return this.is("arearange")?"range":this.is("ohlc")?"ohlc":this.is("column")?"sum":"average"},D.groupData=t,D.processData=function(){var t,a=this,o=a.chart,e=a.options.dataGrouping,i=!1!==a.allowDG&&e&&M(e.enabled,o.options.isStock),r=a.visible||!o.options.chart.ignoreHiddenSeries,n=this.currentDataGrouping,s=!1;if(a.forceCrop=i,a.groupPixelWidth=null,a.hasProcessed=!0,i&&!a.requireSorting&&(a.requireSorting=s=!0),c=!1===y.apply(a,arguments)||!i,s&&(a.requireSorting=!1),!c){a.destroyGroupedData();var p=void 0,u=e.groupAll?a.xData:a.processedXData,l=e.groupAll?a.yData:a.processedYData,d=o.plotSizeX,h=a.xAxis,i=h.options.ordinal,s=a.groupPixelWidth=h.getGroupPixelWidth&&h.getGroupPixelWidth();if(s&&u&&u.length){a.isDirty=t=!0,a.points=null;var g=h.getExtremes(),c=g.min,g=g.max,i=i&&h.ordinal&&h.ordinal.getGroupIntervalFactor(c,g,a)||1,f=h.getTimeTicks(x.AdditionsClass.prototype.normalizeTimeTickInterval(s*(g-c)/d*i,e.units||v),Math.min(c,u[0]),Math.max(g,u[u.length-1]),h.options.startOfWeek,u,a.closestPointRange),c=D.groupData.apply(a,[u,l,f,e.approximation]),u=c.groupedXData,l=c.groupedYData,m=0;for(e&&e.smoothed&&u.length&&(e.firstAnchor="firstPoint",e.anchor="middle",e.lastAnchor="lastPoint",G(32,!1,o,{"dataGrouping.smoothed":"use dataGrouping.anchor"})),function(t,a,o){var e=t.options.dataGrouping,i=t.currentDataGrouping&&t.currentDataGrouping.gapSize;if(e&&t.xData&&i&&t.groupMap){var r,n=a.length-1,s=e.anchor,p=M(e.firstAnchor,s),u=M(e.lastAnchor,s);if(s&&"start"!==s)for(var l=i*{middle:.5,end:1}[s],d=a.length-1;d--&&0<d;)a[d]+=l;p&&"start"!==p&&t.xData[0]>=a[0]&&(r=t.groupMap[0].start,e=t.groupMap[0].length,s=void 0,W(r)&&W(e)&&(s=r+(e-1)),a[0]={middle:a[0]+.5*i,end:a[0]+i,firstPoint:t.xData[0],lastPoint:s&&t.xData[s]}[p]),u&&"start"!==u&&i&&a[n]>=o-i&&(o=t.groupMap[t.groupMap.length-1].start,a[n]={middle:a[n]+.5*i,end:a[n]+i,firstPoint:o&&t.xData[o],lastPoint:t.xData[t.xData.length-1]}[u])}}(a,u,g),p=1;p<f.length;p++)f.info.segmentStarts&&-1!==f.info.segmentStarts.indexOf(p)||(m=Math.max(f[p]-f[p-1],m));(g=f.info).gapSize=m,a.closestPointRange=f.info.totalRange,a.groupMap=c.groupMap,r&&(c=h,k((r=u)[0])&&W(c.min)&&W(c.dataMin)&&r[0]<c.min&&((!k(c.options.min)&&c.min<=c.dataMin||c.min===c.dataMin)&&(c.min=Math.min(r[0],c.min)),c.dataMin=Math.min(r[0],c.dataMin)),k(r[r.length-1])&&W(c.max)&&W(c.dataMax)&&r[r.length-1]>c.max&&((!k(c.options.max)&&W(c.dataMax)&&c.max>=c.dataMax||c.max===c.dataMax)&&(c.max=Math.max(r[r.length-1],c.max)),c.dataMax=Math.max(r[r.length-1],c.dataMax))),e.groupAll&&(u=(h=a.cropData(u,l,h.min,h.max,1)).xData,l=h.yData,a.cropStart=h.start),a.processedXData=u,a.processedYData=l}else a.groupMap=null;a.hasGroupedData=t,a.currentDataGrouping=g,a.preventGraphAnimation=(n&&n.totalRange)!==(g&&g.totalRange)}},D.destroyGroupedData=function(){this.groupedData&&(this.groupedData.forEach(function(t,a){t&&(this.groupedData[a]=t.destroy?t.destroy():null)},this),this.groupedData.length=0)},D.generatePoints=function(){h.apply(this),this.destroyGroupedData(),this.groupedData=this.hasGroupedData?this.points:null},p(o,"update",function(){if(this.dataGroup)return G(24,!1,this.series.chart),!1}),p(r,"headerFormatter",function(t){var a,o,e=this.chart,i=e.time,r=t.labelConfig,n=r.series,s=n.options,p=n.tooltipOptions,u=s.dataGrouping,l=p.xDateFormat,d=n.xAxis,h=p[(t.isFooter?"footer":"header")+"Format"];d&&"datetime"===d.options.type&&u&&W(r.key)&&(o=n.currentDataGrouping,s=u.dateTimeLabelFormats||f.dateTimeLabelFormats,o?(u=s[o.unitName],1===o.count?l=u[0]:(l=u[1],a=u[2])):!l&&s&&(l=this.getXDateFormat(r,p,d)),l=i.dateFormat(l,r.key),a&&(l+=i.dateFormat(a,r.key+o.totalRange-1)),n.chart.styledMode&&(h=this.styledModeFormat(h)),t.text=g(h,{point:c(r.point,{key:l}),series:n},e),t.preventDefault())}),p(i,"destroy",D.destroyGroupedData),p(i,"afterSetOptions",function(t){var a=t.options,o=this.type,e=this.chart.options.plotOptions,i=n.defaultOptions.plotOptions[o].dataGrouping,r=this.useCommonDataGrouping&&f;(m[o]||r)&&(i=i||j(f,m[o]),t=this.chart.rangeSelector,a.dataGrouping=j(r,i,e.series&&e.series.dataGrouping,e[o].dataGrouping,this.userOptions.dataGrouping,!a.isInternal&&t&&W(t.selected)&&t.buttonOptions[t.selected].dataGrouping))}),p(e,"afterSetScale",function(){this.series.forEach(function(t){t.hasProcessed=!1})}),e.prototype.getGroupPixelWidth=function(){for(var t,a,o=this.series,e=o.length,i=0,r=!1,n=e;n--;)(a=o[n].options.dataGrouping)&&(i=Math.max(i,M(a.groupPixelWidth,f.groupPixelWidth)));for(n=e;n--;)(a=o[n].options.dataGrouping)&&o[n].hasProcessed&&(t=(o[n].processedXData||o[n].data).length,(o[n].groupPixelWidth||t>this.chart.plotSizeX/i||t&&a.forced)&&(r=!0));return r?i:0},e.prototype.setDataGrouping=function(a,t){var o;if(t=M(t,!0),a=a||{forced:!1,units:null},this instanceof e)for(o=this.series.length;o--;)this.series[o].update({dataGrouping:a},!1);else this.chart.options.series.forEach(function(t){t.dataGrouping=a},!1);this.ordinal&&(this.ordinal.slope=void 0),t&&this.chart.redraw()},a.dataGrouping=s}),a(t,"masters/modules/datagrouping.src.js",[t["Extensions/DataGrouping.js"]],function(t){return t})});