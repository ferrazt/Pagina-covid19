"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/marker-clusters",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function e(t,e,i,a){t.hasOwnProperty(e)||(t[e]=a.apply(null,i))}e(t=t?t._modules:{},"Extensions/MarkerClusters.js",[t["Core/Animation/AnimationUtilities.js"],t["Core/Chart/Chart.js"],t["Core/DefaultOptions.js"],t["Core/Color/Palette.js"],t["Core/Series/Point.js"],t["Core/Series/Series.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Renderer/SVG/SVGRenderer.js"],t["Core/Utilities.js"],t["Core/Axis/Axis.js"]],function(t,e,i,a,r,o,s,n,l,p){function v(t){for(var e=t.length,i=0,a=0,r=0;r<e;r++)i+=t[r].x,a+=t[r].y;return{x:i/e,y:a/e}}function u(t,e){var i=[];return i.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){i[t.dataIndex]=t})}),t.noise.forEach(function(t){i[t.data[0].dataIndex]=t.data[0]}),i}function x(t,e,i,a,r){t.point&&(a&&t.point.graphic&&(t.point.graphic.show(),t.point.graphic.attr({opacity:e}).animate({opacity:1},i)),r&&t.point.dataLabel&&(t.point.dataLabel.show(),t.point.dataLabel.attr({opacity:e}).animate({opacity:1},i)))}function g(t,e,i){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),i&&t.point.dataLabel&&t.point.dataLabel.hide())}function y(t,e,i,a){x(t,a,i,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}var C=t.animObject;t=i.defaultOptions,s=s.seriesTypes;var d=n.prototype.symbols,I=l.addEvent,P=l.defined,k=l.error,S=l.isArray,A=l.isFunction,b=l.isObject,M=l.isNumber,D=l.merge,X=l.objectEach,Y=l.relativeLength,L=l.syncTimeout;n=s.scatter;var z=o.prototype.generatePoints,E=0,h=[],O={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:a.backgroundColor},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};(t.plotOptions||{}).series=D((t.plotOptions||{}).series,{cluster:O,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}}),d.cluster=function(t,e,i,a){var r=d.arc(t+(i/=2),e+(a/=2),i-4,a-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),o=d.arc(t+i,e+a,i-3,a-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i-2,open:!1});return d.arc(t+i,e+a,i-1,a-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i,open:!1}).concat(o,r)},n.prototype.animateClusterPoint=function(t){var e,i,a=this.xAxis,r=this.yAxis,o=this.chart,s=C((this.options.cluster||{}).animation),n=s.duration||500,l=(this.markerClusterInfo||{}).pointsState,p=(l||{}).newState,u=(l||{}).oldState,d=[],h=0,c=0,f=!1,m=!1;u&&p&&(e=p[t.stateId],h=a.toPixels(e.x)-o.plotLeft,c=r.toPixels(e.y)-o.plotTop,1===e.parentsId.length?(t=(p||{})[t.stateId].parentsId[0],i=u[t],e.point&&e.point.graphic&&i&&i.point&&i.point.plotX&&i.point.plotY&&i.point.plotX!==e.point.plotX&&i.point.plotY!==e.point.plotY&&(t=e.point.graphic.getBBox(),l=e.point.graphic&&e.point.graphic.isImg?0:t.width/2,e.point.graphic.attr({x:i.point.plotX-l,y:i.point.plotY-l}),e.point.graphic.animate({x:h-(e.point.graphic.radius||0),y:c-(e.point.graphic.radius||0)},s,function(){m=!0,i.point&&i.point.destroy&&i.point.destroy()}),e.point.dataLabel&&e.point.dataLabel.alignAttr&&i.point.dataLabel&&i.point.dataLabel.alignAttr&&(e.point.dataLabel.attr({x:i.point.dataLabel.alignAttr.x,y:i.point.dataLabel.alignAttr.y}),e.point.dataLabel.animate({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y},s)))):0===e.parentsId.length?(g(e,!0,!0),L(function(){x(e,.1,s,!0,!0)},n/2)):(g(e,!0,!0),e.parentsId.forEach(function(t){u&&u[t]&&(i=u[t],d.push(i),i.point&&i.point.graphic&&(f=!0,i.point.graphic.show(),i.point.graphic.animate({x:h-(i.point.graphic.radius||0),y:c-(i.point.graphic.radius||0),opacity:.4},s,function(){m=!0,y(e,d,s,.7)}),i.point.dataLabel&&-9999!==i.point.dataLabel.y&&e.point&&e.point.dataLabel&&e.point.dataLabel.alignAttr&&(i.point.dataLabel.show(),i.point.dataLabel.animate({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y,opacity:.4},s))))}),L(function(){m||y(e,d,s,.85)},n),f||L(function(){y(e,d,s,.1)},n/2)))},n.prototype.getGridOffset=function(){var t=this.chart,e=this.xAxis,i=this.yAxis;return{plotLeft:e=this.dataMinX&&this.dataMaxX?e.reversed?e.toPixels(this.dataMaxX):e.toPixels(this.dataMinX):t.plotLeft,plotTop:t=this.dataMinY&&this.dataMaxY?i.reversed?i.toPixels(this.dataMinY):i.toPixels(this.dataMaxY):t.plotTop}},n.prototype.getScaledGridSize=function(t){var e=this.xAxis,i=!0,a=1,r=1;for(t=t.processedGridSize||O.layoutAlgorithm.gridSize,this.gridValueSize||(this.gridValueSize=Math.abs(e.toValue(t)-e.toValue(0))),e=+(t/(e=e.toPixels(this.gridValueSize)-e.toPixels(0))).toFixed(14);i&&1!==e;){var o=Math.pow(2,a);.75<e&&e<1.25?i=!1:1/o<=e&&e<1/o*2?(i=!1,r=o):e<=o&&o/2<e&&(i=!1,r=1/o),a++}return t/r/e},n.prototype.getRealExtremes=function(){var t=this.chart,e=this.xAxis,i=this.yAxis,a=e?e.toValue(t.plotLeft):0,e=e?e.toValue(t.plotLeft+t.plotWidth):0,r=i?i.toValue(t.plotTop):0,t=i?i.toValue(t.plotTop+t.plotHeight):0;return e<a&&(e=(a=[a,e])[0],a=a[1]),t<r&&(t=(r=[r,t])[0],r=r[1]),{minX:a,maxX:e,minY:r,maxY:t}},n.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,i,a,r,o,s=t.point||t.target,n=s.series.xAxis,l=s.series.yAxis,p=s.series.chart;(s.series.options.cluster||{}).drillToCluster&&s.clusteredData&&(i=s.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),r=s.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),s=i[0],e=i[i.length-1],i=r[0],a=r[r.length-1],r=Math.abs(.1*(e-s)),o=Math.abs(.1*(a-i)),p.pointer.zoomX=!0,p.pointer.zoomY=!0,e<s&&(s=(e=[e,s])[0],e=e[1]),a<i&&(i=(a=[a,i])[0],a=a[1]),p.zoom({originalEvent:t,xAxis:[{axis:n,min:s-r,max:e+r}],yAxis:[{axis:l,min:i-o,max:a+o}]}))})},n.prototype.getClusterDistancesFromPoint=function(t,e,i){for(var a=this.xAxis,r=this.yAxis,o=[],s=0;s<t.length;s++){var n=Math.sqrt(Math.pow(a.toPixels(e)-a.toPixels(t[s].posX),2)+Math.pow(r.toPixels(i)-r.toPixels(t[s].posY),2));o.push({clusterIndex:s,distance:n})}return o.sort(function(t,e){return t.distance-e.distance})},n.prototype.getPointsState=function(t,e,i){e=e?u(e,i):[],i=u(t,i);var a,r={};for(h=[],t.clusters.forEach(function(t){r[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){r[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),a=0;a<i.length;a++){t=i[a];var o=e[a];t&&o&&t.parentStateId&&o.parentStateId&&r[t.parentStateId]&&-1===r[t.parentStateId].parentsId.indexOf(o.parentStateId)&&(r[t.parentStateId].parentsId.push(o.parentStateId),-1===h.indexOf(o.parentStateId)&&h.push(o.parentStateId))}return r},n.prototype.markerClusterAlgorithms={grid:function(t,e,i,a){var r,o=this.xAxis,s=this.yAxis,n={},l=this.getGridOffset();for(a=this.getScaledGridSize(a),r=0;r<t.length;r++){var p=o.toPixels(t[r])-l.plotLeft,u=s.toPixels(e[r])-l.plotTop,p=Math.floor(p/a);n[u=(u=Math.floor(u/a))+"-"+p]||(n[u]=[]),n[u].push({dataIndex:i[r],x:t[r],y:e[r]})}return n},kmeans:function(t,e,i,a){var r,o,s=[],n=[],l={},p=a.processedDistance||O.layoutAlgorithm.distance,u=a.iterations,d=0,h=!0,c=0,f=[];for(o in a.processedGridSize=a.processedDistance,c=this.markerClusterAlgorithms?this.markerClusterAlgorithms.grid.call(this,t,e,i,a):{})1<c[o].length&&(f=v(c[o]),s.push({posX:f.x,posY:f.y,oldX:0,oldY:0,startPointsLen:c[o].length,points:[]}));for(;h;){for(s.map(function(t){return t.points.length=0,t}),h=n.length=0;h<t.length;h++)c=t[h],r=e[h],((f=this.getClusterDistancesFromPoint(s,c,r)).length&&f[0].distance<p?s[f[0].clusterIndex].points:n).push({x:c,y:r,dataIndex:i[h]});for(o=0;o<s.length;o++)1===s[o].points.length&&((f=this.getClusterDistancesFromPoint(s,s[o].points[0].x,s[o].points[0].y))[1].distance<p&&(s[f[1].clusterIndex].points.push(s[o].points[0]),s[f[0].clusterIndex].points.length=0));for(h=!1,o=0;o<s.length;o++)f=v(s[o].points),s[o].oldX=s[o].posX,s[o].oldY=s[o].posY,s[o].posX=f.x,s[o].posY=f.y,(s[o].posX>s[o].oldX+1||s[o].posX<s[o].oldX-1||s[o].posY>s[o].oldY+1||s[o].posY<s[o].oldY-1)&&(h=!0);u&&(h=d<u-1),d++}return s.forEach(function(t,e){l["cluster"+e]=t.points}),n.forEach(function(t,e){l["noise"+e]=[t]}),l},optimizedKmeans:function(t,e,i,a){var r,o,s=this.xAxis,n=this.yAxis,l=a.processedDistance||O.layoutAlgorithm.gridSize,p={},u=this.getRealExtremes(),d=(this.options.cluster||{}).marker;return!this.markerClusterInfo||this.initMaxX&&this.initMaxX<u.maxX||this.initMinX&&this.initMinX>u.minX||this.initMaxY&&this.initMaxY<u.maxY||this.initMinY&&this.initMinY>u.minY?(this.initMaxX=u.maxX,this.initMinX=u.minX,this.initMaxY=u.maxY,this.initMinY=u.minY,p=this.markerClusterAlgorithms?this.markerClusterAlgorithms.kmeans.call(this,t,e,i,a):{},this.baseClusters=null):(this.baseClusters||(this.baseClusters={clusters:this.markerClusterInfo.clusters,noise:this.markerClusterInfo.noise}),this.baseClusters.clusters.forEach(function(i){i.pointsOutside=[],i.pointsInside=[],i.data.forEach(function(t){r=Math.sqrt(Math.pow(s.toPixels(t.x)-s.toPixels(i.x),2)+Math.pow(n.toPixels(t.y)-n.toPixels(i.y),2)),(o=(i.clusterZone&&i.clusterZone.marker&&i.clusterZone.marker.radius?i.clusterZone.marker:d&&d.radius?d:O.marker).radius)+(0<=l-o?l-o:o)<r&&P(i.pointsOutside)?i.pointsOutside.push(t):P(i.pointsInside)&&i.pointsInside.push(t)}),i.pointsInside.length&&(p[i.id]=i.pointsInside),i.pointsOutside.forEach(function(t,e){p[i.id+"_noise"+e]=[t]})}),this.baseClusters.noise.forEach(function(t){p[t.id]=t.data})),p}},n.prototype.preventClusterCollisions=function(t){var i,a,r,o,s,n,l,p=this.xAxis,u=this.yAxis,d=(e=t.key.split("-").map(parseFloat))[0],h=e[1],c=t.gridSize,f=t.groupedData,m=t.defaultRadius,x=t.clusterRadius,g=h*c,y=d*c,C=p.toPixels(t.x),I=u.toPixels(t.y),e=[],k=0,S=(this.options.cluster||{}).marker,A=(this.options.cluster||{}).zones,b=this.getGridOffset();for(C-=b.plotLeft,I-=b.plotTop,o=1;o<5;o++){var M=o%2?-1:1,D=o<3?-1:1,M=Math.floor((C+M*x)/c);for(M=[(D=Math.floor((I+D*x)/c))+"-"+M,D+"-"+h,d+"-"+M],D=0;D<M.length;D++)-1===e.indexOf(M[D])&&M[D]!==t.key&&e.push(M[D])}return e.forEach(function(t){if(f[t]){f[t].posX||(l=v(f[t]),f[t].posX=l.x,f[t].posY=l.y),a=p.toPixels(f[t].posX||0)-b.plotLeft,r=u.toPixels(f[t].posY||0)-b.plotTop;var e=t.split("-").map(parseFloat);if(n=e[0],s=e[1],A)for(i=f[t].length,o=0;o<A.length;o++)i>=A[o].from&&i<=A[o].to&&(k=P((A[o].marker||{}).radius)?A[o].marker.radius||0:(S&&S.radius?S:O.marker).radius);1<f[t].length&&0===k&&S&&S.radius?k=S.radius:1===f[t].length&&(k=m),l=x+k,k=0,s!==h&&Math.abs(C-a)<l&&(C=s-h<0?g+x:g+c-x),n!==d&&Math.abs(I-r)<l&&(I=n-d<0?y+x:y+c-x)}}),e=p.toValue(C+b.plotLeft),D=u.toValue(I+b.plotTop),{x:f[t.key].posX=e,y:f[t.key].posY=D}},n.prototype.isValidGroupedDataObject=function(t){var e,i=!1;return!!b(t)&&(X(t,function(t){if(i=!0,S(t)&&t.length){for(e=0;e<t.length;e++)if(!b(t[e])||!t[e].x||!t[e].y){i=!1;break}}else i=!1}),i)},n.prototype.getClusteredData=function(t,e){var i,a=[],r=[],o=[],s=[],n=[],l=0,p=Math.max(2,e.minimumClusterSize||2);if(A(e.layoutAlgorithm.type)&&!this.isValidGroupedDataObject(t))return k("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,this.chart),!1;for(i in t)if(t[i].length>=p){var u,d,h,c=t[i],f=Math.random().toString(36).substring(2,7)+"-"+E++,m=c.length;if(e.zones)for(g=0;g<e.zones.length;g++)m>=e.zones[g].from&&m<=e.zones[g].to&&((u=e.zones[g]).zoneIndex=g,d=e.zones[g].marker,h=e.zones[g].className);for(var x=v(c),x="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:x.x,y:x.y}:(g=this.options.marker||{},this.preventClusterCollisions({x:x.x,y:x.y,key:i,groupedData:t,gridSize:this.getScaledGridSize(e.layoutAlgorithm),defaultRadius:g.radius||3+(g.lineWidth||0),clusterRadius:d&&d.radius?d.radius:(e.marker||{}).radius||O.marker.radius})),g=0;g<m;g++)c[g].parentStateId=f;if(o.push({x:x.x,y:x.y,id:i,stateId:f,index:l,data:c,clusterZone:u,clusterZoneClassName:h}),a.push(x.x),r.push(x.y),n.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:D(e.marker,{states:e.states},d||{})}}),this.options.data&&this.options.data.length)for(g=0;g<m;g++)b(this.options.data[c[g].dataIndex])&&(c[g].options=this.options.data[c[g].dataIndex]);l++,d=null}else for(g=0;g<t[i].length;g++)c=t[i][g],f=Math.random().toString(36).substring(2,7)+"-"+E++,m=((this.options||{}).data||[])[c.dataIndex],a.push(c.x),r.push(c.y),c.parentStateId=f,s.push({x:c.x,y:c.y,id:i,stateId:f,index:l,data:t[i]}),f=m&&"object"==typeof m&&!S(m)?D(m,{x:c.x,y:c.y}):{userOptions:m,x:c.x,y:c.y},n.push({options:f}),l++;return{clusters:o,noise:s,groupedXData:a,groupedYData:r,groupMap:n}},n.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},n.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},i=h.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==i.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},n.prototype.generatePoints=function(){var t,e,i,a,r=this,o=r.chart,s=r.xAxis,n=r.yAxis,l=r.options.cluster,p=r.getRealExtremes(),u=[],d=[],h=[];if(l&&l.enabled&&r.xData&&r.xData.length&&r.yData&&r.yData.length&&!o.polar){var c,f,m=l.layoutAlgorithm.type,x=l.layoutAlgorithm;for(x.processedGridSize=Y(x.gridSize||O.layoutAlgorithm.gridSize,o.plotWidth),x.processedDistance=Y(x.distance||O.layoutAlgorithm.distance,o.plotWidth),o=x.kmeansThreshold||O.layoutAlgorithm.kmeansThreshold,s=Math.abs(s.toValue(x.processedGridSize/2)-s.toValue(0)),n=Math.abs(n.toValue(x.processedGridSize/2)-n.toValue(0)),a=0;a<r.xData.length;a++)r.dataMaxX||(P(c)&&P(t)&&P(f)&&P(e)?M(r.yData[a])&&M(f)&&M(e)&&(c=Math.max(r.xData[a],c),t=Math.min(r.xData[a],t),f=Math.max(r.yData[a]||f,f),e=Math.min(r.yData[a]||e,e)):(c=t=r.xData[a],f=e=r.yData[a])),r.xData[a]>=p.minX-s&&r.xData[a]<=p.maxX+s&&(r.yData[a]||p.minY)>=p.minY-n&&(r.yData[a]||p.maxY)<=p.maxY+n&&(u.push(r.xData[a]),d.push(r.yData[a]),h.push(a));P(c)&&P(t)&&M(f)&&M(e)&&(r.dataMaxX=c,r.dataMinX=t,r.dataMaxY=f,r.dataMinY=e),x=(u=(p=A(m)?m:r.markerClusterAlgorithms?m&&r.markerClusterAlgorithms[m]?r.markerClusterAlgorithms[m]:u.length<o?r.markerClusterAlgorithms.kmeans:r.markerClusterAlgorithms.grid:function(){return!1}).call(this,u,d,h,x))?r.getClusteredData(u,l):u,u=l.animation&&r.markerClusterInfo&&r.markerClusterInfo.pointsState&&r.markerClusterInfo.pointsState.oldState?((o=r.markerClusterInfo.pointsState.oldState)&&X(o,function(t){t.point&&t.point.destroy&&t.point.destroy()}),r.markerClusterInfo.pointsState.newState):{},d=r.xData.length,h=r.markerClusterInfo,x&&(r.processedXData=x.groupedXData,r.processedYData=x.groupedYData,r.hasGroupedData=!0,r.markerClusterInfo=x,r.groupMap=x.groupMap),z.apply(this),x&&r.markerClusterInfo&&((r.markerClusterInfo.clusters||[]).forEach(function(t){(i=r.points[t.index]).isCluster=!0,i.clusteredData=t.data,i.clusterPointsAmount=t.data.length,t.point=i,I(i,"click",r.onDrillToCluster)}),(r.markerClusterInfo.noise||[]).forEach(function(t){t.point=r.points[t.index]}),l.animation&&r.markerClusterInfo&&(r.markerClusterInfo.pointsState={oldState:u,newState:r.getPointsState(x,h,d)}),l.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else z.apply(this)},I(e,"render",function(){(this.series||[]).forEach(function(e){var t;e.markerClusterInfo&&(t=((e.markerClusterInfo||{}).pointsState||{}).oldState,(e.options.cluster||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==(e.xAxis.eventArgs||{}).trigger&&t&&Object.keys(t).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),I(r,"update",function(){if(this.dataGroup)return k("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),I(o,"destroy",n.prototype.destroyClusteredData),I(o,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),P(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),I(r,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;A(e)&&e.call(this,t)}),I(p,"setExtremes",function(){var e,t=this.chart,i=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=C((t.options.cluster||{}).animation),i=e.duration||0)}),L(function(){t.tooltip&&t.tooltip.destroy()},i)})}),e(t,"masters/modules/marker-clusters.src.js",[],function(){})});