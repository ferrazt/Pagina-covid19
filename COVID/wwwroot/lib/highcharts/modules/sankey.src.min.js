"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){o=o?o._modules:{};function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}t(o,"Mixins/Nodes.js",[o["Core/Globals.js"],o["Core/Series/Point.js"],o["Core/Series/Series.js"],o["Core/Utilities.js"]],function(o,i,n,t){var r=t.defined,s=t.extend,a=t.find,l=t.pick;return o.NodesMixin={createNode:function(o){function t(o,t){return a(o,function(o){return o.id===t})}var e,n=t(this.nodes,o),i=this.pointClass;return n||(e=this.options.nodes&&t(this.options.nodes,o),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=l(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var t=this.chart,e={};n.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){r(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=l(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),r(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),n.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),n.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(i.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&i.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&i.prototype.setState.apply(o.toNode,t)))}),i.prototype.setState.apply(this,t)}}}),t(o,"Series/Sankey/SankeyPoint.js",[o["Mixins/Nodes.js"],o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,e,t,i){var n,r,s=this&&this.__extends||(n=function(o,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}n(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),t=t.seriesTypes.column,a=i.defined,i=i.extend,s=(r=t.prototype.pointClass,s(l,r),l.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),a(this.options.level)&&(this.options.column=this.column=this.options.level),this},l.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},l.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},l);function l(){var o=null!==r&&r.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}return i(s.prototype,{setState:o.setNodeState}),s}),t(o,"Mixins/TreeSeries.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(y,o){function p(o){return"boolean"==typeof o}var c=o.extend,l=o.isArray,d=o.isNumber,h=o.isObject,u=o.merge,g=o.pick;return{getColor:function(o,t){var e,i,n,r,s,a,l=t.index,d=t.mapOptionsToLevel,h=t.parentColor,p=t.parentColorIndex,c=t.series,u=t.colors,f=t.siblings,m=c.points,v=c.chart.options.chart;return o&&(m=m[o.i],e=d[o.level]||{},m&&e.colorByPoint&&(r=m.index%(u?u.length:v.colorCount),i=u&&u[r]),c.chart.styledMode||(n=g(m&&m.options.color,e&&e.color,i,h&&(s=h,(a=e&&e.colorVariation)&&"brightness"===a.key?y.parse(s).brighten(a.to*(l/f)).get():s),c.color)),r=g(m&&m.options.colorIndex,e&&e.colorIndex,r,p,t.colorIndex)),{color:n,colorIndex:r}},getLevelOptions:function(o){var n,t,e,r,i,s,a=null;if(h(o))for(a={},r=d(o.from)?o.from:1,s=o.levels,t={},n=h(o.defaults)?o.defaults:{},l(s)&&(t=s.reduce(function(o,t){var e,i;return h(t)&&d(t.level)&&(i=u({},t),e=(p(i.levelIsConstant)?i:n).levelIsConstant,delete i.levelIsConstant,delete i.level,e=t.level+(e?0:r-1),h(o[e])?c(o[e],i):o[e]=i),o},{})),i=d(o.to)?o.to:1,e=0;e<=i;e++)a[e]=u({},n,h(t[e])?t[e]:{});return a},setTreeValues:function i(n,r){var o=r.before,t=r.idRoot,e=r.mapIdToNode[t],s=!p(r.levelIsConstant)||r.levelIsConstant,a=r.points[n.i],l=a&&a.options||{},d=0,h=[];return n.levelDynamic=n.level-(s?0:e.level),n.name=g(a&&a.name,""),n.visible=t===n.id||!!p(r.visible)&&r.visible,(n="function"==typeof o?o(n,r):n).children.forEach(function(o,t){var e=c({},r);c(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),h.push(o),o.visible&&(d+=o.val)}),n.visible=0<d||n.visible,l=g(l.value,d),n.children=h,n.childrenTotal=d,n.isLeaf=n.visible&&!d,n.val=l,n},updateRootId:function(o){var t;return h(o)&&(t=h(o.options)?o.options:{},t=g(o.rootNode,t.rootId,""),h(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Mixins/Nodes.js"],o["Series/Sankey/SankeyPoint.js"],o["Core/Series/SeriesRegistry.js"],o["Mixins/TreeSeries.js"],o["Core/Utilities.js"]],function(a,o,t,e,i,n,r){var s,l,d=this&&this.__extends||(s=function(o,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}s(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),h=i.series,p=i.seriesTypes.column,c=n.getLevelOptions,u=r.defined,n=r.extend,f=r.find,m=r.isObject,v=r.merge,y=r.pick,g=r.relativeLength,k=r.stableSort,d=(d(b,l=p),b.getDLOptions=function(o){var t=m(o.optionsPoint)?o.optionsPoint.dataLabels:{},o=m(o.level)?o.level.dataLabels:{};return v({style:{}},o,t)},b.prototype.createNodeColumn=function(){var a=this,t=this.chart,l=[];return l.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},l.offset=function(o,t){for(var e=0,i=a.nodePadding,n=0;n<l.length;n++){var r=l[n].getSum(),s=Math.max(r*t,a.options.minLinkWidth),s=r?s+i:0;if(l[n]===o)return{relativeTop:e+g(o.options.offset||0,s)};e+=s}},l.top=function(e){var i=a.nodePadding,o=this.reduce(function(o,t){return 0<o&&(o+=i),o+=Math.max(t.getSum()*e,a.options.minLinkWidth)},0);return(t.plotSizeY-o)/2},l},b.prototype.createNodeColumns=function(){var r=[];this.nodes.forEach(function(e){var o,i,t,n=-1;if(!u(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(i=0;i<e.linksTo.length;i++)(t=e.linksTo[0]).fromNode.column>n&&(n=(o=t.fromNode).column);e.column=n+1,o&&"hanging"===o.options.layout&&(e.hangsFrom=o,i=-1,f(o.linksFrom,function(o,t){o=o.toNode===e;return o&&(i=t),o}),e.column+=i)}r[e.column]||(r[e.column]=this.createNodeColumn()),r[e.column].push(e)},this);for(var o=0;o<r.length;o++)void 0===r[o]&&(r[o]=this.createNodeColumn());return r},b.prototype.generatePoints=function(){t.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),k(this.nodes,function(o,t){return o.level-t.level}))},b.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return!this.nodeColumns||(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o),t},b.prototype.hasData=function(){return!!this.processedXData.length},b.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=(o.isNode?o:o.fromNode).level,n=e.mapOptionsToLevel[i||0]||{},r=o.options,s=n.states&&n.states[t||""]||{},i=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=y(s[t],r[t],n[t],e.options[t]),o},{}),t=y(s.color,r.color,(i.colorByPoint?o:n).color);return o.isNode?{fill:t,stroke:i.borderColor,"stroke-width":i.borderWidth}:{fill:a.parse(t).setOpacity(i.linkOpacity).get()}},b.prototype.render=function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),p.prototype.render.call(this),this.points=o},b.prototype.translate=function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);var l=this,d=this.chart,h=this.options,o=this.nodeWidth,t=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=t.reduce(function(o,t){return Math.min(o,function(t){for(var o,e,i=t.slice(),n=a.options.minLinkWidth||0,r=0,s=d.plotSizeY-h.borderWidth-(t.length-1)*l.nodePadding;t.length;){for(r=s/t.sum(),o=!1,e=t.length;e--;)t[e].getSum()*r<n&&(t.splice(e,1),s-=n,o=!0);if(!o)break}return t.length=0,i.forEach(function(o){return t.push(o)}),r}(t))},1/0),this.colDistance=(d.plotSizeX-o-h.borderWidth)/Math.max(1,t.length-1),l.mapOptionsToLevel=c({from:1,levels:h.levels,to:t.length-1,defaults:{borderColor:h.borderColor,borderRadius:h.borderRadius,borderWidth:h.borderWidth,color:l.color,colorByPoint:h.colorByPoint,levelIsConstant:!0,linkColor:h.linkColor,linkLineWidth:h.linkLineWidth,linkOpacity:h.linkOpacity,states:h.states}}),t.forEach(function(t){t.forEach(function(o){l.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(l.translateLink(o),o.allowShadow=!1)})})},b.prototype.translateLink=function(e){var o,t,i,n,r,s,a,l,d,h,p,c,u=function(o,t){t=o.offset(e,t)*y;return Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-g)},f=e.fromNode,m=e.toNode,v=this.chart,y=this.translationFactor,g=Math.max(e.weight*y,this.options.minLinkWidth),k=this.options,b=(v.inverted?-this.colDistance:this.colDistance)*k.curveFactor,C=u(f,"linksFrom"),N=u(m,"linksTo"),S=f.nodeX,x=this.nodeWidth,P=m.column*this.colDistance,L=e.outgoing,O=S+x<P;v.inverted&&(C=v.plotSizeY-C,N=(v.plotSizeY||0)-N,P=v.plotSizeX-P,x=-x,g=-g,O=P<S),e.shapeType="path",e.linkBase=[C,C+g,N,N+g],O&&"number"==typeof N?e.shapeArgs={d:[["M",S+x,C],["C",S+x+b,C,P-b,N,P,N],["L",P+(L?x:0),N+g/2],["L",P,N+g],["C",P-b,N+g,S+x+b,C+g,S+x,C+g],["Z"]]}:"number"==typeof N&&(c=v.plotHeight-C-g,o=P-20-g,n=(i=(t=S+x)+20)+g,h=(d=(l=(a=(s=(r=C)+g)+20)+c)+20)+g,p=s-.7*g,k=d+.7*g,O=(m=(u=N)+g)-.7*g,b=(L=P)-.7*g,c=t+.7*g,e.shapeArgs={d:[["M",t,r],["C",c,r,n,p,n,a],["L",n,l],["C",n,k,c,h,t,h],["L",L,h],["C",b,h,o,k,o,l],["L",o,k=m+20],["C",o,O,b,u,L,u],["L",L,m],["C",u=P-20,m,u,m,u,k],["L",u,l],["C",u,d,u,d,L,d],["L",t,d],["C",i,d,i,d,i,l],["L",i,a],["C",i,s,i,s,t,s],["Z"]]}),e.dlBox={x:S+(P-S+x)/2,y:C+(N-C)/2,height:g,width:0},e.tooltipPos=v.inverted?[v.plotSizeY-e.dlBox.y-g/2,v.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+g/2],e.y=e.plotY=1,e.color||(e.color=f.color)},b.prototype.translateNode=function(o,t){var e=this.translationFactor,i=this.chart,n=this.options,r=o.getSum(),s=Math.max(Math.round(r*e),this.options.minLinkWidth),a=Math.round(n.borderWidth)%2/2,l=t.offset(o,e),d=Math.floor(y(l.absoluteTop,t.top(e)+l.relativeTop))+a,h=Math.floor(this.colDistance*o.column+n.borderWidth/2)+a,t=i.inverted?i.plotSizeX-h:h,e=Math.round(this.nodeWidth);(o.sum=r)?(o.shapeType="rect",l=o.nodeX=t,a=o.nodeY=d,h=o.options.width||n.width||e,r=o.options.height||n.height||s,i.inverted&&(l=t-e,a=i.plotSizeY-d-s,h=o.options.height||n.height||e,r=o.options.width||n.width||s),o.dlOptions=b.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=i.inverted?[i.plotSizeY-a-r/2,i.plotSizeX-l-h/2]:[l+h/2,a+r/2],o.shapeArgs={x:l,y:a,width:h,height:r,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},b.defaultOptions=v(p.defaultOptions,{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}),b);function b(){var o=null!==l&&l.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return n(d.prototype,{animate:h.prototype.animate,createNode:t.createNode,destroy:t.destroy,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,pointArrayMap:["from","to"],pointClass:e,searchPoint:o.noop,setData:t.setData}),i.registerSeriesType("sankey",d),d}),t(o,"masters/modules/sankey.src.js",[],function(){})});