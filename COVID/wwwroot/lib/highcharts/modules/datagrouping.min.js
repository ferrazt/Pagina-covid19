"use strict";!function(a){"object"==typeof module&&module.exports?module.exports=a.default=a:"function"==typeof define&&define.amd?define("highcharts/modules/datagrouping",["highcharts"],function(t){return a(t),a.Highcharts=t,a}):a("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function a(t,a,o,i){t.hasOwnProperty(a)||(t[a]=i.apply(null,o))}a(t=t?t._modules:{},"Extensions/DataGrouping.js",[t["Core/Axis/Axis.js"],t["Core/Axis/DateTimeAxis.js"],t["Core/FormatUtilities.js"],t["Core/Globals.js"],t["Core/Series/Point.js"],t["Core/Series/Series.js"],t["Core/Tooltip.js"],t["Core/DefaultOptions.js"],t["Core/Utilities.js"]],function(i,G,t,a,o,e,r,n,s){var d=t.format,v=e.prototype;t=s.addEvent;var p=s.arrayMax,h=s.arrayMin,u=s.correctFloat,P=s.defined,M=s.error,g=s.extend,S=s.isNumber,b=s.merge,y=s.pick,C=a.approximations={sum:function(t){var a=t.length;if(!a&&t.hasNulls)var o=null;else if(a)for(o=0;a--;)o+=t[a];return o},average:function(t){var a=t.length;return t=C.sum(t),t=S(t)&&a?u(t/a):t},averages:function(){var a=[];return[].forEach.call(arguments,function(t){a.push(C.average(t))}),void 0===a[0]?void 0:a},open:function(t){return t.length?t[0]:t.hasNulls?null:void 0},high:function(t){return t.length?p(t):t.hasNulls?null:void 0},low:function(t){return t.length?h(t):t.hasNulls?null:void 0},close:function(t){return t.length?t[t.length-1]:t.hasNulls?null:void 0},ohlc:function(t,a,o,i){if(t=C.open(t),a=C.high(a),o=C.low(o),i=C.close(i),S(t)||S(a)||S(o)||S(i))return[t,a,o,i]},range:function(t,a){return t=C.low(t),a=C.high(a),S(t)||S(a)?[t,a]:null===t&&null===a?null:void 0}},l={approximations:C,groupData:s=function(t,a,o,i){var e=this,r=e.data,n=e.options&&e.options.data,s=[],p=[],h=[],u=t.length,l=!!a,d=[],g=e.pointArrayMap,c=g&&g.length,f=["x"].concat(g||["y"]),m=this.options.dataGrouping&&this.options.dataGrouping.groupAll,x=0,D=0;i="function"==typeof i?i:C[i]||C[e.getDGApproximation&&e.getDGApproximation()||"average"],c?g.forEach(function(){d.push([])}):d.push([]);for(var G=c||1,v=0;v<=u&&!(t[v]>=o[0]);v++);for(;v<=u;v++){for(;void 0!==o[x+1]&&t[v]>=o[x+1]||v===u;){var M=o[x];e.dataGroupInfo={start:m?D:e.cropStart+D,length:d[0].length};var y=i.apply(e,d);for(e.pointClass&&!P(e.dataGroupInfo.options)&&(e.dataGroupInfo.options=b(e.pointClass.prototype.optionsToObject.call({series:e},e.options.data[e.cropStart+D])),f.forEach(function(t){delete e.dataGroupInfo.options[t]})),void 0!==y&&(s.push(M),p.push(y),h.push(e.dataGroupInfo)),D=v,M=0;M<G;M++)d[M].length=0,d[M].hasNulls=!1;if(x+=1,v===u)break}if(v===u)break;if(g){var A,M=e.options.dataGrouping&&e.options.dataGrouping.groupAll?v:e.cropStart+v,y=r&&r[M]||e.pointClass.prototype.applyOptions.apply({series:e},[n[M]]);for(M=0;M<c;M++)A=y[g[M]],S(A)?d[M].push(A):null===A&&(d[M].hasNulls=!0)}else M=l?a[v]:null,S(M)?d[0].push(M):null===M&&(d[0].hasNulls=!0)}return{groupedXData:s,groupedYData:p,groupMap:h}}},A=v.processData,c=v.generatePoints,f={groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%A, %b %e, %H:%M:%S.%L","%A, %b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%A, %b %e, %H:%M:%S","%A, %b %e, %H:%M:%S","-%H:%M:%S"],minute:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],hour:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],day:["%A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],week:["Week from %A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}},m={line:{},spline:{},area:{},areaspline:{},arearange:{},column:{groupPixelWidth:10},columnrange:{groupPixelWidth:10},candlestick:{groupPixelWidth:10},ohlc:{groupPixelWidth:5}},H=a.defaultDataGroupingUnits=[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]];return v.getDGApproximation=function(){return this.is("arearange")?"range":this.is("ohlc")?"ohlc":this.is("column")?"sum":"average"},v.groupData=s,v.processData=function(){var t,a=this.chart,o=this.options.dataGrouping,i=!1!==this.allowDG&&o&&y(o.enabled,a.options.isStock),e=this.visible||!a.options.chart.ignoreHiddenSeries,r=this.currentDataGrouping,n=!1;if(this.forceCrop=i,this.groupPixelWidth=null,this.hasProcessed=!0,i&&!this.requireSorting&&(this.requireSorting=n=!0),i=!1===A.apply(this,arguments)||!i,n&&(this.requireSorting=!1),!i){this.destroyGroupedData();var s=o.groupAll?this.xData:this.processedXData,p=o.groupAll?this.yData:this.processedYData;i=a.plotSizeX;var h=(n=this.xAxis).options.ordinal;if((u=this.groupPixelWidth=n.getGroupPixelWidth&&n.getGroupPixelWidth())&&s&&s.length){this.isDirty=t=!0,this.points=null;var u,l=(d=n.getExtremes()).min,d=d.max,h=h&&n.ordinal&&n.ordinal.getGroupIntervalFactor(l,d,this)||1,i=n.getTimeTicks(G.AdditionsClass.prototype.normalizeTimeTickInterval(u*(d-l)/i*h,o.units||H),Math.min(l,s[0]),Math.max(d,s[s.length-1]),n.options.startOfWeek,s,this.closestPointRange),s=(u=v.groupData.apply(this,[s,p,i,o.approximation])).groupedXData,p=u.groupedYData;h=0,o&&o.smoothed&&s.length&&(o.firstAnchor="firstPoint",o.anchor="middle",o.lastAnchor="lastPoint",M(32,!1,a,{"dataGrouping.smoothed":"use dataGrouping.anchor"}));var a=s,g=this.options.dataGrouping,l=this.currentDataGrouping&&this.currentDataGrouping.gapSize;if(g&&this.xData&&l&&this.groupMap){var c,f=a.length-1,m=g.anchor,x=y(g.firstAnchor,m),g=y(g.lastAnchor,m);if(m&&"start"!==m)for(var D=l*{middle:.5,end:1}[m],m=a.length-1;m--&&0<m;)a[m]+=D;x&&"start"!==x&&this.xData[0]>=a[0]&&(m=this.groupMap[0].start,D=this.groupMap[0].length,c=void 0,S(m)&&S(D)&&(c=m+(D-1)),a[0]={middle:a[0]+.5*l,end:a[0]+l,firstPoint:this.xData[0],lastPoint:c&&this.xData[c]}[x]),g&&"start"!==g&&l&&a[f]>=d-l&&(d=this.groupMap[this.groupMap.length-1].start,a[f]={middle:a[f]+.5*l,end:a[f]+l,firstPoint:d&&this.xData[d],lastPoint:this.xData[this.xData.length-1]}[g])}for(d=1;d<i.length;d++)i.info.segmentStarts&&-1!==i.info.segmentStarts.indexOf(d)||(h=Math.max(i[d]-i[d-1],h));(d=i.info).gapSize=h,this.closestPointRange=i.info.totalRange,this.groupMap=u.groupMap,e&&(P((e=s)[0])&&S(n.min)&&S(n.dataMin)&&e[0]<n.min&&((!P(n.options.min)&&n.min<=n.dataMin||n.min===n.dataMin)&&(n.min=Math.min(e[0],n.min)),n.dataMin=Math.min(e[0],n.dataMin)),P(e[e.length-1])&&S(n.max)&&S(n.dataMax)&&e[e.length-1]>n.max&&((!P(n.options.max)&&S(n.dataMax)&&n.max>=n.dataMax||n.max===n.dataMax)&&(n.max=Math.max(e[e.length-1],n.max)),n.dataMax=Math.max(e[e.length-1],n.dataMax))),o.groupAll&&(s=(o=this.cropData(s,p,n.min,n.max,1)).xData,p=o.yData,this.cropStart=o.start),this.processedXData=s,this.processedYData=p}else this.groupMap=null;this.hasGroupedData=t,this.currentDataGrouping=d,this.preventGraphAnimation=(r&&r.totalRange)!==(d&&d.totalRange)}},v.destroyGroupedData=function(){this.groupedData&&(this.groupedData.forEach(function(t,a){t&&(this.groupedData[a]=t.destroy?t.destroy():null)},this),this.groupedData.length=0)},v.generatePoints=function(){c.apply(this),this.destroyGroupedData(),this.groupedData=this.hasGroupedData?this.points:null},t(o,"update",function(){if(this.dataGroup)return M(24,!1,this.series.chart),!1}),t(r,"headerFormatter",function(t){var a,o,i=this.chart,e=i.time,r=t.labelConfig,n=r.series,s=n.tooltipOptions,p=n.options.dataGrouping,h=s.xDateFormat,u=n.xAxis,l=s[(t.isFooter?"footer":"header")+"Format"];u&&"datetime"===u.options.type&&p&&S(r.key)&&(a=n.currentDataGrouping,p=p.dateTimeLabelFormats||f.dateTimeLabelFormats,a?(s=p[a.unitName],1===a.count?h=s[0]:(h=s[1],o=s[2])):!h&&p&&(h=this.getXDateFormat(r,s,u)),h=e.dateFormat(h,r.key),o&&(h+=e.dateFormat(o,r.key+a.totalRange-1)),n.chart.styledMode&&(l=this.styledModeFormat(l)),t.text=d(l,{point:g(r.point,{key:h}),series:n},i),t.preventDefault())}),t(e,"destroy",v.destroyGroupedData),t(e,"afterSetOptions",function(t){t=t.options;var a,o=this.type,i=this.chart.options.plotOptions,e=n.defaultOptions.plotOptions[o].dataGrouping,r=this.useCommonDataGrouping&&f;(m[o]||r)&&(e=e||b(f,m[o]),a=this.chart.rangeSelector,t.dataGrouping=b(r,e,i.series&&i.series.dataGrouping,i[o].dataGrouping,this.userOptions.dataGrouping,!t.isInternal&&a&&S(a.selected)&&a.buttonOptions[a.selected].dataGrouping))}),t(i,"afterSetScale",function(){this.series.forEach(function(t){t.hasProcessed=!1})}),i.prototype.getGroupPixelWidth=function(){for(var t,a=this.series,o=a.length,i=0,e=!1,r=o;r--;)(t=a[r].options.dataGrouping)&&(i=Math.max(i,y(t.groupPixelWidth,f.groupPixelWidth)));for(r=o;r--;)(t=a[r].options.dataGrouping)&&a[r].hasProcessed&&(o=(a[r].processedXData||a[r].data).length,a[r].groupPixelWidth||o>this.chart.plotSizeX/i||o&&t.forced)&&(e=!0);return e?i:0},i.prototype.setDataGrouping=function(a,t){var o;if(t=y(t,!0),a=a||{forced:!1,units:null},this instanceof i)for(o=this.series.length;o--;)this.series[o].update({dataGrouping:a},!1);else this.chart.options.series.forEach(function(t){t.dataGrouping=a},!1);this.ordinal&&(this.ordinal.slope=void 0),t&&this.chart.redraw()},a.dataGrouping=l}),a(t,"masters/modules/datagrouping.src.js",[t["Extensions/DataGrouping.js"]],function(t){return t})});