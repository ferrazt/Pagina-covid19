"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}t(o=o?o._modules:{},"Mixins/Nodes.js",[o["Core/Globals.js"],o["Core/Series/Point.js"],o["Core/Series/Series.js"],o["Core/Utilities.js"]],function(o,i,n,t){var r=t.defined,s=t.extend,a=t.find,l=t.pick;return o.NodesMixin={createNode:function(o){function t(o,t){return a(o,function(o){return o.id===t})}var e,n=t(this.nodes,o),i=this.pointClass;return n||(e=this.options.nodes&&t(this.options.nodes,o),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=l(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var t=this.chart,e={};n.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){r(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=l(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),r(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),n.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),n.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(i.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&i.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&i.prototype.setState.apply(o.toNode,t)))}),i.prototype.setState.apply(this,t)}}}),t(o,"Series/Sankey/SankeyPoint.js",[o["Mixins/Nodes.js"],o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,e,t,i){var n,r,s=this&&this.__extends||(n=function(o,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}n(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),a=i.defined;function l(){var o=null!==r&&r.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}return i=i.extend,r=t.seriesTypes.column.prototype.pointClass,s(l,r),l.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),a(this.options.level)&&(this.options.column=this.column=this.options.level),this},l.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},l.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},i((t=l).prototype,{setState:o.setNodeState}),t}),t(o,"Mixins/TreeSeries.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(f,o){var h=o.extend,s=o.isArray,a=o.isNumber,l=o.isObject,d=o.merge,m=o.pick;return{getColor:function(o,t){var e,i,n,r=t.index,s=t.mapOptionsToLevel,a=t.parentColor,l=t.parentColorIndex,d=t.series,h=t.colors,p=t.siblings,c=d.points,u=d.chart.options.chart;return o&&(c=c[o.i],o=s[o.level]||{},c&&o.colorByPoint&&(n=c.index%(h?h.length:u.colorCount),i=h&&h[n]),d.chart.styledMode||(h=c&&c.options.color,u=o&&o.color,(e=a)&&(e=(e=o&&o.colorVariation)&&"brightness"===e.key?f.parse(a).brighten(r/p*e.to).get():a),e=m(h,u,i,e,d.color)),n=m(c&&c.options.colorIndex,o&&o.colorIndex,n,l,t.colorIndex)),{color:e,colorIndex:n}},getLevelOptions:function(o){var t=null;if(l(o)){var t={},n=a(o.from)?o.from:1,e=o.levels,i={},r=l(o.defaults)?o.defaults:{};for(s(e)&&(i=e.reduce(function(o,t){var e,i;return l(t)&&a(t.level)&&(i=("boolean"==typeof(e=d({},t)).levelIsConstant?e:r).levelIsConstant,delete e.levelIsConstant,delete e.level,t=t.level+(i?0:n-1),l(o[t])?h(o[t],e):o[t]=e),o},{})),e=a(o.to)?o.to:1,o=0;o<=e;o++)t[o]=d({},r,l(i[o])?i[o]:{})}return t},setTreeValues:function i(n,r){var o=r.before,t=r.idRoot,e=r.mapIdToNode[t],s=r.points[n.i],a=s&&s.options||{},l=0,d=[];return n.levelDynamic=n.level-("boolean"!=typeof r.levelIsConstant||r.levelIsConstant?0:e.level),n.name=m(s&&s.name,""),n.visible=t===n.id||"boolean"==typeof r.visible&&r.visible,(n="function"==typeof o?o(n,r):n).children.forEach(function(o,t){var e=h({},r);h(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),d.push(o),o.visible&&(l+=o.val)}),n.visible=0<l||n.visible,o=m(a.value,l),n.children=d,n.childrenTotal=l,n.isLeaf=n.visible&&!l,n.val=o,n},updateRootId:function(o){var t;return l(o)&&(t=l(o.options)?o.options:{},t=m(o.rootNode,t.rootId,""),l(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Mixins/Nodes.js"],o["Series/Sankey/SankeyPoint.js"],o["Core/Series/SeriesRegistry.js"],o["Mixins/TreeSeries.js"],o["Core/Utilities.js"]],function(a,o,t,e,i,n,r){var s,l=this&&this.__extends||(s=function(o,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}s(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),d=i.series,h=i.seriesTypes.column,p=n.getLevelOptions,c=r.defined;n=r.extend;var u,f=r.find,m=r.isObject,v=r.merge,y=r.pick,g=r.relativeLength,k=r.stableSort;function b(){var o=null!==u&&u.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return l(b,u=h),b.getDLOptions=function(o){var t=m(o.optionsPoint)?o.optionsPoint.dataLabels:{};return o=m(o.level)?o.level.dataLabels:{},v({style:{}},o,t)},b.prototype.createNodeColumn=function(){var a=this,t=this.chart,l=[];return l.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},l.offset=function(o,t){for(var e=0,i=a.nodePadding,n=0;n<l.length;n++){var r=l[n].getSum(),s=Math.max(r*t,a.options.minLinkWidth);if(r=r?s+i:0,l[n]===o)return{relativeTop:e+g(o.options.offset||0,r)};e+=r}},l.top=function(e){var i=a.nodePadding,o=this.reduce(function(o,t){return 0<o&&(o+=i),o+(t=Math.max(t.getSum()*e,a.options.minLinkWidth))},0);return(t.plotSizeY-o)/2},l},b.prototype.createNodeColumns=function(){var r=[];this.nodes.forEach(function(e){var i,o=-1;if(!c(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(i=0;i<e.linksTo.length;i++){var t,n=e.linksTo[0];n.fromNode.column>o&&(o=(t=n.fromNode).column)}e.column=o+1,t&&"hanging"===t.options.layout&&(e.hangsFrom=t,i=-1,f(t.linksFrom,function(o,t){return(o=o.toNode===e)&&(i=t),o}),e.column+=i)}r[e.column]||(r[e.column]=this.createNodeColumn()),r[e.column].push(e)},this);for(var o=0;o<r.length;o++)void 0===r[o]&&(r[o]=this.createNodeColumn());return r},b.prototype.generatePoints=function(){t.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),k(this.nodes,function(o,t){return o.level-t.level}))},b.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return!this.nodeColumns||(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o),t},b.prototype.hasData=function(){return!!this.processedXData.length},b.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=e.mapOptionsToLevel[(o.isNode?o:o.fromNode).level||0]||{},n=o.options,r=i.states&&i.states[t||""]||{};t=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=y(r[t],n[t],i[t],e.options[t]),o},{});var s=y(r.color,n.color,(t.colorByPoint?o:i).color);return o.isNode?{fill:s,stroke:t.borderColor,"stroke-width":t.borderWidth}:{fill:a.parse(s).setOpacity(t.linkOpacity).get()}},b.prototype.render=function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),h.prototype.render.call(this),this.points=o},b.prototype.translate=function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);var l=this,d=this.chart,h=this.options,o=this.nodeWidth,t=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=t.reduce(function(o,t){return Math.min(o,function(t){for(var o,e,i=t.slice(),n=a.options.minLinkWidth||0,r=0,s=d.plotSizeY-h.borderWidth-(t.length-1)*l.nodePadding;t.length;){for(r=s/t.sum(),o=!1,e=t.length;e--;)t[e].getSum()*r<n&&(t.splice(e,1),s-=n,o=!0);if(!o)break}return t.length=0,i.forEach(function(o){return t.push(o)}),r}(t))},1/0),this.colDistance=(d.plotSizeX-o-h.borderWidth)/Math.max(1,t.length-1),l.mapOptionsToLevel=p({from:1,levels:h.levels,to:t.length-1,defaults:{borderColor:h.borderColor,borderRadius:h.borderRadius,borderWidth:h.borderWidth,color:l.color,colorByPoint:h.colorByPoint,levelIsConstant:!0,linkColor:h.linkColor,linkLineWidth:h.linkLineWidth,linkOpacity:h.linkOpacity,states:h.states}}),t.forEach(function(t){t.forEach(function(o){l.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(l.translateLink(o),o.allowShadow=!1)})})},b.prototype.translateLink=function(e){var o,t,i,n,r,s,a,l,d,h,p,c,u,f,m=function(o,t){return t=o.offset(e,t)*k,Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-b)},v=e.fromNode,y=e.toNode,g=this.chart,k=this.translationFactor,b=Math.max(e.weight*k,this.options.minLinkWidth),C=(g.inverted?-this.colDistance:this.colDistance)*this.options.curveFactor,N=m(v,"linksFrom"),m=m(y,"linksTo"),S=v.nodeX,x=this.nodeWidth,y=y.column*this.colDistance,P=e.outgoing,L=S+x<y;g.inverted&&(N=g.plotSizeY-N,m=(g.plotSizeY||0)-m,y=g.plotSizeX-y,x=-x,b=-b,L=y<S),e.shapeType="path",e.linkBase=[N,N+b,m,m+b],L&&"number"==typeof m?e.shapeArgs={d:[["M",S+x,N],["C",S+x+C,N,y-C,m,y,m],["L",y+(P?x:0),m+b/2],["L",y,m+b],["C",y-C,m+b,S+x+C,N+b,S+x,N+b],["Z"]]}:"number"==typeof m&&(C=y-20-b,L=y,i=(t=(o=S+x)+20)+b,d=(l=(a=(s=(r=(n=N)+b)+20)+(g.plotHeight-N-b))+20)+b,p=(h=m)+b,c=l+.7*b,u=L-.7*b,f=o+.7*b,e.shapeArgs={d:[["M",o,n],["C",f,n,i,r-.7*b,i,s],["L",i,a],["C",i,c,f,d,o,d],["L",L,d],["C",u,d,C,c,C,a],["L",C,c=p+20],["C",C,p-.7*b,u,h,L,h],["L",L,p],["C",P=y-20,p,P,p,P,c],["L",P,a],["C",P,l,P,l,L,l],["L",o,l],["C",t,l,t,l,t,a],["L",t,s],["C",t,r,t,r,o,r],["Z"]]}),e.dlBox={x:S+(y-S+x)/2,y:N+(m-N)/2,height:b,width:0},e.tooltipPos=g.inverted?[g.plotSizeY-e.dlBox.y-b/2,g.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+b/2],e.y=e.plotY=1,e.color||(e.color=v.color)},b.prototype.translateNode=function(o,t){var e,i,n=this.translationFactor,r=this.chart,s=this.options,a=o.getSum(),l=Math.max(Math.round(a*n),this.options.minLinkWidth),d=Math.round(s.borderWidth)%2/2,h=t.offset(o,n);t=Math.floor(y(h.absoluteTop,t.top(n)+h.relativeTop))+d,d=Math.floor(this.colDistance*o.column+s.borderWidth/2)+d,d=r.inverted?r.plotSizeX-d:d,n=Math.round(this.nodeWidth),(o.sum=a)?(o.shapeType="rect",a=o.nodeX=d,h=o.nodeY=t,e=o.options.width||s.width||n,i=o.options.height||s.height||l,r.inverted&&(a=d-n,h=r.plotSizeY-t-l,e=o.options.height||s.height||n,i=o.options.width||s.width||l),o.dlOptions=b.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=r.inverted?[r.plotSizeY-h-i/2,r.plotSizeX-a-e/2]:[a+e/2,h+i/2],o.shapeArgs={x:a,y:h,width:e,height:i,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},b.defaultOptions=v(h.defaultOptions,{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}),n((r=b).prototype,{animate:d.prototype.animate,createNode:t.createNode,destroy:t.destroy,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,pointArrayMap:["from","to"],pointClass:e,searchPoint:o.noop,setData:t.setData}),i.registerSeriesType("sankey",r),r}),t(o,"masters/modules/sankey.src.js",[],function(){})});