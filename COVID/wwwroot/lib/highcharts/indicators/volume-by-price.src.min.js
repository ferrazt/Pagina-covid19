"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){e=e?e._modules:{};function t(e,t,o,i){e.hasOwnProperty(t)||(e[t]=i.apply(null,o))}t(e,"Stock/Indicators/VBP/VBPIndicator.js",[e["Core/Animation/AnimationUtilities.js"],e["Core/Globals.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"]],function(e,n,t,o){var i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=e.animObject,r=n.noop,e=t.seriesTypes.sma,p=o.addEvent,g=o.arrayMax,c=o.arrayMin,y=o.correctFloat,d=o.error,l=o.extend,h=o.isArray,o=o.merge;var u,D=Math.abs,x=t.seriesTypes.column.prototype,e=(s(m,u=e),m.prototype.init=function(e){var t,o,i=this;return n.seriesTypes.sma.prototype.init.apply(i,arguments),o=i.options.params,t=i.linkedParent,o=e.get(o.volumeSeriesID),i.addCustomEvents(t,o),i},m.prototype.addCustomEvents=function(e,t){var o=this;function i(){o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG=o.zoneLinesSVG.destroy())}return o.dataEventsToUnbind.push(p(e,"remove",function(){i()})),t&&o.dataEventsToUnbind.push(p(t,"remove",function(){i()})),o},m.prototype.animate=function(e){var o=this,t=o.chart.inverted,i=o.group,n={};!e&&i&&(e=t?o.yAxis.top:o.xAxis.left,t?(i["forceAnimate:translateY"]=!0,n.translateY=e):(i["forceAnimate:translateX"]=!0,n.translateX=e),i.animate(n,l(a(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})))},m.prototype.drawPoints=function(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),x.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),x.drawPoints.apply(e,arguments)},m.prototype.posNegVolume=function(e,t){var o,i,n,s,a=this,r=t?["positive","negative"]:["negative","positive"],p=a.options.volumeDivision,l=a.points.length,u=[],d=[],h=0;for(e?(a.posWidths=u,a.negWidths=d):(u=a.posWidths,d=a.negWidths);h<l;h++)(s=a.points[h])[r[0]+"Graphic"]=s.graphic,s.graphic=s[r[1]+"Graphic"],e&&(o=s.shapeArgs.width,(n=(i=a.priceZones[h]).wholeVolumeData)?(u.push(o/n*i.positiveVolumeData),d.push(o/n*i.negativeVolumeData)):(u.push(0),d.push(0))),s.color=t?p.styles.positiveColor:p.styles.negativeColor,s.shapeArgs.width=(t?a.posWidths:a.negWidths)[h],s.shapeArgs.x=t?s.shapeArgs.x:a.posWidths[h]},m.prototype.translate=function(){var e,o,i,n,s,a,t,r,p,l=this,u=l.options,d=l.chart,h=l.yAxis,c=h.min,m=l.options.zoneLines,v=l.priceZones,f=0;x.translate.apply(l),(e=l.points).length&&(t=u.pointPadding<.5?u.pointPadding:.1,u=l.volumeDataArray,o=g(u),i=d.plotWidth/2,r=d.plotTop,n=D(h.toPixels(c)-h.toPixels(c+l.rangeStep)),s=D(h.toPixels(c)-h.toPixels(c+l.rangeStep)),t&&(t=D(n*(1-2*t)),f=D((n-t)/2),n=D(t)),e.forEach(function(e,t){e.barX=e.plotX=0,p=e.plotY=h.toPixels(v[t].start)-r-(h.reversed?n-s:n)-f,a=y(i*v[t].wholeVolumeData/o),e.pointWidth=a,e.shapeArgs=l.crispCol.apply(l,[0,p,a,n]),e.volumeNeg=v[t].negativeVolumeData,e.volumePos=v[t].positiveVolumeData,e.volumeAll=v[t].wholeVolumeData}),m.enabled&&l.drawZones(d,h,l.zoneStarts,m.styles))},m.prototype.getValues=function(e,t){var o,i,n=e.processedXData,s=e.processedYData,a=this.chart,r=t.ranges,p=[],l=[],u=[];if(e.chart)if(i=a.get(t.volumeSeriesID)){if(!(o=h(s[0]))||4===s[0].length)return(this.priceZones=this.specifyZones(o,n,s,r,i)).forEach(function(e,t){p.push([e.x,e.end]),l.push(p[t][0]),u.push(p[t][1])}),{values:p,xData:l,yData:u};d("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,a)}else d("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,a);else d("Base series not found! In case it has been removed, add a new one.",!0,a)},m.prototype.specifyZones=function(e,t,o,i,n){var s,a,r=!!e&&function(e){for(var t,o=e.length,i=e[0][3],n=i,s=1;s<o;s++)(t=e[s][3])<i&&(i=t),n<t&&(n=t);return{min:i,max:n}}(o),p=r?r.min:c(o),r=r?r.max:g(o),l=this.zoneStarts=[],u=[],d=0,h=1;if(!p||!r)return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(s=this.rangeStep=y(r-p)/i,l.push(p);d<i-1;d++)l.push(y(l[d]+s));for(l.push(r),a=l.length;h<a;h++)u.push({index:h-1,x:t[0],start:l[h-1],end:l[h]});return this.volumePerZone(e,u,n,t,o)},m.prototype.volumePerZone=function(t,e,o,i,n){var s,a,r,p,l,u=this,d=o.processedXData,h=o.processedYData,c=e.length-1,m=n.length,o=h.length;return D(m-o)&&(i[0]!==d[0]&&h.unshift(0),i[m-1]!==d[o-1]&&h.push(0)),u.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,l=0;l<m;l++)r=a=!1,p=t?n[l][3]:n[l],s=l?t?n[l-1][3]:n[l-1]:p,p<=e.start&&0===e.index&&(a=!0),p>=e.end&&e.index===c&&(r=!0),(p>e.start||a)&&(p<e.end||r)&&(e.wholeVolumeData+=h[l],p<s?e.negativeVolumeData+=h[l]:e.positiveVolumeData+=h[l]);u.volumeDataArray.push(e.wholeVolumeData)}),e},m.prototype.drawZones=function(t,o,e,i){var n,s=t.renderer,a=this.zoneLinesSVG,r=[],p=t.plotWidth,l=t.plotTop;e.forEach(function(e){n=o.toPixels(e)-l,r=r.concat(t.renderer.crispLine([["M",0,n],["L",p,n]],i.lineWidth))}),a?a.animate({d:r}):a=this.zoneLinesSVG=s.path(r).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)},m.defaultOptions=o(e.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}}),m);function m(){var e=null!==u&&u.apply(this,arguments)||this;return e.data=void 0,e.negWidths=void 0,e.options=void 0,e.points=void 0,e.posWidths=void 0,e.priceZones=void 0,e.rangeStep=void 0,e.volumeDataArray=void 0,e.zoneStarts=void 0,e.zoneLinesSVG=void 0,e}return l(e.prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],bindTo:{series:!1,eventName:"afterSetExtremes"},calculateOn:"render",markerAttribs:r,drawGraph:r,getColumnMetrics:x.getColumnMetrics,crispCol:x.crispCol}),t.registerSeriesType("vbp",e),e}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});